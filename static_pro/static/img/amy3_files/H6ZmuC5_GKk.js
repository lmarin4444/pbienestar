if (self.CavalryLogger) { CavalryLogger.start_js(["Baebe"]); }

__d("MercuryAPIArgsSource",[],(function a(b,c,d,e,f,g){f.exports={CHAT:"chat",JEWEL:"jewel",MERCURY:"mercury",MERCURYSYNC:"mercury_sync",WEBMESSENGER:"web_messenger",MESSENGER:"messenger"}}),null);
__d("MercuryAudioType",[],(function a(b,c,d,e,f,g){f.exports={AudioClip:"fb_voice_message",VoiceMessageWithTranscript:"fb_voice_message_with_transcript"}}),null);
__d("MessengerView",[],(function a(b,c,d,e,f,g){f.exports={DETAIL:{COMPOSE:"detail/compose",THREAD:"detail/thread",PAYTHREAD:"detail/paythread",PAYFRIENDPICKER:"detail/payfriendpicker"},MASTER:{GROUPS:"master/groups",PAYMENT:"master/payment",PEOPLE:"master/people",RECENT:"master/recent",SUPPORT:"master/support",SEARCH:"master/search"}}}),null);
__d("PageCommItemStatus",[],(function a(b,c,d,e,f,g){f.exports={FOLLOW_UP:"FOLLOW_UP",DONE:"DONE",TODO:"TODO",SPAM:"SPAM"}}),null);
__d("EventReminderConstants",[],(function a(b,c,d,e,f,g){"use strict";var h={INITIAL:"initial",GOING:"going",WATCHED:"watched",UNWATCHED:"unwatched"},i={ASSOCIATED_EVENT:"ASSOCIATED_EVENT"},j={GOING:"GOING",DECLINED:"DECLINED",INVITED:"INVITED"},k={NO_ERROR:"NO_ERROR",PAST_TIME:"PAST_TIME",AFTER_ONE_YEAR:"AFTER_ONE_YEAR"};f.exports={EventGuestStates:h,EventPlanType:i,GuestStates:j,TimeErrorType:k}}),null);
__d("IgnoreMessagesTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function a(b,c,d,e,f,g){"use strict";function h(){this.clear()}h.prototype.log=function(){c("GeneratedLoggerUtils").log("logger:IgnoreMessagesLoggerConfig",this.$IgnoreMessagesTypedLogger1,c("Banzai").BASIC)};h.prototype.logVital=function(){c("GeneratedLoggerUtils").log("logger:IgnoreMessagesLoggerConfig",this.$IgnoreMessagesTypedLogger1,c("Banzai").VITAL)};h.prototype.clear=function(){this.$IgnoreMessagesTypedLogger1={};return this};h.prototype.updateData=function(j){this.$IgnoreMessagesTypedLogger1=babelHelpers["extends"]({},this.$IgnoreMessagesTypedLogger1,j);return this};h.prototype.setEvent=function(j){this.$IgnoreMessagesTypedLogger1.event=j;return this};h.prototype.setPlatform=function(j){this.$IgnoreMessagesTypedLogger1.platform=j;return this};h.prototype.setThreadID=function(j){this.$IgnoreMessagesTypedLogger1.thread_id=j;return this};h.prototype.setVC=function(j){this.$IgnoreMessagesTypedLogger1.vc=j;return this};var i={event:true,platform:true,thread_id:true,vc:true};f.exports=h}),null);
__d("MercuryMessageClientState",[],(function a(b,c,d,e,f,g){var h={DO_NOT_SEND_TO_SERVER:"do_not_send_to_server",SEND_TO_SERVER:"send_to_server"};f.exports=h}),null);
__d("MercuryActionType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({LOG_MESSAGE:"ma-type:log-message",USER_GENERATED_MESSAGE:"ma-type:user-generated-message",ADD_GROUP_ADMINS:"ma-type:add_group_admins",REMOVE_GROUP_ADMINS:"ma-type:remove_group_admins",CHANGE_READ_STATUS:"ma-type:change_read_status",MARK_THREAD_SEEN:"ma-type:mark_thread_seen",CHANGE_MUTE_SETTINGS:"ma-type:change-mute-settings",SEND_MESSAGE:"ma-type:send-message",DELETE_MESSAGES:"ma-type:delete-messages",DELETE_THREAD:"ma-type:delete-thread",UPDATE_SNIPPET:"ma-type:update-snippet",CHANGE_ARCHIVED_STATUS:"ma-type:change-archived-status",CHANGE_FOLDER:"ma-type:change-folder",ADD_PARTICIPANTS:"ma-type:add-participants",CANCEL_ATTACHMENT_PLACEHOLDER:"ma-type:cancel-attachment-placeholder",CONFIRM_ATTACHMENT_PLACEHOLDER:"ma-type:confirm-attachment-placeholder",CHANGE_FLAG:"ma-type:change_flag",MOVE_PENDING_TO_INBOX:"ma-type:move_pending_to_inbox",CREATE_PAGE_ADMIN_NOTE:"ma-type:create-page-admin-note",REPLACE_MESSAGE:"ma-type:replace-message",UPDATE_CUSTOM_LIKE:"ma-type:update_custom_like",UNWRAP_MESSAGE:"ma-type:unwrap-message",JOINABLE_MODE:"ma-type:joinable-mode",APPROVAL_MODE:"ma-type:approval-mode",APPROVAL_QUEUE:"ma-type:approval-queue",IS_PIN_PROTECTED:"ma-type:is_pin_protected",REACTION_UPDATE:"ma-type:reaction-update",LIVE_LOCATION_UPDATE:"ma-type:live-location-update",UPDATE_RTC_CALL_DATA:"ma-type:update-rtc-call-data",UPDATE_COMM_STATUS:"ma-type:update-comm-status",EVENT_RSVP_CHANGED:"ma-type:event-rsvp-changed",BLOCK_STATUS_CHANGED:"ma-type:block-status-changed",UPDATE_COMM_ITEM_OWNER:"ma-type:update-comm-item-owner"})}),null);
__d("MercuryDispatcher",["invariant","ArbiterMixin","LogHistory","MercuryActionType","MercuryPayloadSource","MercurySingletonProvider","MercuryThreadInformer","isEmpty","mixin"],(function a(b,c,d,e,f,g,h){"use strict";var i,j,k=c("LogHistory").getInstance("mercury_dispatcher");i=babelHelpers.inherits(l,c("mixin")(c("ArbiterMixin")));j=i&&i.prototype;l.getForFBID=function(n){return m.getForFBID(n)};l.get=function(){return m.get()};function l(n){j.constructor.call(this);this.$MercuryDispatcher1=n}l.prototype.handleUpdate=function(n){this.$MercuryDispatcher2(n);!!n.from_client!==!!n.preprocessed||h(0);delete n.preprocessed;if(!c("isEmpty")(n))c("MercuryThreadInformer").getForFBID(this.$MercuryDispatcher1).synchronizeInforms(function(){if(n.payload_source===c("MercuryPayloadSource").SERVER_INVALIDATE_GLOBAL_STATE)this.inform("invalidate-global-state",{});if(n.payload_source===c("MercuryPayloadSource").SERVER_INVALIDATE_THREAD_STATE){var o=n.threads&&n.threads.length>0&&n.threads[0]&&n.threads[0].thread_id;if(o)this.inform("invalidate-thread-state",o)}this.inform("update-thread-ids",n.newlyAddedClientIDs);this.inform("update-participants",n);this.inform("update-threads",n);this.inform("update-unread",n);this.inform("update-threadlist",n);this.inform("update-messages",n);this.inform("update-unseen",n);this.inform("update-typing-state",n);this.inform("update-delivery",n);this.inform("update-roger",n.roger);this.inform("update-blocked-users",n);this.inform("update-ignored-users",n);this.inform("model-update-completed",null)}.bind(this))};l.prototype.$MercuryDispatcher2=function(n){var o=n.payload_source;if(o===c("MercuryPayloadSource").CLIENT_CHANGE_READ_STATUS||o===c("MercuryPayloadSource").CLIENT_MARK_THREAD_SEEN)return;var p={from_client:n.from_client,messages:null};if(n.actions){var q=n.actions.filter(function(r){return r.action_type===c("MercuryActionType").USER_GENERATED_MESSAGE||r.action_type===c("MercuryActionType").LOG_MESSAGE}).map(function(r){return{action_type:r.action_type,other_user_fbid:r.other_user_fbid,thread_fbid:r.thread_fbid,message_id:r.message_id}});if(q.length)p.messages=q}k.debug("update:"+o,JSON.stringify(p))};var m=new(c("MercurySingletonProvider"))(l);f.exports=l}),null);
__d("MercuryActionStatus",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({UNSENT:0,SUCCESS:1,UNCONFIRMED:3,FAILED_UNKNOWN_REASON:4,UNABLE_TO_CONFIRM:5,RESENT:6,RESENDING:7,ERROR:10})}),null);
__d("MercuryLocalIDs",["PresenceUtil","randomInt"],(function a(b,c,d,e,f,g){"use strict";var h={generateMessageID:function j(k){var l=k||Date.now(),m=c("randomInt")(0,4294967295),n=c("PresenceUtil").getSessionID();return"<"+l+":"+m+"-"+n+"@mail.projektitan.com>"},generateThreadID:function j(k){return"root:"+h.generateOfflineThreadingID(k)},generateOfflineThreadingID:function j(k){var l=k||Date.now(),m=c("randomInt")(0,4294967295),n=("0000000000000000000000"+m.toString(2)).slice(-22),o=l.toString(2)+n;return i(o.slice(-63))}};function i(j){var k="";while(j!="0"){var l=0,m="";for(var n=0;n<j.length;n++){l=2*l+parseInt(j[n],10);if(l>=10){m+="1";l-=10}else m+="0"}k=l.toString()+k;j=m.slice(m.indexOf("1"))}return k}f.exports=h}),null);
__d("MercuryMessageSourceTags",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({CHAT:"source:chat",EMAIL:"source:email",MESSENGER:"source:messenger",MOBILE:"source:mobile"})}),null);
__d("MercurySendMessageFields",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({AUTO_RETRY_CNT:"auto_retry_cnt",MANUAL_RETRY_CNT:"manual_retry_cnt"})}),null);
__d("EmojiLikeConstants",["EmojiStaticConfig"],(function a(b,c,d,e,f,g){"use strict";var h=c("EmojiStaticConfig").sizeMap,i={XSMALL:"xsmall",SMALL:"small",MEDIUM:"medium",LARGE:"large"},j={dp16:"xsmall",dp32:"small",dp64:"medium",db64:"medium",dp128:"large"},k={PICKER:"picker",HOT_LIKE:"hot_like"},l=[983040],m="hot_emoji_source",n="hot_emoji_size",o="emoji_like",p="\ud83d\udc4d",q=[128077];f.exports={FB_THUMBS_UP_EMOJI:l,size:i,sizeMap:h,sizeMapTransfer:j,source:k,SOURCE_TAG_PREFIX:m,TAG_PREFIX_NEW:n,TAG_PREFIX_OLD:o,THUMBS_UP_EMOJI:p,THUMBS_UP_EMOJI_CODES:q}}),null);
__d("MercuryTagHelper",[],(function a(b,c,d,e,f,g){"use strict";var h={get:function i(j,k){var l=j.find(function(m){return m.startsWith(k)});return l&&l.substr(l.indexOf(":")+1)}};f.exports=h}),null);
__d("EmojiLikeUtils",["EmojiLikeConstants","EmoticonEmojiList","MercuryTagHelper"],(function a(b,c,d,e,f,g){"use strict";function h(n,o){if(!n.tags)n.tags=[i(o)];else n.tags.push(i(o));return n}function i(n){var o=c("EmojiLikeConstants").TAG_PREFIX_NEW;return o+":"+n}function j(n,o){if(!n.tags)n.tags=[k(o)];else n.tags.push(k(o));return n}function k(n){return c("EmojiLikeConstants").SOURCE_TAG_PREFIX+":"+n}function l(n){return m(n)!=null}function m(n){if(!n.tags)return null;var o=c("MercuryTagHelper").get(n.tags,c("EmojiLikeConstants").TAG_PREFIX_NEW);if(o)return o;return c("MercuryTagHelper").get(n.tags,c("EmojiLikeConstants").TAG_PREFIX_OLD)}f.exports={getEmojiSize:m,isEmojiLike:l,setEmojiSize:h,setEmojiSource:j}}),null);
__d("MercuryAttachmentContentType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({PHOTO:"attach:image",VIDEO:"attach:video",MUSIC:"attach:music",VOICE:"attach:voice",TEXT:"attach:text",MSWORD:"attach:ms:word",MSXLS:"attach:ms:xls",MSPPT:"attach:ms:ppt",ORION:"attach:orion",SHOERACK_INVITATION:"attach:shoerackinvite",UNKNOWN:"attach:unknown"})}),null);
__d("MercuryAttachment",["cx","EmojiLikeUtils","MercuryAttachmentContentType","MercuryAttachmentType","MercuryAudioType","Set","StoryAttachmentStyle"],(function a(b,c,d,e,f,g,h){"use strict";var i=function i(m){return m===Object(m)},j="_1c_u",k=new(c("Set"))([c("MercuryAttachmentType").ANIMATED_IMAGE,c("MercuryAttachmentType").PHOTO,c("MercuryAttachmentType").VIDEO,c("MercuryAttachmentType").THIRDPARTYSTICKER]),l={getAttachIconClass:function m(n){switch(n){case c("MercuryAttachmentContentType").PHOTO:return"_y2-";case c("MercuryAttachmentContentType").VIDEO:return"_y2_";case c("MercuryAttachmentContentType").MUSIC:return"_y30";case c("MercuryAttachmentContentType").VOICE:return"_y31";case c("MercuryAttachmentContentType").TEXT:return"_y32";case c("MercuryAttachmentContentType").MSWORD:return"_y33";case c("MercuryAttachmentContentType").MSXLS:return"_y34";case c("MercuryAttachmentContentType").MSPPT:return"_y35"}return"_y36"},getAttachIconClassByMime:function m(n){return this.getAttachIconClass(this.getAttachTypeByMime(n))},getAttachTypeByMime:function m(n){if(n.startsWith("image"))return c("MercuryAttachmentContentType").PHOTO;else if(n.startsWith("video"))return c("MercuryAttachmentContentType").VIDEO;else if(n.startsWith("audio"))return c("MercuryAttachmentContentType").MUSIC;else if(n.startsWith("text/plain"))return c("MercuryAttachmentContentType").TEXT;else if(n=="application/msword"||n.startsWith("application/vnd.ms-word")||n.startsWith("application/vnd.openxmlformats-officedocument.wordprocessingml"))return c("MercuryAttachmentContentType").MSWORD;else if(n.startsWith("application/vnd.ms-excel")||n.startsWith("application/vnd.openxmlformats-officedocument.spreadsheetml"))return c("MercuryAttachmentContentType").MSXLS;else if(n.startsWith("application/vnd.ms-powerpoint")||n.startsWith("application/vnd.openxmlformats-officedocument.presentationml"))return c("MercuryAttachmentContentType").MSPPT;else return c("MercuryAttachmentContentType").UNKNOWN},convertRaw:function m(n){var o=[];for(var p=0;p<n.length;p++){var q=n[p];if(q.attach_type===c("MercuryAttachmentType").PHOTO)o.push(q);else if(q.filename){var r=l.getAttachTypeByMime(q.filetype),s={};s.attach_type=c("MercuryAttachmentType").FILE;s.name=q.filename;s.icon_type=r;s.url="";o.push(s)}}return o},get:function m(n){var o=[];if(n.attachments)o=n.attachments;else if(n.raw_attachments)o=this.convertRaw(n.raw_attachments);var p=c("EmojiLikeUtils").getEmojiSize(n);if(p)o=o.concat([{attach_type:c("MercuryAttachmentType").EMOJI_LIKE,size:p}]);if(!(n.attachments&&n.attachments.length>0)){if(n.sticker_id)return o.concat([{attach_type:c("MercuryAttachmentType").STICKER}]);if(n.preview_attachments&&n.preview_attachments.length>0)return o.concat(n.preview_attachments)}return o},resizeContain:function m(n,o){var p=n.width/n.height,q=o.width/o.height;if(q<p)return{width:Math.ceil(Math.min(n.height*q,o.width)),height:Math.ceil(Math.min(n.height,o.height))};else return{width:Math.ceil(Math.min(n.width,o.width)),height:Math.ceil(Math.min(n.width/q,o.height))}},isBubblePreferred:function m(n){return this.isFileAttachment(n)},isPhotoAttachment:function m(n){return!!(n.attach_type==c("MercuryAttachmentType").PHOTO||n.attach_type==c("MercuryAttachmentType").ANIMATED_IMAGE||n.attach_type==c("MercuryAttachmentType").THIRDPARTYSTICKER||n.attach_type==c("MercuryAttachmentType").FILE&&n.preview_url)},isPhotoGroupAttachment:function m(n){return k.has(n.attach_type)},isSinglePhotoGroupAttachment:function m(n){return!!(n.attachments&&n.attachments.length===1&&n.attachments[0]&&this.isPhotoGroupAttachment(n.attachments[0]))},isVideoAttachment:function m(n){return n.attach_type==c("MercuryAttachmentType").VIDEO},isShareAttachment:function m(n){return n.attach_type==c("MercuryAttachmentType").SHARE},isFileAttachment:function m(n){return n.attach_type==c("MercuryAttachmentType").FILE},isErrorAttachment:function m(n){return n.attach_type==c("MercuryAttachmentType").ERROR},isStickerAttachment:function m(n){return n.attach_type==c("MercuryAttachmentType").STICKER},isEmojiLikeAttachment:function m(n){return n.attach_type===c("MercuryAttachmentType").EMOJI_LIKE},isVoiceAttachment:function m(n){if(!n.metadata)return false;return n.metadata.type===c("MercuryAudioType").AudioClip||n.metadata.type===c("MercuryAudioType").VoiceMessageWithTranscript},hasAttribution:function m(n){return!!n.app_attribution},isSingleVideoAttachment:function m(n){var o=this.get(n).filter(i).filter(function(p){return this.isVideoAttachment(p)}.bind(this));return o.length===1},isSharedVideoAttachment:function m(n){var o=n.attach_type===c("MercuryAttachmentType").SHARE&&n.share&&n.share.subattachments&&n.share.subattachments[0];return!!(o&&o.target&&o.target.video_id)},isGenieSharedVideoAttachment:function m(n){return!!(n.attach_type===c("MercuryAttachmentType").SHARE&&n.share&&n.share.style_list.indexOf(c("StoryAttachmentStyle").GENIE_MESSAGE)>-1&&n.share.target&&n.share.target.attachment&&this.isSharedVideoAttachment(n.share.target.attachment))},isSharedVideoAttachmentMessage:function m(n){var o=this.get(n).filter(i).filter(function(p){return this.isSharedVideoAttachment(p)||this.isGenieSharedVideoAttachment(p)}.bind(this));return o.length===1},getVideoElem:function m(n,o){var p=o.getMessageElement(n);if(!p)return null;var q=p.getElementsByClassName(j);return q&&q.length?q[0]:p}};f.exports=l}),null);
__d("MercuryDisplayTimeFilterMessageRenderer",["fbt"],(function a(b,c,d,e,f,g,h){"use strict";var i={renderFilteredContent:function j(k){if(k.is_filtered_content_bh)return h._("Este mensaje se elimin\u00f3 porque contiene enlaces bloqueados o da\u00f1inos.");if(k.is_filtered_content_account)return h._("Este mensaje se elimin\u00f3 temporalmente porque necesitamos verificar la cuenta del remitente.");if(k.is_filtered_content_quasar)return h._("Este mensaje se elimin\u00f3 porque contiene contenido bloqueado o da\u00f1ino.");if(k.is_filtered_content_invalid_app)return h._("Este mensaje se elimin\u00f3 porque la aplicaci\u00f3n desde la que se env\u00eda est\u00e1 bloqueada y no puede enviar mensajes.");return h._("Este mensaje se elimin\u00f3 temporalmente porque es necesario verificar la cuenta del remitente o se identific\u00f3 como ofensivo.")}};f.exports=i}),null);
__d("MercuryGiftSnippetRenderer",["fbt"],(function a(b,c,d,e,f,g,h){"use strict";var i={renderText:function j(k,l){return k?h._("Enviaste un mensaje de San Valent\u00edn."):h._("{name} envi\u00f3 un mensaje de San Valent\u00edn.",[h.param("name",l)])}};f.exports=i}),null);
__d("MercuryGlobalActionType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({MARK_ALL_READ:"mga-type:mark-all-read",MARK_ALL_SEEN:"mga-type:mark-all-seen"})}),null);
__d("MercuryLogMessageType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({SUBSCRIBE:"log:subscribe",UNSUBSCRIBE:"log:unsubscribe",VIDEO_CALL:"log:video-call",PHONE_CALL:"log:phone-call",THREAD_NAME:"log:thread-name",THREAD_IMAGE:"log:thread-image",SERVER_ERROR:"log:error-msg",LIVE_LISTEN:"log:live-listen",WALLPAPER:"log:wallpaper",ORION:"log:orion",SWITCH_TO_WORK:"log:switch",PAGE_REPLY:"log:page-reply",GENERIC_ADMIN_TEXT:"log:generic-admin-text"})}),null);
__d("ImageSourceType",[],(function a(b,c,d,e,f,g){var h={PROFILE_PICTURE:"profile_picture",IMAGE:"image"};f.exports=h}),null);
__d("ImageSourceRequest",["CurrentUser","ImageSourceType","KeyedCallbackManager","PhotoResizeModeConst","MercuryServerDispatcher"],(function a(b,c,d,e,f,g){function h(){"use strict";this._request={fbid:null,type:null,width:null,height:null,resize_mode:null};this._callback=null}h.prototype.setFBID=function(l){"use strict";this._request.fbid=l;return this};h.prototype.setType=function(l){"use strict";if(![c("ImageSourceType").PROFILE_PICTURE,c("ImageSourceType").IMAGE].includes(l))throw new TypeError("ImageSourceRequest.setType: invalid type "+l);this._request.type=l;return this};h.prototype.setDimensions=function(l,m){"use strict";this._request.width=l;this._request.height=m;return this};h.prototype.setResizeMode=function(l){"use strict";if(![c("PhotoResizeModeConst").COVER,c("PhotoResizeModeConst").CONTAIN].includes(l))throw new TypeError("ImageSourceRequest.setResizeMode: invalid resize mode "+l);this._request.resize_mode=l;return this};h.prototype.setCallback=function(l){"use strict";this._callback=l;return this};h.prototype.send=function(){"use strict";if(!this._request.fbid||!this._request.width||!this._request.height||!this._request.type||!this._request.resize_mode||!this._callback)throw new Error("ImageSourceRequest: You must set all the fields");var l=j(),m=k(this._request);l.executeOrEnqueue(m,this._callback);if(l.getUnavailableResourcesFromRequest(m).length===1){c("MercuryServerDispatcher").trySend("/ajax/image_source.php",{requests:[this._request]});return true}return false};var i=null;function j(){if(i)return i;var l=new(c("KeyedCallbackManager"))();i=l;c("MercuryServerDispatcher").registerEndpoints({"/ajax/image_source.php":{request_user_id:c("CurrentUser").getID(),mode:c("MercuryServerDispatcher").BATCH_DEFERRED_MULTI,batch_function:function m(n,o){var p;(p=n.requests).push.apply(p,o.requests);return n},handler:function m(n,o){var p=o.getData().requests;for(var q=0;q<p.length;++q)l.setResource(k(p[q]),n[q])}}});return l}function k(l){return[l.fbid,l.type,l.width,l.height,l.resize_mode].join("|")}f.exports=h}),null);
__d("MercurySendErrorLogger",["Banzai","BanzaiLogger"],(function a(b,c,d,e,f,g){var h=c("BanzaiLogger").create({retry:true}),i=c("Banzai").isEnabled("mercury_send_error_logging"),j={log:function k(l){if(!i)return;var m={message_id:l.message_id,timestamp_client:Date.now(),error_type:l.error_data.type,error_code:l.error_data.code,error_description:l.error_data.description,is_transient:l.error_data.is_transient};h.log("MercurySendErrorLoggerConfig",m)}};f.exports=j}),null);
__d("MercuryServerPayloadPreprocessor",["invariant","MessengerEnvironment","MercuryIDs","MercuryActionStatus","MercuryActionType","MercuryAttachment","MercuryDispatcher","MercurySendErrorLogger","MercurySingletonProvider","MercuryThreadIDMap","URI"],(function a(b,c,d,e,f,g,h){"use strict";function i(k){this.$MercuryServerPayloadPreprocessor1=k;this.$MercuryServerPayloadPreprocessor2=c("MercuryThreadIDMap").getForFBID(this.$MercuryServerPayloadPreprocessor1);this.$MercuryServerPayloadPreprocessor3=c("MercuryDispatcher").getForFBID(this.$MercuryServerPayloadPreprocessor1)}i.getForFBID=function(k){return j.getForFBID(k)};i.get=function(){return j.get()};i.prototype.handleUpdate=function(k){var l={};!k.from_client||h(0);(k.threads||[]).forEach(function(x){this.$MercuryServerPayloadPreprocessor4(x,l);var y=this.$MercuryServerPayloadPreprocessor2.getServerIDFromClientIDNow(x.thread_id);e(["MercuryServerRequests"],function(z){var A=z.getForFBID(this.$MercuryServerPayloadPreprocessor1);A.markThreadFetched(x.thread_id);if(y)A.markThreadFetched(y);A.updateLastActionTimestamp(x.timestamp)}.bind(this))}.bind(this));(k.ordered_threadlists||[]).forEach(function(x){var y=x.thread_fbids||[];y=y.concat(x.other_user_fbids||[]);x.thread_ids=y.map(function(z){return this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(z.toString())}.bind(this))}.bind(this));if(k.pinned_threads&&k.pinned_threads.thread_fbids)k.pinned_threads.thread_fbids=k.pinned_threads.thread_fbids.map(function(x){return this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(x)}.bind(this));if(k.delivery_receipts){var m={};for(var n=k.delivery_receipts,o=Array.isArray(n),p=0,n=o?n:n[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var q;if(o){if(p>=n.length)break;q=n[p++]}else{p=n.next();if(p.done)break;q=p.value}var r=q,s=r.other_user_fbid?c("MercuryIDs").getThreadIDFromUserID(r.other_user_fbid):this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(r.thread_fbid);if(s)m[s]=r.time}k.delivery_receipts=m}k.actions=k.actions||[];k.actions.forEach(function(x){if(x.action_type===c("MercuryActionType").SEND_MESSAGE&&x.status===c("MercuryActionStatus").ERROR)c("MercurySendErrorLogger").log(x);var y=null,z=null;if(x.other_user_fbid){z=c("MercuryIDs").getThreadIDFromUserID(x.other_user_fbid);y=x.other_user_fbid}else if(x.thread_fbid){z=c("MercuryIDs").getThreadIDFromThreadFBID(x.thread_fbid);y=x.thread_fbid}else if(x.thread_id){z=c("MercuryIDs").getThreadIDFromThreadFBID(x.thread_id);y=x.thread_id}else if(x.status&&x.status!=c("MercuryActionStatus").SUCCESS&&x.client_thread_id)z=x.client_thread_id;else h(0);y=y&&y.toString();x.thread_id=this.$MercuryServerPayloadPreprocessor2.hasClientIDForServerID(y)?this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(y):z;if(x.action_type==c("MercuryActionType").SEND_MESSAGE&&x.client_thread_id&&y){x.thread_id=x.client_thread_id;this.$MercuryServerPayloadPreprocessor2.forceSetServerIDToClientID(y,x.client_thread_id);l[y]=x.client_thread_id}x.thread_id||h(0);if(!k.payload_source||!k.payload_source.startsWith("server"))e(["MercuryServerRequests"],function(A){A.getForFBID(this.$MercuryServerPayloadPreprocessor1).updateLastActionTimestamp(x.timestamp)}.bind(this))}.bind(this));this.$MercuryServerPayloadPreprocessor5(k);this.$MercuryServerPayloadPreprocessor6(k);if(k.end_of_history){var t=[];for(var u=0;u<k.end_of_history.length;u++){var v=k.end_of_history[u];if(v.type=="user")t.push("user:"+v.fbid);else if(v.type=="thread"&&this.$MercuryServerPayloadPreprocessor2.hasClientIDForServerID(v.fbid))t.push(this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(v.fbid))}k.end_of_history=t}if(k.roger){var w={};Object.keys(k.roger).forEach(function(x){var y=Object.keys(k.roger[x]),z=void 0;if(x)z=this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(x);else if(y.length===1)z=c("MercuryIDs").getThreadIDFromUserID(y[0]);if(z){var A=k.roger[x];w[z]={};for(var B in A)if(Object.prototype.hasOwnProperty.call(A,B)){var C=c("MercuryIDs").getParticipantIDFromUserID(B);w[z][C]=A[B]}}}.bind(this));k.roger=w}k.newlyAddedClientIDs=l;k.preprocessed=true;this.$MercuryServerPayloadPreprocessor3.handleUpdate(k)};i.prototype.$MercuryServerPayloadPreprocessor4=function(k,l){var m=k.other_user_fbid?k.other_user_fbid:k.thread_fbid;m||h(0);var n=this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(m);if(!n){n=k.other_user_fbid?c("MercuryIDs").getThreadIDFromUserID(k.other_user_fbid):c("MercuryIDs").getThreadIDFromThreadFBID(k.thread_fbid);this.$MercuryServerPayloadPreprocessor2.setServerIDToClientID(m,n);this.$MercuryServerPayloadPreprocessor2.setDeprecatedServerIDToClientID(k.thread_id,n);l[m]=n}k.thread_id=n};i.prototype.$MercuryServerPayloadPreprocessor5=function(k){k.actions.forEach(function(l){if(l.action_type===c("MercuryActionType").USER_GENERATED_MESSAGE){l.attachments=l.attachments||[];l.attachments.forEach(function(m){if(c("MercuryAttachment").isShareAttachment(m)&&c("MessengerEnvironment").messengerui){var n=new(c("URI"))(m.share.uri);if(!n.getDomain())m.share.uri=n.setDomain("facebook.com").setSubdomain(c("URI").getRequestURI().getSubdomain()).setProtocol("https").toString()}})}})};i.prototype.$MercuryServerPayloadPreprocessor6=function(k){k.actions.forEach(function(l){if(l.action_type!==c("MercuryActionType").USER_GENERATED_MESSAGE)return;var m=l;if(!m.has_attachment||!m.attachments)return;for(var n=m.attachments.length-1;n>=0;n-=1){var o=m.attachments[n];if(!o.share||!o.share.style_list||o.share.style_list[0]!="genie_message")continue;if(o.share.target.genie_id)m.author=c("MercuryIDs").getParticipantIDFromUserID(o.share.target.genie_id);if(o.share.target&&!o.share.target.attachment){m.attachments.splice(n,1);m.has_attachment=m.attachments.length>0}}})};var j=new(c("MercurySingletonProvider"))(i);f.exports=i}),null);
__d("MercuryErrorType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({SERVER:1,TRANSPORT:2,TIMEOUT:3})}),null);
__d("MercuryMessageIDs",["KeyedCallbackManager"],(function a(b,c,d,e,f,g){"use strict";var h=new(c("KeyedCallbackManager"))(),i={getServerIDs:function j(k,l){var m=k.filter(function(o){return o.indexOf("id")===-1}),n=function n(o){var p=k.map(function(q){return o[q]?o[q]:q});l(p)};return h.executeOrEnqueue(m,n)},addServerID:function j(k,l){h.setResource(k,l)}};f.exports=i}),null);
__d("MercuryServerSendMessageQueueOptions",[],(function a(b,c,d,e,f,g){function h(i,j,k,l,m,n){"use strict";this.success_handler=i;this.error_handler=j;this.transport_error_handler=k;this.timeout_handler=l;this.timeout=m;this.connection_retries=n}f.exports=h}),null);
__d("MercuryServerSendMessageQueueSimulatedError",["AsyncRequest","AsyncResponse"],(function a(b,c,d,e,f,g){var h=9999,i={create:function j(k){var l=new(c("AsyncRequest"))(this.endpoint_uri).setData({message_batch:[k],client:this.client}),m=new(c("AsyncResponse"))(l,{});Object.assign(m,{error:h,silentError:false,transientError:true,request:l});return m}};f.exports=i}),null);
__d("XMessagingSendController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/messaging/send/",{})}),null);
__d("MercuryServerSendMessageQueue",["fbt","BanzaiODS","ChatReliabilityInstrumentation","LogHistory","MercuryLoggingHelper","MercuryServerRequestsConfig","Run","MercuryServerDispatcher","MercuryServerSendMessageQueueSimulatedError","XMessagingSendController"],(function a(b,c,d,e,f,g,h){"use strict";var i=c("LogHistory").getInstance("mercury_server_send_message_queue");function j(k,l,m,n){var o;this.pending_message=null;this.queue=[];this.$MercuryServerSendMessageQueue5=function(){if(this.queue.length||this.pending_message)return h._("A\u00fan no enviaste el mensaje. \u00bfQuieres salir sin enviarlo?");return undefined}.bind(this);this.sender_id=k;this.queue_id=l;this.$MercuryServerSendMessageQueue2=m.success_handler;this.$MercuryServerSendMessageQueue1=m.error_handler;this.$MercuryServerSendMessageQueue4=m.transport_error_handler;this.$MercuryServerSendMessageQueue3=m.timeout_handler;this.client=n;c("Run").onBeforeUnload(this.$MercuryServerSendMessageQueue5,false);var p=null;if(c("MercuryServerRequestsConfig").msgrRegion)p={name:"X-MSGR-Region",value:c("MercuryServerRequestsConfig").msgrRegion};var q=c("XMessagingSendController").getURIBuilder().getURI().toString(),r=(o={},o[q]={request_user_id:this.sender_id,endpoint_id:this.queue_id,mode:c("MercuryServerDispatcher").IMMEDIATE,customHeader:p,handler:this.handleSuccess.bind(this),error_handler:this.handleError.bind(this),transport_error_handler:this.handleTransportError.bind(this),timeout:m.timeout,timeout_handler:this.handleTimeout.bind(this),connection_retries:m.connection_retries},o);c("MercuryServerDispatcher").registerEndpoints(r)}j.prototype.enqueue=function(k){this.queue.push(k);this.$MercuryServerSendMessageQueue6()};j.prototype.$MercuryServerSendMessageQueue6=function(){if(this.pending_message||!this.queue.length){if(this.pending_message)this.$MercuryServerSendMessageQueue7();return}this.pending_message=this.queue.shift();var k={client:this.client,action_type:this.pending_message.action_type,app_id:this.pending_message.app_id,audio_ids:this.pending_message.audio_ids,body:this.pending_message.body,client_thread_id:this.pending_message.client_thread_id,content_attachment:this.pending_message.content_attachment,ephemeral_ttl_mode:this.pending_message.ephemeral_ttl_mode,file_ids:this.pending_message.file_ids,gif_ids:this.pending_message.gif_ids,has_attachment:this.pending_message.has_attachment,image_ids:this.pending_message.image_ids,location_attachment:this.pending_message.location_attachment,lightweight_action_attachment:this.pending_message.lightweight_action_attachment,log_message_data:this.pending_message.log_message_data,log_message_type:this.pending_message.log_message_type,message_id:this.pending_message.message_id,message_source_data:this.pending_message.message_source_data,montage_reply_data:this.pending_message.montage_reply_data,offline_threading_id:this.pending_message.offline_threading_id,other_user_fbid:this.pending_message.other_user_fbid,photo_fbids:this.pending_message.photo_fbids,shareable_attachment:this.pending_message.shareable_attachment,signature_id:this.pending_message.signatureID,source:this.pending_message.source,specific_to_list:this.pending_message.specific_to_list,sticker_id:this.pending_message.sticker_id,tags:this.pending_message.tags,thread_fbid:this.pending_message.thread_fbid,timestamp:this.pending_message.timestamp,ui_push_phase:this.pending_message.ui_push_phase,video_ids:this.pending_message.video_ids,platform_xmd:this.pending_message.platform_xmd,profile_xmd:this.pending_message.profile_xmd};for(var l in k)if(k[l]===undefined||k[l]===null)delete k[l];if(!k.action_type){var m=c("MercuryLoggingHelper").obfuscateMessage(k);c("ChatReliabilityInstrumentation").logERROR("missing action type before sending to send controller");i.debug("missing_action_type",JSON.stringify(m))}if(!k.message_id){var n=c("MercuryLoggingHelper").obfuscateMessage(k);c("ChatReliabilityInstrumentation").logERROR("missing action type before sending to send controller"+JSON.stringify(n));i.debug("missing_message_id",JSON.stringify(n))}c("MercuryServerDispatcher").trySend(c("XMessagingSendController").getURIBuilder().getURI().toString(),k,null,this.sender_id,this.queue_id)};j.prototype.$MercuryServerSendMessageQueue8=function(){while(this.queue.length)this.$MercuryServerSendMessageQueue9(this.queue.shift())};j.prototype.$MercuryServerSendMessageQueue9=function(k){this.$MercuryServerSendMessageQueue1(c("MercuryServerSendMessageQueueSimulatedError").create(k));i.error("mark_as_failed",JSON.stringify({fbid:this.sender_id,queue_id:this.queue_id,message:c("MercuryLoggingHelper").obfuscateMessage(k)}))};j.prototype.handleSuccess=function(k,l){this.$MercuryServerSendMessageQueue2(k,l);this.pending_message=null;this.$MercuryServerSendMessageQueue6()};j.prototype.handleError=function(k){this.$MercuryServerSendMessageQueue1(k);this.$MercuryServerSendMessageQueue8();this.pending_message=null};j.prototype.handleTransportError=function(k){this.$MercuryServerSendMessageQueue4(k);this.$MercuryServerSendMessageQueue8();this.pending_message=null};j.prototype.handleTimeout=function(k){this.$MercuryServerSendMessageQueue3(k);this.$MercuryServerSendMessageQueue8();this.pending_message=null};j.prototype.$MercuryServerSendMessageQueue7=function(){i.debug("maybe_send_next_pending_message",JSON.stringify({fbid:this.sender_id,queue_id:this.queue_id,pending_message:c("MercuryLoggingHelper").obfuscateMessage(this.pending_message),queue:this.queue.map(function(l){return c("MercuryLoggingHelper").obfuscateMessage(l)})}));var k="send_queue.delayed.queue_length."+this.queue.length.toString();c("BanzaiODS").bumpEntityKey("chat.web",k)};f.exports=j}),null);
__d("MercurySingletonMixin",["CurrentUser"],(function a(b,c,d,e,f,g){var h={_getInstances:function i(){if(!this._instances)this._instances={};return this._instances},get:function i(){return this.getForFBID(c("CurrentUser").getID())},getForFBID:function i(j){var k=this._getInstances();if(!k[j])k[j]=new this(j);return k[j]}};f.exports=h}),null);
__d("MercuryServerSendMessageQueueRouter",["BanzaiODS","LogHistory","Map","MercuryServerSendMessageQueue","MercurySingletonMixin"],(function a(b,c,d,e,f,g){var h=c("LogHistory").getInstance("mercury_server_send_message_queue_router"),i="chat.web.send_queue_router";c("BanzaiODS").setEntitySample(i,.1);function j(k){"use strict";this.queues=new(c("Map"))();this.fbid=k}j.prototype.enqueue=function(k,l,m,n){"use strict";var o=this.queues.get(k);if(o===undefined){o=new(c("MercuryServerSendMessageQueue"))(this.fbid,k,l,m);this.queues.set(k,o);h.debug("added queue",JSON.stringify({fbid:this.fbid,queue_id:k}));c("BanzaiODS").bumpEntityKey(i,"new_queue")}o.enqueue(n)};Object.assign(j,c("MercurySingletonMixin"));f.exports=j}),null);
__d("MercurySyncConstants",[],(function a(b,c,d,e,f,g){"use strict";var h={ARBITER_EVENT_INVALID_STATE:"SYNC:INVALID_STATE",ARBITER_EVENT_INVALID_STATE_RETRY:"SYNC:INVALID_STATE_RETRY",ARBITER_EVENT_INVALID_STATE_RECOVER:"SYNC:INVALID_STATE_RECOVER",ARBITER_EVENT_SERVER_REQUESTS_FAIL:"NET:SERVER_REQUESTS_FAIL",ARBITER_EVENT_SERVER_REQUESTS_RECOVER:"NET:SERVER_REQUESTS_RECOVER"};f.exports=h}),null);
__d("MercurySyncDeltaHolder",["Map","MercurySingletonProvider"],(function a(b,c,d,e,f,g){"use strict";function h(){this.$MercurySyncDeltaHolder2=new(c("Map"))();this.$MercurySyncDeltaHolder3=[];this.$MercurySyncDeltaHolder1=0}h.getForFBID=function(j){return i.getForFBID(j)};h.get=function(){return i.get()};h.prototype.peek=function(){this.$MercurySyncDeltaHolder3=this.$MercurySyncDeltaHolder3.sort(function(j,k){return j-k});return this.$MercurySyncDeltaHolder3[0]};h.prototype.getTop=function(){this.$MercurySyncDeltaHolder3=this.$MercurySyncDeltaHolder3.sort(function(j,k){return j-k});return this.$MercurySyncDeltaHolder3.reverse()[0]};h.prototype.pop=function(){this.$MercurySyncDeltaHolder3=this.$MercurySyncDeltaHolder3.sort(function(l,m){return l-m});if(this.$MercurySyncDeltaHolder3.length===0)return undefined;var j=this.$MercurySyncDeltaHolder3.shift(),k=this.$MercurySyncDeltaHolder2.get(j);this.$MercurySyncDeltaHolder2["delete"](j);return{seqID:j,delta:k}};h.prototype.push=function(j,k){if(this.$MercurySyncDeltaHolder2.has(j))return;this.$MercurySyncDeltaHolder2.set(j,k);this.$MercurySyncDeltaHolder3.push(j)};h.prototype.getLastSeqID=function(){return this.$MercurySyncDeltaHolder1};h.prototype.updateLastSeqID=function(j){this.$MercurySyncDeltaHolder1=j};var i=new(c("MercurySingletonProvider"))(h);f.exports=h}),null);
__d("PageMessageEnumTag",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({FLAG:"flag",IMPORTANT:"important",LOW_VALUE:"low_value",SPAM_SPOOFING:"spam_spoofing",JOB_APPLICATION:"job_application",CONFIRMED_APPOINTMENT:"confirmed_appointment",PENDING_APPOINTMENT:"pending_appointment",REQUESTED_APPOINTMENT:"requested_appointment",MESSENGER_ADS:"messenger_ads"})}),null);
__d("XMercuryUnseenThreadIDsController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/mercury/unseen_thread_ids/",{})}),null);
__d("XMessagingChangeMentionsMuteModeController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/ajax/mercury/change_mentions_mute_thread/",{})}),null);
__d("XMessagingChangeReactionsMuteModeController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/ajax/mercury/change_reactions_mute_thread/",{})}),null);
__d("MercuryServerRequests",["errorCode","invariant","Arbiter","AsyncResponse","BanzaiODS","ChannelConstants","ChatReliabilityInstrumentation","CurrentUser","FBJSON","EventProfiler","LogHistory","MercuryActionStatus","MercuryActionType","MercuryAPIArgsSource","MercuryAssert","MercuryConfig","MercuryDispatcher","MercuryErrorType","MercuryGlobalActionType","MercuryIDs","MercuryLogMessageType","MercuryMessageClientState","MercuryPayloadSource","MercurySendErrorLogger","MercuryServerPayloadPreprocessor","MercuryServerRequestsConfig","MercuryServerSendMessageQueueRouter","MercuryServerURIs","MercurySingletonProvider","MercurySourceType","MercurySyncDeltaHolder","MercurySyncConstants","MercuryThreadIDMap","MercuryThreadlistConstants","MercuryMessageIDs","MessagingConfig","MessagingTag","PageMessageEnumTag","MercuryServerSendMessageQueueOptions","MercuryServerDispatcher","Set","XMercuryUnseenThreadIDsController","XMessagingChangeMentionsMuteModeController","XMessagingChangeReactionsMuteModeController","createObjectFrom","ifRequired","setTimeoutAcrossTransitions"],(function a(b,c,d,e,f,g,h,i){"use strict";var j=c("LogHistory").getInstance("mercury_server"),k=c("MercuryAPIArgsSource").MERCURY,l=1e3,m=30*1e3,n=true;function o(z){return z.getError()?"_"+z.getError():""}function p(z,A){var B=babelHelpers["extends"]({},z),C=void 0;if(A.threads){if(!B.threads)B.threads={};for(C in A.threads)B.threads[C]=Object.keys(c("createObjectFrom")((B.threads[C]||[]).concat(A.threads[C]||[])))}if(A.messages){if(!B.messages)B.messages={};for(C in A.messages){if(!B.messages[C])B.messages[C]={};for(var D in A.messages[C])if(B.messages[C][D])B.messages[C][D]=t(B.messages[C][D],A.messages[C][D]);else B.messages[C][D]=A.messages[C][D]}}B.client=z.client||A.client;return B}function q(z,A){var B=Object.assign(c("createObjectFrom")(z.folders,true),c("createObjectFrom")(A.folders,true)),C=z.client||A.client;return{folders:Object.keys(B),client:C}}function r(z,A){for(var B in A)if(z[B]&&typeof z[B]==="object")z[B]=t(z[B],A[B]);else if(A[B]&&typeof A[B]==="object"){var C={};Object.assign(C,A[B]);z[B]=C}return z}function s(z,A){return A}function t(z,A){var B=z.offset<A.offset?z.offset:A.offset,C=z.offset+z.limit,D=A.offset+A.limit,E=C>D?C:D,F=E-B,G=z.timestamp>A.timestamp?z.timestamp:A.timestamp;return{offset:B,limit:F,timestamp:G}}function u(z,A){var B=z.client||A.client,C={ids:{},client:B};Object.assign(C.ids,z.ids,A.ids);return C}function v(z,A){var B={},C=void 0,D=z.client||A.client;delete z.client;delete A.client;for(C in z)Object.assign(B,c("createObjectFrom")(z[C],C));for(C in A)Object.assign(B,c("createObjectFrom")(A[C],C));var E={client:D};for(var F in B){C=B[F];if(!E[C])E[C]=[];E[C].push(F)}return E}function w(z,A){var B=z.client||A.client,C=c("createObjectFrom")(z.ids,true),D=c("createObjectFrom")(A.ids,true),E=Object.assign(C,D);return{ids:Object.keys(E),client:B}}function x(z){this.$MercuryServerRequests1=z;this.$MercuryServerRequests2=0;this.$MercuryServerRequests3={};this.$MercuryServerRequests4={};this.$MercuryServerRequests9=new(c("Set"))();this.__threadIDMap=c("MercuryThreadIDMap").getForFBID(this.$MercuryServerRequests1);this.$MercuryServerRequests5=c("MercuryDispatcher").getForFBID(this.$MercuryServerRequests1);this.$MercuryServerRequests6=c("MercuryServerPayloadPreprocessor").getForFBID(this.$MercuryServerRequests1);this.$MercuryServerRequests7=new(c("MercuryServerSendMessageQueueOptions"))(function(A,B){this.__handleUpdate(A,B)}.bind(this),function(A){return this.$MercuryServerRequests10(A)}.bind(this),function(A){this.$MercuryServerRequests11(A)}.bind(this),function(A){return this.$MercuryServerRequests12(A)}.bind(this),c("MercuryServerRequestsConfig").sendMessageTimeout,c("MessagingConfig").SEND_CONNECTION_RETRIES);this.$MercuryServerRequests8=c("MercurySyncDeltaHolder").getForFBID(this.$MercuryServerRequests1);this.$MercuryServerRequests13()}x.getForFBID=function(z){return y.getForFBID(z)};x.get=function(){return y.get()};x.prototype.fetchThreadlistInfo=function(z,A){var B=arguments.length<=2||arguments[2]===undefined?c("MessagingTag").INBOX:arguments[2],C=arguments[3],D,E=this,F=arguments.length<=4||arguments[4]===undefined?k:arguments[4],G=arguments[5];if(n){var D=function(){n=false;c("EventProfiler").tagCurrentActiveInteractionsAs("FirstMercuryThreadFetch");var J=false;c("ifRequired")("MercuryJewelBootloadModulesWithEagerFetch",function(K){J=K.isFetching();if(J)K.afterFetchThreadListInfo(this.$MercuryServerRequests6.handleUpdate.bind(this.$MercuryServerRequests6))}.bind(E));if(J)return{v:void 0}}();if(typeof D==="object")return D.v}var H=C?c("MercuryServerDispatcher").IMMEDIATE:null,I={client:F};I[B]={offset:z,limit:A,filter:C,before:G};this.__sendRequest(c("MercuryServerURIs").THREADLIST_INFO,I,H)};x.prototype.fetchUnseenThreadIDs=function(){var z=arguments.length<=0||arguments[0]===undefined?c("MessagingTag").INBOX:arguments[0],A=arguments.length<=1||arguments[1]===undefined?k:arguments[1];this.__sendRequest(c("XMercuryUnseenThreadIDsController").getURIBuilder().getURI().toString(),{})};x.prototype.fetchUnreadThreadIDs=function(z){var A=arguments.length<=1||arguments[1]===undefined?k:arguments[1];this.__sendRequest(c("MercuryServerURIs").UNREAD_THREADS,{folders:[z],client:A})};x.prototype.fetchThreadData=function(z){var A=arguments.length<=1||arguments[1]===undefined?k:arguments[1];c("MercuryAssert").allThreadID(z);var B={threads:{},client:A},C=[],D=[];z.forEach(function(F){if(this.$MercuryServerRequests3[F])return;this.$MercuryServerRequests3[F]=true;var G=this.__threadIDMap.getServerIDFromClientIDNow(F),H=c("MercuryIDs").tokenize(F);if(H.type=="user"){C.push(H.value);B.threads.user_ids=C}else if(H.type=="thread"){if(G)D.push(G);else D.push(H.value);B.threads.thread_fbids=D}else if(H.type=="root"){if(G){D.push(G);B.threads.thread_fbids=D}}else if(H.type!="pending")throw new Error("Unknown thread type",H)}.bind(this));this.$MercuryServerRequests5.inform("fetch-thread-data",B);if(B.threads.user_ids)B.threads.user_ids.forEach(function(F){if(!F){j.error("empty user id",JSON.stringify(C));c("ChatReliabilityInstrumentation").logERROR("Invalid user ID sent to thread_info.php: "+JSON.stringify(C))}});if(B.threads.thread_fbids)B.threads.thread_fbids.forEach(function(F){if(!F)c("ChatReliabilityInstrumentation").logERROR("Invalid FBID sent to thread_info.php: "+JSON.stringify(z))});for(var E in B.threads){this.__sendRequest(c("MercuryServerURIs").THREAD_INFO,B);break}};x.prototype.ensureThreadIsFetched=function(z){var A=arguments.length<=1||arguments[1]===undefined?k:arguments[1];if(!this.__threadIDMap.getClientIDFromServerIDNow(z)&&!this.$MercuryServerRequests3[z]){if(!z){c("ChatReliabilityInstrumentation").logERROR("Ensure invalid FBID sent to thread_info.php");j.error("attempting to fetch empty thread_fbid. Bad idea!");return}this.$MercuryServerRequests3[z]=true;this.__sendRequest(c("MercuryServerURIs").THREAD_INFO,{threads:{thread_fbids:[z]},client:A})}};x.prototype.fetchThreadMessages=function(z,A,B,C,D){var E=arguments.length<=5||arguments[5]===undefined?k:arguments[5];c("MercuryAssert").isThreadID(z);var F=void 0,G=void 0,H=c("MercuryIDs").tokenize(z),I=this.__threadIDMap.getServerIDFromClientIDNow(z),J=false;if(I){F=I;G=H.type=="user"?"user_ids":"thread_fbids"}else{F=H.value;switch(H.type){case"user":G="user_ids";J=true;break;case"thread":G="thread_fbids";break}}var K={messages:{},threads:{},client:E};if(G){K.messages[G]={};K.messages[G][F]={offset:A,timestamp:C,limit:B};if(J)K.threads[G]=[F];this.__sendRequest(c("MercuryServerURIs").THREAD_INFO,K,D)}else this.__threadIDMap.getServerIDFromClientID(z,function(L){K.messages.thread_fbids={};K.messages.thread_fbids[L]={offset:A,timestamp:C,limit:B};this.__sendRequest(c("MercuryServerURIs").THREAD_INFO,K,D)}.bind(this))};x.prototype.handleThreadInfoError=function(z,A){var B,C=this,D=z.getData(),E=[];if(D.messages){for(var F in D.messages.thread_fbids){var G=this.__threadIDMap.getClientIDFromServerIDNow(F);if(G)E.push(this.$MercuryServerRequests14(G))}for(var H in D.messages.user_ids)E.push(this.$MercuryServerRequests14("user:"+H));for(var I in D.messages.group_ids)E.push(this.$MercuryServerRequests14("group:"+I))}if(E.length)this.$MercuryServerRequests5.handleUpdate({actions:E,from_client:true,payload_source:c("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});if(D.threads&&(D.threads.user_ids||D.threads.thread_fbids||D.threads.group_ids||D.threads.thread_ids)){var J=5,K=true;if(!D.retry_count){D.retry_count=0;if(D.messages)delete D.messages}else if(D.retry_count>=J&&(!A||!c("MercuryConfig").MR4E)){K=false;(D.threads.thread_ids||[]).concat(D.threads.thread_fbids||[]).forEach(function(M){if(M in this.$MercuryServerRequests3)delete this.$MercuryServerRequests3[M]},this)}[].concat(D.threads.thread_ids||[],D.threads.thread_fbids||[],D.threads.user_ids||[],D.threads.group_ids||[]).forEach(function(M){if(M)this.$MercuryServerRequests9.add(M);else c("ChatReliabilityInstrumentation").logERROR("lost a thread id somehow")}.bind(this));if(K){var L=Math.pow(2,Math.min(D.retry_count,J))*1e3;c("setTimeoutAcrossTransitions")(function(){j.log("retry_thread","{}");this.__sendRequest(c("MercuryServerURIs").THREAD_INFO,D)}.bind(this),L);D.retry_count++}if(this.$MercuryServerRequests9.size)(function(){var M=[];C.$MercuryServerRequests9.forEach(function(N){return M.push(N)});j.debug("failed threads",JSON.stringify(M));c("Arbiter").inform(c("MercurySyncConstants").ARBITER_EVENT_SERVER_REQUESTS_FAIL,M)})()}};x.prototype.markFolderAsRead=function(z){this.__sendRequest(c("MercuryServerURIs").MARK_FOLDER_READ,{folder:z});var A=[{action_type:c("MercuryGlobalActionType").MARK_ALL_READ,folder:z}];this.$MercuryServerRequests5.handleUpdate({global_actions:A,from_client:true,payload_source:c("MercuryPayloadSource").CLIENT_CHANGE_READ_STATUS})};x.prototype.changeThreadReadStatus=function(z,A,B,C,D,E){c("MercuryAssert").isThreadID(z);this.__threadIDMap.getServerIDFromClientID(z,function(F){var G,H={ids:(G={},G[F]=A,G),source:B,watermarkTimestamp:C,shouldSendReadReceipt:D,commerce_last_message_type:E};j.log("initiate_change_read_status",JSON.stringify({thread_id:z,thread_fbid:F,mark_as_read:A,watermarkTimestamp:C}));this.__sendRequest(c("MercuryServerURIs").CHANGE_READ_STATUS,H)}.bind(this))};x.prototype.changeThreadArchivedStatus=function(z,A,B){c("MercuryAssert").isThreadID(z);this.__threadIDMap.getServerIDFromClientID(z,function(C){var D={ids:{},source:B};D.ids[C]=A;this.__sendRequest(c("MercuryServerURIs").CHANGE_ARCHIVED_STATUS,D)}.bind(this))};x.prototype.changeThreadFolder=function(z,A){c("MercuryAssert").isThreadID(z);this.__threadIDMap.getServerIDFromClientID(z,function(B){var C={};C[A]=[B];this.__sendRequest(c("MercuryServerURIs").MOVE_THREAD,C)}.bind(this))};x.prototype.changeMutingOnThread=function(z,A){c("MercuryAssert").isThreadID(z);this.__threadIDMap.getServerIDFromClientID(z,function(B){this.__sendRequest(c("MercuryServerURIs").CHANGE_MUTE_THREAD,{thread_fbid:B,mute_settings:A,payload_source:k})}.bind(this))};x.prototype.changeMentionsMutingOnThread=function(z,A){c("MercuryAssert").isThreadID(z);this.__threadIDMap.getServerIDFromClientID(z,function(B){this.__sendRequest(c("XMessagingChangeMentionsMuteModeController").getURIBuilder().getURI(),{thread_fbid:B,mentions_mute_mode:A,payload_source:k})}.bind(this))};x.prototype.changeReactionsMutingOnThread=function(z,A){c("MercuryAssert").isThreadID(z);this.__threadIDMap.getServerIDFromClientID(z,function(B){this.__sendRequest(c("XMessagingChangeReactionsMuteModeController").getURIBuilder().getURI(),{thread_fbid:B,reactions_mute_mode:A,payload_source:k})}.bind(this))};x.prototype.markThreadSpam=function(z,A){c("MercuryAssert").isThreadID(z);this.__threadIDMap.getServerIDFromClientID(z,function(B){this.__sendRequest(c("MercuryServerURIs").MARK_SPAM,{id:B,source:A})}.bind(this))};x.prototype.unmarkThreadSpam=function(z,A){c("MercuryAssert").isThreadID(z);this.__threadIDMap.getServerIDFromClientID(z,function(B){this.__sendRequest(c("MercuryServerURIs").UNMARK_SPAM,{id:B,source:A})}.bind(this))};x.prototype.deleteThread=function(z,A){c("MercuryAssert").isThreadID(z);this.__threadIDMap.getServerIDFromClientID(z,function(B){var C={ids:[B],source:A};this.__sendRequest(c("MercuryServerURIs").DELETE_THREAD,C)}.bind(this))};x.prototype.deleteMessages=function(z,A){c("MercuryMessageIDs").getServerIDs(A||[],function(B){this.__sendRequest(c("MercuryServerURIs").DELETE_MESSAGES,{message_ids:B})}.bind(this))};x.prototype.sendDeliveryReceipts=function(z,A){c("MercuryMessageIDs").getServerIDs(z||[],function(B){this.__sendRequest(c("MercuryServerURIs").DELIVERY_RECEIPTS,{message_ids:B,thread_ids:A})}.bind(this))};x.prototype.sendNewMessage=function(z){var A=arguments.length<=1||arguments[1]===undefined?k:arguments[1];if(!z.offline_threading_id)c("BanzaiODS").bumpEntityKey("chat.web","missing_otid_on_send");if(z.client_state&&z.client_state!==c("MercuryMessageClientState").SEND_TO_SERVER)return;var B=c("MercuryIDs").tokenize(z.thread_id),C=B.type,D=babelHelpers["extends"]({},z);D.thread_id=null;if(C=="user"){D.other_user_fbid=B.value;this.$MercuryServerRequests15(D,A)}else if(C=="thread"){D.thread_fbid=B.value;this.$MercuryServerRequests15(D,A)}else if(C=="root"&&B.value==D.offline_threading_id){D.client_thread_id=z.thread_id;this.$MercuryServerRequests15(D,A)}else{c("MercuryIDs").isLocalThread(z.thread_id)||i(0);this.__threadIDMap.getServerIDFromClientID(z.thread_id,function(E){D.thread_fbid=E;this.$MercuryServerRequests15(D,A)}.bind(this))}c("ChatReliabilityInstrumentation").logMESSAGE_SEND_START(c("FBJSON").stringify({otid:D.offline_threading_id,message_id:D.message_id,other_user_fbid:D.other_user_fbid,sender_page_fbid:!D.creator_info?null:D.creator_info.pageID}))};x.prototype.$MercuryServerRequests15=function(z,A){c("Arbiter").inform(c("ChannelConstants").ATTEMPT_RECONNECT);this.$MercuryServerRequests4[z.message_id]=Date.now();c("MercuryServerSendMessageQueueRouter").getForFBID(this.$MercuryServerRequests1).enqueue(z.other_user_fbid||z.thread_fbid||z.client_thread_id,this.$MercuryServerRequests7,A,z)};x.prototype.markSeen=function(){var z=this.$MercuryServerRequests2;this.__sendRequest(c("MercuryServerURIs").MARK_SEEN,{seen_timestamp:z})};x.prototype.$MercuryServerRequests16=function(z,A,B,C){var D=z.getData(),E=D.message_batch||[D];j.debug("handle_send_message_error_common",JSON.stringify({reliability_error_status:B,request_error_status:A,error_data:C,message_list:E}));var F=E.map(function(H){var I={action_type:c("MercuryActionType").SEND_MESSAGE,other_user_fbid:H.other_user_fbid,thread_fbid:H.thread_fbid,client_message_id:H.message_id,message_id:H.message_id,client_thread_id:H.client_thread_id,status:A,error_data:C};return I});F.forEach(function(H){if(H.action_type===c("MercuryActionType").SEND_MESSAGE&&H.status===c("MercuryActionStatus").ERROR)this.__logMercurySendError(H)},this);var G={actions:F,payload_source:c("MercuryPayloadSource").CLIENT_HANDLE_ERROR};this.$MercuryServerRequests6.handleUpdate(G)};x.prototype.handleSendMessageError=function(z){var A=z.getPayload(),B=null,C=null;if(A&&A.error_payload){B=c("MercuryActionStatus").UNCONFIRMED;C="send_error"}else{B=c("MercuryActionStatus").ERROR;C="request_error"+o(z)}var D=z.error;if(D===1404102)c("AsyncResponse").verboseErrorHandler(z);var E=/<.*>/.test(z.getErrorDescription())?z.getErrorSummary():z.getErrorDescription();this.$MercuryServerRequests16(z.getRequest(),B,C,{type:c("MercuryErrorType").SERVER,code:z.getError(),description:E,is_transient:z.isTransient()})};x.prototype.handleSendMessageTransportError=function(z){this.$MercuryServerRequests16(z.getRequest(),c("MercuryActionStatus").ERROR,"transport_error"+o(z),{type:c("MercuryErrorType").TRANSPORT,code:z.getError(),is_transient:true})};x.prototype.handleSendMessageTimeout=function(z){this.$MercuryServerRequests16(z,c("MercuryActionStatus").ERROR,"transport_timeout",{type:c("MercuryErrorType").TIMEOUT,is_transient:true})};x.prototype.getLastActionTimestamp=function(){return this.$MercuryServerRequests2};x.prototype.__logMercurySendError=function(z){c("MercurySendErrorLogger").log(z)};x.prototype.updateLastActionTimestamp=function(z){var A=Date.now()-1e3*60*60*24;if(z&&z>A)this.$MercuryServerRequests2=Math.max(this.$MercuryServerRequests2,z)};x.prototype.markThreadFetched=function(z){delete this.$MercuryServerRequests3[z];if(this.$MercuryServerRequests9["delete"](z)&&!this.$MercuryServerRequests9.size){j.debug("no_failed_threads","{}");c("Arbiter").inform(c("MercurySyncConstants").ARBITER_EVENT_SERVER_REQUESTS_RECOVER)}};x.prototype.$MercuryServerRequests14=function(z){return{action_type:c("MercuryActionType").LOG_MESSAGE,thread_id:z,message_id:z,timestamp:Date.now(),is_unread:false,source:c("MercurySourceType").UNKNOWN,log_message_body:"",log_message_type:c("MercuryLogMessageType").SERVER_ERROR,log_message_data:{}}};x.prototype.__getForAsyncRequest=function(z){var A=z.getData(),B=A.request_user_id?A.request_user_id:c("CurrentUser").getID();return x.getForFBID(B)};x.prototype.__handleUpdate=function(z,A){this.__getForAsyncRequest(A).$MercuryServerRequests6.handleUpdate(z)};x.prototype.$MercuryServerRequests17=function(z){var A=this.__getForAsyncRequest(z);A.handleThreadInfoError(z)};x.prototype.$MercuryServerRequests18=function(z){var A=this.__getForAsyncRequest(z);A.handleThreadInfoError(z,true)};x.prototype.$MercuryServerRequests10=function(z){var A=this.__getForAsyncRequest(z.getRequest());A.handleSendMessageError(z)};x.prototype.$MercuryServerRequests11=function(z){var A=this.__getForAsyncRequest(z.getRequest());A.handleSendMessageTransportError(z)};x.prototype.$MercuryServerRequests12=function(z){var A=this.__getForAsyncRequest(z);A.handleSendMessageTimeout(z)};x.prototype.$MercuryServerRequests13=function(){var z,A=null;if(c("MercuryServerRequestsConfig").msgrRegion)A={name:"X-MSGR-Region",value:c("MercuryServerRequestsConfig").msgrRegion};var B=(z={},z[c("MercuryServerURIs").THREAD_INFO]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").BATCH_DEFERRED_MULTI,customHeader:A,batch_function:p,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this),error_handler:function(F){return this.$MercuryServerRequests17(F.getRequest())}.bind(this),timeout_handler:function(F){return this.$MercuryServerRequests18(F)}.bind(this),timeout:m},z[c("MercuryServerURIs").MARK_FOLDER_READ]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").IMMEDIATE,customHeader:A,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z[c("MercuryServerURIs").CHANGE_READ_STATUS]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").IMMEDIATE,customHeader:A,handler:function(F,G){this.__handleUpdate(F,G);var H=(F.threads||[]).map(function(I){return I&&I.thread_id});j.log("response_change_read_status",JSON.stringify({threads:H}))}.bind(this)},z[c("MercuryServerURIs").MARK_SEEN]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:A,batch_function:s,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z[c("MercuryServerURIs").THREADLIST_INFO]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").BATCH_SUCCESSIVE_UNIQUE,customHeader:A,batch_function:r,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z[c("MercuryServerURIs").MARK_SPAM]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").IMMEDIATE,customHeader:A,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z[c("MercuryServerURIs").UNMARK_SPAM]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").IMMEDIATE,customHeader:A,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z[c("MercuryServerURIs").UNREAD_THREADS]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").BATCH_SUCCESSIVE_UNIQUE,customHeader:A,batch_function:q,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z[c("MercuryServerURIs").CHANGE_ARCHIVED_STATUS]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:A,batch_function:u,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z[c("MercuryServerURIs").DELETE_THREAD]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:A,batch_function:w,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z[c("MercuryServerURIs").DELETE_MESSAGES]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").IMMEDIATE,customHeader:A,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z[c("MercuryServerURIs").DELIVERY_RECEIPTS]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").IMMEDIATE,customHeader:A,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z[c("MercuryServerURIs").MOVE_THREAD]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:A,batch_function:v,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z[c("MercuryServerURIs").CHANGE_MUTE_THREAD]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").IMMEDIATE,customHeader:A,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z),C=c("XMercuryUnseenThreadIDsController").getURIBuilder().getURI().toString();B[C]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").IMMEDIATE,customHeader:A,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)};var D=c("XMessagingChangeMentionsMuteModeController").getURIBuilder().getURI().toString();B[D]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").IMMEDIATE,customHeader:A,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)};var E=c("XMessagingChangeReactionsMuteModeController").getURIBuilder().getURI().toString();B[E]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").IMMEDIATE,customHeader:A,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)};c("MercuryServerDispatcher").registerEndpoints(B)};x.prototype.__sendRequest=function(z,A,B){if(c("MercuryConfig").MessengerCachiusUseClientSeqIDWWW)switch(z){case c("MercuryServerURIs").THREADLIST_INFO:case c("MercuryServerURIs").THREAD_INFO:A.cachius_min_seq_id=this.$MercuryServerRequests8.getLastSeqID();break;default:break}c("MercuryServerDispatcher").trySend(z,A,B,this.$MercuryServerRequests1)};x.prototype.__getFBID=function(){return this.$MercuryServerRequests1};var y=new(c("MercurySingletonProvider"))(x);f.exports=x}),null);
__d("MercuryThreadIDMap",["KeyedCallbackManager","MercuryAssert","MercuryIDs","MercurySingletonProvider"],(function a(b,c,d,e,f,g){"use strict";function h(j){this.$MercuryThreadIDMap1=j;this.$MercuryThreadIDMap2=new(c("KeyedCallbackManager"))();this.$MercuryThreadIDMap3=new(c("KeyedCallbackManager"))()}h.getForFBID=function(j){return i.getForFBID(j)};h.get=function(){return i.get()};h.prototype.setServerIDToClientID=function(j,k){var l=this.getClientIDFromServerIDNow(j);if(l){l!==k;return}this.forceSetServerIDToClientID(j,k)};h.prototype.forceSetServerIDToClientID=function(j,k){this.$MercuryThreadIDMap2.setResource(j,k);this.$MercuryThreadIDMap3.setResource(k,j)};h.prototype.setDeprecatedServerIDToClientID=function(j,k){if(j)this.$MercuryThreadIDMap2.setResource(j,k)};h.prototype.getClientIDFromServerIDNow=function(j){return this.$MercuryThreadIDMap2.getResource(j)};h.prototype.getClientIDFromServerID=function(j,k){this.$MercuryThreadIDMap2.executeOrEnqueue(j,k);e(["MercuryServerRequests"],function(l){l.getForFBID(this.$MercuryThreadIDMap1).ensureThreadIsFetched(j)}.bind(this))};h.prototype.getServerIDFromClientIDNow=function(j){return this.$MercuryThreadIDMap3.getResource(j)};h.prototype.getServerIDFromClientID=function(j,k){c("MercuryAssert").isThreadID(j);var l=this.$MercuryThreadIDMap3.executeOrEnqueue(j,k);e(["MercuryServerRequests"],function(m){var n=this.$MercuryThreadIDMap3.getUnavailableResources(l),o=c("MercuryIDs").tokenize(j);if(n.length&&o.type!="root")m.getForFBID(this.$MercuryThreadIDMap1).fetchThreadData(n)}.bind(this))};h.prototype.hasClientIDForServerID=function(j){return!!this.getClientIDFromServerIDNow(j)};h.prototype.convertThreadIDIfAvailable=function(j){var k=this.getClientIDFromServerIDNow(j);return k||j};h.prototype.canLinkExternally=function(j){c("MercuryAssert").isThreadID(j);var k=c("MercuryIDs").tokenize(j);return k.type=="user"||!!this.getServerIDFromClientIDNow(j)};var i=new(c("MercurySingletonProvider"))(h);f.exports=h}),null);
__d("MercuryParticipantFetcher",["LogHistory","MercuryIDs","MercuryPayloadSource","MercuryServerPayloadPreprocessor","Set","ShortProfiles","setImmediate","setTimeoutAcrossTransitions"],(function a(b,c,d,e,f,g){"use strict";var h=c("LogHistory").getInstance("short_profiles");function i(k){this.$MercuryParticipantFetcher4=c("MercuryServerPayloadPreprocessor").getForFBID(k);this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2=new(c("Set"))();this.$MercuryParticipantFetcher3=new(c("Set"))();this.$MercuryParticipantFetcher5=setInterval(this.$MercuryParticipantFetcher7.bind(this),20*1e3)}i.prototype.fetch=function(k){this.$MercuryParticipantFetcher8(k);this.$MercuryParticipantFetcher7()};i.prototype.fetchMulti=function(k){if(k.length){k.forEach(function(l){return this.$MercuryParticipantFetcher8(l)}.bind(this));this.$MercuryParticipantFetcher7()}};i.prototype.$MercuryParticipantFetcher8=function(k){if(!this.$MercuryParticipantFetcher3.has(k))this.$MercuryParticipantFetcher2.add(k)};i.prototype.$MercuryParticipantFetcher7=function(){if(this.$MercuryParticipantFetcher1||this.$MercuryParticipantFetcher2.size===0)return;this.$MercuryParticipantFetcher1=true;c("setImmediate")(function(){this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2.forEach(function(k){return this.$MercuryParticipantFetcher3.add(k)}.bind(this));this.$MercuryParticipantFetcher9(this.$MercuryParticipantFetcher2,function(k){k.forEach(function(l){return this.$MercuryParticipantFetcher3["delete"](l.id)}.bind(this));this.$MercuryParticipantFetcher10(k);if(this.$MercuryParticipantFetcher6)clearTimeout(this.$MercuryParticipantFetcher6)}.bind(this));this.$MercuryParticipantFetcher11();this.$MercuryParticipantFetcher2.clear()}.bind(this))};i.prototype.$MercuryParticipantFetcher11=function(){this.$MercuryParticipantFetcher6=c("setTimeoutAcrossTransitions")(function(){this.$MercuryParticipantFetcher3.forEach(function(k){return this.$MercuryParticipantFetcher2.add(k)}.bind(this));this.$MercuryParticipantFetcher3.clear()}.bind(this),11*1e3)};i.prototype.$MercuryParticipantFetcher9=function(k,l){var m=[];k.forEach(function(n){var o=c("MercuryIDs").tokenize(n),p=o.type,q=o.value;p==="fbid"&&m.push(q)});if(m.length>0){c("ShortProfiles").getMulti(m,function(n){var o=[];for(var p in n)o.push(j(n[p],p));l(o);if(o.length!==m.length)h.error("server_fetch_participant_count_error",JSON.stringify({expectedIDs:m,receivedIDs:Object.keys(n)}))});h.debug("client_fetch_participants",JSON.stringify({userIDs:m}))}};i.prototype.$MercuryParticipantFetcher10=function(k){this.$MercuryParticipantFetcher4.handleUpdate({participants:k,from_client:false,payload_source:c("MercuryPayloadSource").SERVER_FETCH_PARTICIPANTS})};function j(k,l){var m=babelHelpers["extends"]({gender:k.gender,fbid:k.id||l,href:k.uri,id:c("MercuryIDs").getParticipantIDFromUserID(k.id||l),image_src:k.thumbSrc,name:k.name,short_name:k.firstName,employee:k.employee,is_employee_away:k.is_employee_away,type:k.type,vanity:k.vanity,is_friend:k.is_friend,is_messenger_user:k.is_messenger_user},{});if(k.officeStatus){m.officeStatus=k.officeStatus;m.officeStatusEndDate=k.officeStatusEndDate;m.officeStatusComment=k.officeStatusComment;m.officeStatusLocation=k.officeStatusLocation}if(k.timezone||k.timezone===0)m.timezone=k.timezone;if(k.personal_id)m.personal_id=k.personal_id;if(k.work_id)m.work_id=k.work_id;return m}f.exports=i}),null);
__d("bs_char",["bs_caml_string","bs_caml_builtin_exceptions"],(function a(b,c,d,e,f,g){"use strict";function h(m){if(m<0||m>255)throw[c("bs_caml_builtin_exceptions").invalid_argument,"Char.chr"];else return m}function i(m){var n=0;if(m>=40)if(m!==92)n=m>=127?1:2;else return"\\\\";else if(m>=32)if(m>=39)return"\\'";else n=2;else if(m>=14)n=1;else switch(m){case 8:return"\\b";case 9:return"\\t";case 10:return"\\n";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 11:case 12:n=1;break;case 13:return"\\r"}switch(n){case 1:var o=new Array(4);o[0]=92;o[1]=48+(m/100|0)|0;o[2]=48+(m/10|0)%10|0;o[3]=48+m%10|0;return c("bs_caml_string").bytes_to_string(o);case 2:var p=new Array(1);p[0]=m;return c("bs_caml_string").bytes_to_string(p)}}function j(m){if(m>=65&&m<=90||m>=192&&m<=214||m>=216&&m<=222)return m+32|0;else return m}function k(m){if(m>=97&&m<=122||m>=224&&m<=246||m>=248&&m<=254)return m-32|0;else return m}function l(m,n){return m-n|0}g.chr=h;g.escaped=i;g.lowercase=j;g.uppercase=k;g.compare=l}),null);
__d("bs_bytes",["bs_char","bs_list","bs_curry","bs_caml_obj","bs_caml_int32","bs_pervasives","bs_caml_string","bs_caml_builtin_exceptions"],(function a(aa,b,ba,ca,da,c){"use strict";function d(P,Q){var R=b("bs_caml_string").caml_create_string(P);b("bs_caml_string").caml_fill_string(R,0,P,Q);return R}function e(P,Q){var R=b("bs_caml_string").caml_create_string(P);for(var S=0,T=P-1|0;S<=T;++S)R[S]=b("bs_curry")._1(Q,S);return R}var f=[];function g(P){var Q=P.length,R=b("bs_caml_string").caml_create_string(Q);b("bs_caml_string").caml_blit_bytes(P,0,R,0,Q);return R}function h(P){return b("bs_caml_string").bytes_to_string(g(P))}function i(P){return g(b("bs_caml_string").bytes_of_string(P))}function j(P,Q,R){if(Q<0||R<0||Q>(P.length-R|0))throw[b("bs_caml_builtin_exceptions").invalid_argument,"String.sub / Bytes.sub"];else{var S=b("bs_caml_string").caml_create_string(R);b("bs_caml_string").caml_blit_bytes(P,Q,S,0,R);return S}}function k(P,Q,R){return b("bs_caml_string").bytes_to_string(j(P,Q,R))}function l(P,Q,R){var S=(P.length+Q|0)+R|0,T=b("bs_caml_string").caml_create_string(S),U=Q<0?[-Q|0,0]:[0,Q],V=U[1],W=U[0],X=b("bs_pervasives").min(P.length-W|0,S-V|0);if(X>0)b("bs_caml_string").caml_blit_bytes(P,W,T,V,X);return T}function m(P,Q,R,S){if(Q<0||R<0||Q>(P.length-R|0))throw[b("bs_caml_builtin_exceptions").invalid_argument,"String.fill / Bytes.fill"];else return b("bs_caml_string").caml_fill_string(P,Q,R,S)}function n(P,Q,R,S,T){if(T<0||Q<0||Q>(P.length-T|0)||S<0||S>(R.length-T|0))throw[b("bs_caml_builtin_exceptions").invalid_argument,"Bytes.blit"];else return b("bs_caml_string").caml_blit_bytes(P,Q,R,S,T)}function o(P,Q,R,S,T){if(T<0||Q<0||Q>(P.length-T|0)||S<0||S>(R.length-T|0))throw[b("bs_caml_builtin_exceptions").invalid_argument,"String.blit / Bytes.blit_string"];else return b("bs_caml_string").caml_blit_string(P,Q,R,S,T)}function p(P,Q){for(var R=0,S=Q.length-1|0;R<=S;++R)b("bs_curry")._1(P,Q[R]);return 0}function q(P,Q){for(var R=0,S=Q.length-1|0;R<=S;++R)b("bs_curry")._2(P,R,Q[R]);return 0}function r(P,Q){if(Q){var R=Q[0],S=[0],T=[0];b("bs_list").iter(function(W){S[0]=S[0]+1|0;T[0]=T[0]+W.length|0;return 0},Q);var U=b("bs_caml_string").caml_create_string(T[0]+b("bs_caml_int32").imul(P.length,S[0]-1|0)|0);b("bs_caml_string").caml_blit_bytes(R,0,U,0,R.length);var V=[R.length];b("bs_list").iter(function(W){b("bs_caml_string").caml_blit_bytes(P,0,U,V[0],P.length);V[0]=V[0]+P.length|0;b("bs_caml_string").caml_blit_bytes(W,0,U,V[0],W.length);V[0]=V[0]+W.length|0;return 0},Q[1]);return U}else return f}function s(P,Q){return P.concat(Q)}function t(P){var Q=P-9|0;if(Q>4||Q<0)if(Q!==23)return 0;else return 1;else if(Q!==2)return 1;else return 0}function u(P){var Q=P.length,R=0;while(R<Q&&t(P[R]))R=R+1|0;var S=Q-1|0;while(S>=R&&t(P[S]))S=S-1|0;if(S>=R)return j(P,R,(S-R|0)+1|0);else return f}function v(P){var Q=0;for(var R=0,S=P.length-1|0;R<=S;++R){var T=P[R],U;if(T>=32){var V=T-34|0;U=V>58||V<0?V>=93?4:1:V>57||V<1?2:1}else U=T>=11?T!==13?4:2:T>=8?2:4;Q=Q+U|0}if(Q===P.length)return g(P);else{var W=b("bs_caml_string").caml_create_string(Q);Q=0;for(var X=0,Y=P.length-1|0;X<=Y;++X){var Z=P[X],$=0;if(Z>=35)if(Z!==92)if(Z>=127)$=1;else W[Q]=Z;else $=2;else if(Z>=32)if(Z>=34)$=2;else W[Q]=Z;else if(Z>=14)$=1;else switch(Z){case 8:W[Q]=92;Q=Q+1|0;W[Q]=98;break;case 9:W[Q]=92;Q=Q+1|0;W[Q]=116;break;case 10:W[Q]=92;Q=Q+1|0;W[Q]=110;break;case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 11:case 12:$=1;break;case 13:W[Q]=92;Q=Q+1|0;W[Q]=114;break}switch($){case 1:W[Q]=92;Q=Q+1|0;W[Q]=48+(Z/100|0)|0;Q=Q+1|0;W[Q]=48+(Z/10|0)%10|0;Q=Q+1|0;W[Q]=48+Z%10|0;break;case 2:W[Q]=92;Q=Q+1|0;W[Q]=Z;break}Q=Q+1|0}return W}}function w(P,Q){var R=Q.length;if(R){var S=b("bs_caml_string").caml_create_string(R);for(var T=0,U=R-1|0;T<=U;++T)S[T]=b("bs_curry")._1(P,Q[T]);return S}else return Q}function x(P,Q){var R=Q.length;if(R){var S=b("bs_caml_string").caml_create_string(R);for(var T=0,U=R-1|0;T<=U;++T)S[T]=b("bs_curry")._2(P,T,Q[T]);return S}else return Q}function y(P){return w(b("bs_char").uppercase,P)}function z(P){return w(b("bs_char").lowercase,P)}function A(P,Q){if(Q.length){var R=g(Q);R[0]=b("bs_curry")._1(P,Q[0]);return R}else return Q}function B(P){return A(b("bs_char").uppercase,P)}function C(P){return A(b("bs_char").lowercase,P)}function D(P,Q,R,S){while(true){var T=R;if(T>=Q)throw b("bs_caml_builtin_exceptions").not_found;else if(P[T]===S)return T;else{R=T+1|0;continue}}}function E(P,Q){return D(P,P.length,0,Q)}function F(P,Q,R){var S=P.length;if(Q<0||Q>S)throw[b("bs_caml_builtin_exceptions").invalid_argument,"String.index_from / Bytes.index_from"];else return D(P,S,Q,R)}function G(P,Q,R){while(true){var S=Q;if(S<0)throw b("bs_caml_builtin_exceptions").not_found;else if(P[S]===R)return S;else{Q=S-1|0;continue}}}function H(P,Q){return G(P,P.length-1|0,Q)}function I(P,Q,R){if(Q<-1||Q>=P.length)throw[b("bs_caml_builtin_exceptions").invalid_argument,"String.rindex_from / Bytes.rindex_from"];else return G(P,Q,R)}function J(P,Q,R){var S=P.length;if(Q<0||Q>S)throw[b("bs_caml_builtin_exceptions").invalid_argument,"String.contains_from / Bytes.contains_from"];else try{D(P,S,Q,R);return 1}catch(T){if(T===b("bs_caml_builtin_exceptions").not_found)return 0;else throw T}}function K(P,Q){return J(P,0,Q)}function L(P,Q,R){if(Q<0||Q>=P.length)throw[b("bs_caml_builtin_exceptions").invalid_argument,"String.rcontains_from / Bytes.rcontains_from"];else try{G(P,Q,R);return 1}catch(S){if(S===b("bs_caml_builtin_exceptions").not_found)return 0;else throw S}}var M=b("bs_caml_obj").caml_compare,N=b("bs_caml_string").bytes_to_string,O=b("bs_caml_string").bytes_of_string;c.make=d;c.init=e;c.empty=f;c.copy=g;c.of_string=i;c.to_string=h;c.sub=j;c.sub_string=k;c.extend=l;c.fill=m;c.blit=n;c.blit_string=o;c.concat=r;c.cat=s;c.iter=p;c.iteri=q;c.map=w;c.mapi=x;c.trim=u;c.escaped=v;c.index=E;c.rindex=H;c.index_from=F;c.rindex_from=I;c.contains=K;c.contains_from=J;c.rcontains_from=L;c.uppercase=y;c.lowercase=z;c.capitalize=B;c.uncapitalize=C;c.compare=M;c.unsafe_to_string=N;c.unsafe_of_string=O}),null);
__d("bs_string",["bs_list","bs_bytes","bs_caml_int32","bs_caml_string"],(function a(b,c,d,e,f,g){"use strict";function h(H,I){return c("bs_caml_string").bytes_to_string(c("bs_bytes").make(H,I))}function i(H,I){return c("bs_caml_string").bytes_to_string(c("bs_bytes").init(H,I))}function j(H){return c("bs_caml_string").bytes_to_string(c("bs_bytes").copy(c("bs_caml_string").bytes_of_string(H)))}function k(H,I,J){return c("bs_caml_string").bytes_to_string(c("bs_bytes").sub(c("bs_caml_string").bytes_of_string(H),I,J))}function l(H,I){if(I){var J=I[0],K=[0],L=[0];c("bs_list").iter(function(O){K[0]=K[0]+1|0;L[0]=L[0]+O.length|0;return 0},I);var M=c("bs_caml_string").caml_create_string(L[0]+c("bs_caml_int32").imul(H.length,K[0]-1|0)|0);c("bs_caml_string").caml_blit_string(J,0,M,0,J.length);var N=[J.length];c("bs_list").iter(function(O){c("bs_caml_string").caml_blit_string(H,0,M,N[0],H.length);N[0]=N[0]+H.length|0;c("bs_caml_string").caml_blit_string(O,0,M,N[0],O.length);N[0]=N[0]+O.length|0;return 0},I[1]);return c("bs_caml_string").bytes_to_string(M)}else return""}function m(H,I){return c("bs_bytes").iter(H,c("bs_caml_string").bytes_of_string(I))}function n(H,I){return c("bs_bytes").iteri(H,c("bs_caml_string").bytes_of_string(I))}function o(H,I){return c("bs_caml_string").bytes_to_string(c("bs_bytes").map(H,c("bs_caml_string").bytes_of_string(I)))}function p(H,I){return c("bs_caml_string").bytes_to_string(c("bs_bytes").mapi(H,c("bs_caml_string").bytes_of_string(I)))}function q(H){var I=H-9|0;if(I>4||I<0)if(I!==23)return 0;else return 1;else if(I!==2)return 1;else return 0}function r(H){if(H===""||!(q(H.charCodeAt(0))||q(H.charCodeAt(H.length-1|0))))return H;else return c("bs_caml_string").bytes_to_string(c("bs_bytes").trim(c("bs_caml_string").bytes_of_string(H)))}function s(H){var I=function I(J){while(true){var K=J;if(K>=H.length)return 0;else{var L=H.charCodeAt(K);if(L>=32){var M=L-34|0;if(M>58||M<0)if(M>=93)return 1;else{J=K+1|0;continue}else if(M>57||M<1)return 1;else{J=K+1|0;continue}}else return 1}}};if(I(0))return c("bs_caml_string").bytes_to_string(c("bs_bytes").escaped(c("bs_caml_string").bytes_of_string(H)));else return H}function t(H,I){return c("bs_bytes").index(c("bs_caml_string").bytes_of_string(H),I)}function u(H,I){return c("bs_bytes").rindex(c("bs_caml_string").bytes_of_string(H),I)}function v(H,I,J){return c("bs_bytes").index_from(c("bs_caml_string").bytes_of_string(H),I,J)}function w(H,I,J){return c("bs_bytes").rindex_from(c("bs_caml_string").bytes_of_string(H),I,J)}function x(H,I){return c("bs_bytes").contains(c("bs_caml_string").bytes_of_string(H),I)}function y(H,I,J){return c("bs_bytes").contains_from(c("bs_caml_string").bytes_of_string(H),I,J)}function z(H,I,J){return c("bs_bytes").rcontains_from(c("bs_caml_string").bytes_of_string(H),I,J)}function A(H){return c("bs_caml_string").bytes_to_string(c("bs_bytes").uppercase(c("bs_caml_string").bytes_of_string(H)))}function B(H){return c("bs_caml_string").bytes_to_string(c("bs_bytes").lowercase(c("bs_caml_string").bytes_of_string(H)))}function C(H){return c("bs_caml_string").bytes_to_string(c("bs_bytes").capitalize(c("bs_caml_string").bytes_of_string(H)))}function D(H){return c("bs_caml_string").bytes_to_string(c("bs_bytes").uncapitalize(c("bs_caml_string").bytes_of_string(H)))}var E=c("bs_caml_string").caml_string_compare,F=c("bs_bytes").fill,G=c("bs_bytes").blit_string;g.make=h;g.init=i;g.copy=j;g.sub=k;g.fill=F;g.blit=G;g.concat=l;g.iter=m;g.iteri=n;g.map=o;g.mapi=p;g.trim=r;g.escaped=s;g.index=t;g.rindex=u;g.index_from=v;g.rindex_from=w;g.contains=x;g.contains_from=y;g.rcontains_from=z;g.uppercase=A;g.lowercase=B;g.capitalize=C;g.uncapitalize=D;g.compare=E}),null);
__d("mercuryVanityIDMapRe",["bs_string","bs_js_primitive","MercuryAssert","bs_js_null_undefined"],(function a(b,c,d,e,f,g){"use strict";var h={},i={};function j(o){return c("bs_js_null_undefined").from_opt(c("bs_js_primitive").undefined_to_opt(h[c("bs_string").lowercase(o)]))}function k(o){return c("bs_js_null_undefined").from_opt(c("bs_js_primitive").undefined_to_opt(i[o]))}function l(o){var p=i[o];if(p!==undefined)return true;else return false}function m(o){var p=h[c("bs_string").lowercase(o)];if(p!==undefined)return true;else return false}function n(o,p){c("MercuryAssert").isParticipantID(p);var q=c("bs_string").lowercase(o);h[q]=p;i[p]=q;return 0}g.vanityToID=h;g.idToVanity=i;g.getID=j;g.getVanity=k;g.hasID=l;g.hasVanity=m;g.set=n}),null);
__d("MercuryParticipants",["fbt","CurrentUser","EventEmitter","ImageSourceRequest","ImageSourceType","ImmutableObject","KeyedCallbackManager","MercuryAssert","MercuryIDs","MercuryParticipantFetcher","MercuryParticipantTypes","MercuryParticipantsConstants","MercuryDispatcher","mercuryVanityIDMapRe","PhotoResizeModeConst","Set","createObjectFrom"],(function a(b,c,d,e,f,g,h){"use strict";var i="change";function j(l){this.$MercuryParticipants1=l;this.$MercuryParticipants2=new(c("EventEmitter"))();this.$MercuryParticipants3=new(c("KeyedCallbackManager"))();this.$MercuryParticipants4=new(c("MercuryParticipantFetcher"))(this.$MercuryParticipants1);this.$MercuryParticipants5=c("MercuryDispatcher").getForFBID(this.$MercuryParticipants1);this.$MercuryParticipants5.subscribe("update-participants",function(m,n){if(n.participants&&n.participants.length>0)this.$MercuryParticipants6(n.participants)}.bind(this));this.$MercuryParticipants5.subscribe("invalidate-global-state",function(){this.$MercuryParticipants7()}.bind(this))}j.prototype.addListener=function(l,m){return this.$MercuryParticipants2.addListener(l,m)};j.prototype.getIDFromVanityOrFBID=function(l){if(!l)return null;if(c("mercuryVanityIDMapRe").hasVanity(l))return c("mercuryVanityIDMapRe").getID(l);if(/^\d+$/.test(l))return c("MercuryIDs").getParticipantIDFromUserID(l);return undefined};j.prototype.getNow=function(l){return this.$MercuryParticipants8(l)};j.prototype.getOrFetch=function(l){var m=this.$MercuryParticipants8(l);if(!m)this.$MercuryParticipants4.fetch(l);return m};j.prototype.get=function(l,m){c("MercuryAssert").isParticipantID(l);return this.$MercuryParticipants9([l],function(n){m(n[l])})};j.prototype.getMulti=function(l,m){return this.$MercuryParticipants9(l,m)};j.prototype.getBigImageMulti=function(l,m){var n=arguments.length<=2||arguments[2]===undefined?c("MercuryParticipantsConstants").BIG_IMAGE_SIZE:arguments[2];c("MercuryAssert").allParticipantIDs(l);var o=false,p=this.$MercuryParticipants9(l,function(q){var r={},s=0,t=new(c("Set"))(),u=function(w,y){s++;r[w]=y;if(s===l.length){if(!o)m(r);if(t.size>0)this.$MercuryParticipants10(t)}}.bind(this),v=function(w,y){var z=this.$MercuryParticipants3.getResource(w);if(!z)return;this.$MercuryParticipants3.setResource(w,c("ImmutableObject").set(z,{big_image_src:y.uri}));t.add(w);u(w,y.uri)}.bind(this);for(var w in q){var x=q[w];if(!x.big_image_src)new(c("ImageSourceRequest"))().setFBID(c("MercuryIDs").getUserIDFromParticipantID(w)).setType(c("ImageSourceType").PROFILE_PICTURE).setDimensions(n,n).setResizeMode(c("PhotoResizeModeConst").COVER).setCallback(v.bind(null,w)).send();else u(x.id,x.big_image_src)}}.bind(this));return{remove:function q(){o=true;p.remove()}}};j.prototype.getOrderedBigImageMulti=function(l,m){return this.getBigImageMulti(l,function(n){m(l.map(function(o){return n[o]}))})};j.prototype.$MercuryParticipants9=function(l,m){c("MercuryAssert").allParticipantIDs(l);var n=this.$MercuryParticipants3.executeOrEnqueue(l,m),o=this.$MercuryParticipants3.getUnavailableResources(n).filter(function(p){var q=c("MercuryIDs").tokenize(p),r=q.type,s=q.value;if(r==="email"){this.$MercuryParticipants11(p,s);return false}if(r==="name"){this.$MercuryParticipants12(p,s);return false}return true}.bind(this));this.$MercuryParticipants4.fetchMulti(o);return this.$MercuryParticipants13(n)};j.prototype.$MercuryParticipants8=function(l){var m=this.$MercuryParticipants3.getResource(l);if(!m){var n=c("MercuryIDs").tokenize(l),o=n.type,p=n.value;if(o==="email")m=this.$MercuryParticipants11(l,p);if(o==="name")m=this.$MercuryParticipants12(l,p)}return m};j.prototype.$MercuryParticipants11=function(l,m){var n=new(c("ImmutableObject"))(k(l,m));this.$MercuryParticipants3.setResource(l,n);return n};j.prototype.$MercuryParticipants12=function(l,m){var n=new(c("ImmutableObject"))({gender:c("MercuryParticipantsConstants").UNKNOWN_GENDER,href:null,id:l,image_src:c("MercuryParticipantsConstants").EMAIL_IMAGE,big_image_src:c("MercuryParticipantsConstants").EMAIL_IMAGE,name:m,short_name:m,employee:false});this.$MercuryParticipants3.setResource(l,n);return n};j.prototype.$MercuryParticipants10=function(l){this.$MercuryParticipants2.emit(i,l)};j.prototype.$MercuryParticipants6=function(l){var m=l.map(function(n){return n.id});l=l.map(function(n){if(n.vanity)c("mercuryVanityIDMapRe").set(n.vanity,n.id);var o=this.$MercuryParticipants3.getResource(n.id);return o?c("ImmutableObject").set(o,n):new(c("ImmutableObject"))(this.$MercuryParticipants14(n))}.bind(this));this.$MercuryParticipants3.addResourcesAndExecute(c("createObjectFrom")(m,l));this.$MercuryParticipants10(new(c("Set"))(m))};j.prototype.$MercuryParticipants14=function(l){var m=l.type===c("MercuryParticipantTypes").USER||l.type===c("MercuryParticipantTypes").FRIEND;if(!m)return l;if(!l.name&&!l.href&&!l.vanity){var n=h._("Usuario de Facebook");l.name=n;l.short_name=n}return l};j.prototype.$MercuryParticipants13=function(l){return{remove:function(){this.$MercuryParticipants3.unsubscribe(l)}.bind(this)}};j.prototype.$MercuryParticipants7=function(){this.$MercuryParticipants3=new(c("KeyedCallbackManager"))()};function k(l,m){return{gender:c("MercuryParticipantsConstants").UNKNOWN_GENDER,href:null,id:l,image_src:c("MercuryParticipantsConstants").EMAIL_IMAGE,big_image_src:c("MercuryParticipantsConstants").EMAIL_IMAGE,name:m,short_name:m,employee:false,fbid:undefined,accepts_messenger_user_feedback:undefined,is_business_enabled:undefined,is_messenger_platform_bot:undefined,is_employee_away:undefined,is_friend:undefined,is_messenger_user:undefined,is_verified:undefined,type:undefined,vanity:undefined,timezone:undefined,personal_id:undefined,work_id:undefined}}f.exports=new j(c("CurrentUser").getID())}),null);
__d("MercurySyncDeltaTypes",[],(function a(b,c,d,e,f,g){"use strict";var h={AdminAddedToGroupThread:"AdminAddedToGroupThread",AdminRemovedFromGroupThread:"AdminRemovedFromGroupThread",AdminTextMessage:"AdminTextMessage",ChangeViewerStatus:"ChangeViewerStatus",DeliveryReceipt:"DeliveryReceipt",ForcedFetch:"ForcedFetch",MarkRead:"MarkRead",MarkUnread:"MarkUnread",MarkFolderSeen:"MarkFolderSeen",MessageDelete:"MessageDelete",NewMessage:"NewMessage",NoOp:"NoOp",PagesManagerEvent:"PagesManagerEvent",ParticipantLeftGroupThread:"ParticipantLeftGroupThread",ParticipantsAddedToGroupThread:"ParticipantsAddedToGroupThread",ReadReceipt:"ReadReceipt",ReplaceMessage:"ReplaceMessage",RTCEventLog:"RTCEventLog",ThreadAction:"ThreadAction",ThreadDelete:"ThreadDelete",ThreadFolder:"ThreadFolder",ThreadMuteSettings:"ThreadMuteSettings",ThreadName:"ThreadName",JoinableMode:"JoinableMode",ApprovalMode:"ApprovalMode",ApprovalQueue:"ApprovalQueue",ClientPayload:"ClientPayload",GenieMessage:"GenieMessage",MontageMessage:"MontageMessage",RtcCallData:"RtcCallData"};f.exports=h}),null);
__d("MercurySyncFakeDFFSender",["Arbiter","ChannelConstants","MercurySingletonProvider","MercurySyncDeltaTypes"],(function a(b,c,d,e,f,g){"use strict";var h=c("ChannelConstants").getArbiterType(c("ChannelConstants").FAKE_DFF);i.getForFBID=function(k){return j.getForFBID(k)};i.get=function(){return j.get()};function i(k){this.$MercurySyncFakeDFFSender1=k}i.prototype.sendGlobalDFF=function(){c("Arbiter").inform(h,{obj:{delta:{"class":c("MercurySyncDeltaTypes").ForcedFetch},queue:this.$MercurySyncFakeDFFSender1}})};i.prototype.sendThreadDFF=function(k,l){c("Arbiter").inform(h,{obj:{delta:{"class":c("MercurySyncDeltaTypes").ForcedFetch,threadKey:{otherUserFbId:k,threadFbId:l}},queue:this.$MercurySyncFakeDFFSender1}})};var j=new(c("MercurySingletonProvider"))(i);f.exports=i}),null);
__d("MessengerThreadCannotReplyReason",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({BLOCKED:"blocked",COMPOSER_DISABLED_BOT:"composer_disabled_bot",HAS_EMAIL_PARTICIPANT:"has_email_participant",OBJECT_ORIGINATED:"object_originated",READ_ONLY:"read_only",VIEWER_NOT_SUBSCRIBED:"viewer_not_subscribed",RECIPIENTS_NOT_LOADABLE:"recipients_not_loadable",RECIPIENTS_UNAVAILABLE:"recipients_unavailable",RECIPIENTS_INVALID:"recipients_invalid",RECIPIENTS_INACTIVE_WORK_ACC:"recipients_inactive_work_account",MONTAGE_NOT_AUTHOR:"montage_not_author"})}),null);
__d("MercuryThreadInfo",["CurrentUser","MercuryIDs","MessengerThreadCannotReplyReason"],(function a(b,c,d,e,f,g){"use strict";var h={canReply:function j(k){return!!(k.is_subscribed&&(k.can_reply===undefined||k.can_reply)&&!k.has_email_participant&&!k.read_only)},getMuteSetting:function j(k){return!k.mute_until?undefined:k.mute_until},isEmptyLocalThread:function j(k){return c("MercuryIDs").tokenize(k.thread_id).type==="root"&&!k.timestamp},isMuted:function j(k){return h.getMuteSetting(k)!==undefined},areMentionsMuted:function j(k){return k.mentions_mute_mode===1},areReactionsMuted:function j(k){return k.reactions_mute_mode===1},isNewEmptyLocalThread:function j(k){return!!(h.isEmptyLocalThread(k)&&k.participants&&k.participants.length===0)},showComposer:function j(k){return!!(k.is_subscribed&&(k.can_reply||!k.cannot_reply_reason||k.cannot_reply_reason===c("MessengerThreadCannotReplyReason").BLOCKED)&&!k.has_email_participant&&!k.read_only)},isColdOpen:function j(k){return!!(k.is_canonical_user&&(k.message_count===0||!k.timestamp))}};function i(j){return j+"@facebook.com"}f.exports=h}),null);
__d("MessagingGenericAdminTextType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({ALOHA_AUTOCONNECT_INVITED:"aloha_autoconnect_invited",ALOHA_CONTACT_ADDED:"aloha_contact_added",ALOHA_CONTACT_ADDED_TO_ALOHA_PROXY_USER:"aloha_contact_added_to_aloha_proxy_user",ALOHA_CONTACT_REMOVED:"aloha_contact_removed",ALOHA_INVITE_OWNER_ACCEPT:"aloha_invite_owner_accept",ALOHA_INVITE_OWNER_DECLINE:"aloha_invite_owner_decline",ALOHA_MEDIA_ADDED:"aloha_media_added",ALOHA_MEDIA_SENT:"aloha_media_sent",ALOHA_VISUAL_MEDIA_SENT:"aloha_visual_media_sent",ALOHA_OWNER_INVITED:"aloha_owner_invited",ALOHA_PROXY_USER_NAME_SET:"aloha_proxy_user_name_set",ALOHA_PROXY_USER_PROFILE_PHOTO_SET:"aloha_proxy_user_profile_photo_set",ALOHA_WIFI_CREDENTIALS_SET:"aloha_wifi_credentials_set",MADE_POLL_VOTE:"made_poll_vote",ALOHA_USER_JOINED_CALL_ON_ALOHA:"aloha_user_joined_call_on_aloha",ALOHA_CALL_ENDED_ON_ALOHA:"aloha_call_ended_on_aloha",GROUP_POLL:"group_poll",CONFIRM_FRIEND_REQUEST:"confirm_friend_request",THREAD_CUSTOMIZATION_UPSELL:"thread_customization_upsell",PHONE_CONTACT_UPLOAD:"phone_contact_upload",ACCEPT_PENDING_THREAD:"accept_pending_thread",RAMP_UP_WELCOME_MESSAGE:"ramp_up_welcome_message",CHANGE_THREAD_THEME:"change_thread_theme",CHANGE_THREAD_ICON:"change_thread_icon",GROUP_THREAD_CREATED:"group_thread_created",THREAD_EPHEMERAL_SEND_MODE:"thread_ephemeral_send_mode",INVITE_ACCEPTED:"invite_accepted",MESSENGER_INVITE_SENT:"messenger_invite_sent",TURN_ON_PUSH:"turn_on_push",JOURNEY_PROMPT_COLOR:"journey_prompt_color",JOURNEY_PROMPT_LIKE:"journey_prompt_like",JOURNEY_PROMPT_NICKNAME:"journey_prompt_nickname",JOURNEY_PROMPT_SETUP:"journey_prompt_setup",CHANGE_THREAD_NICKNAME:"change_thread_nickname",NOTIFY_GROUP_MAYORSHIP:"notify_group_mayorship",PROMPT_GROUP_MAYORSHIP_CUSTOMIZATION:"prompt_group_mayorship_customization",MESSAGE_COUNT_MILESTONE_MESSAGE:"message_count_milestone_message",BOT_THREAD_SUBSCRIPTION:"bot_thread_subscription",RTC_CALL_LOG:"rtc_call_log",RTC_INSTANT_VIDEO_LIFECYCLE:"rtc_instant_video_lifecycle",JOURNEY_PROMPT_BOT:"journey_prompt_bot",RIDE_ORDERED_MESSAGE:"ride_ordered_message",DESTINATION_ETA_MESSAGE:"destination_eta_message",RIDE_ARRIVED_MESSAGE:"ride_arrived_message",JOURNEY_PROMPT_NEW_SETUP:"journey_prompt_new_setup",LIGHTWEIGHT_EVENT_CREATE:"lightweight_event_create",LIGHTWEIGHT_EVENT_DELETE:"lightweight_event_delete",LIGHTWEIGHT_EVENT_NOTIFY:"lightweight_event_notify",LIGHTWEIGHT_EVENT_NOTIFY_BEFORE_EVENT:"lightweight_event_notify_before_event",LIGHTWEIGHT_EVENT_RSVP:"lightweight_event_rsvp",LIGHTWEIGHT_EVENT_UPDATE:"lightweight_event_update",LIGHTWEIGHT_EVENT_UPDATE_LOCATION:"lightweight_event_update_location",LIGHTWEIGHT_EVENT_UPDATE_TIME:"lightweight_event_update_time",LIGHTWEIGHT_EVENT_UPDATE_TITLE:"lightweight_event_update_title",SAFETY_LOCATION_REQUEST_SENT:"safety_location_request_sent",SAFETY_LOCATION_REQUEST_RESPONDED:"safety_location_request_responded",SAFETY_LOCATION_REQUEST_DENIED:"safety_location_request_denied",AD_MANAGE_MESSAGE:"ad_manage_message",AD_REPLY_MESSAGE:"ad_reply_message",TAGGED_PHOTO:"tagged_photo",GAME_SCORE:"game_score",INSTANT_GAME_UPDATE:"instant_game_update",INSTANT_GAME_BOT_INTRO:"instant_game_bot_intro",MEDIA_SUBSCRIPTION_MANAGE:"media_subscription_manage",M_AI_SURVEY:"m_ai_survey",PHONE_NUMBER_LOOKUP_NOTICE:"phone_number_lookup_notice",MESSENGER_PRECHECKED_PLUGIN:"messenger_prechecked_plugin",ADD_CONTACT:"add_contact",PRODUCT_INVOICE_RECEIPT_REJECTED:"product_invoice_receipt_rejected",PRODUCT_INVOICE_PAID:"product_invoice_paid",PRODUCT_INVOICE_VOIDED:"product_invoice_voided",PRODUCT_INVOICE_SHIPPED:"product_invoice_shipped",PRODUCT_INVOICE_PAYMENT_EXPIRED:"product_invoice_payment_expired",PRODUCT_INVOICE_RECEIPT_UPLOADED:"product_invoice_receipt_uploaded",CHANGE_JOINABLE_SETTING:"change_joinable_setting",CHANGE_THREAD_ADMINS:"change_thread_admins",CHANGE_THREAD_APPROVAL_MODE:"change_thread_approval_mode",CAPY_SESSION_BEGIN:"capy_session_begin",CAPY_SESSION_END:"capy_session_end",CAPY_AGENT_JOIN:"capy_agent_join",CAPY_SESSION_WAIT_TIME:"capy_session_wait_time",GROUP_SMS_PARTICIPANT_JOINED:"group_sms_participant_joined",GROUP_SMS_PARTICIPANT_CAPPED:"group_sms_participant_capped",SMS_PHONE_NUMBER_CHECK:"sms_phone_number_check",MESSENGER_BOT_REVIEW_SENT:"messenger_bot_review_sent",MESSENGER_CODE_SCAN:"messenger_code_scan",MESSENGER_LIVECHAT_PLUGIN_OPEN:"messenger_livechat_plugin_open",MINGLE_MATCH_SUCCESS:"mingle_match_success",MINGLE_PARTICIPANT_MATCHED:"mingle_participant_matched",MN_ACCOUNT_LINKING_TEXT:"mn_account_linking_text",MN_ACCOUNT_UNLINKING_TEXT:"mn_account_unlinking_text",MN_ACCOUNT_FORCED_UNLINKING_TEXT:"mn_account_forced_unlinking_text",MN_REF_SEND_TEXT:"mn_ref_send_text",ADS_WELCOME_MSG:"ads_welcome_msg",THREAD_JOINABLE_PROMOTION_TEXT:"thread_joinable_promotion_text",PAGES_PLATFORM_REQUEST_TEXT:"pages_platform_request_text",MESSENGER_NEW_USER_GET_STARTED:"messenger_new_user_get_started",SMS_PHONE_NUMBER_TOGGLE:"sms_phone_number_toggle",PAGES_PLATFORM_CREATE_APPOINTMENT:"Pages_Platform_create_appointment",JOINABLE_GROUP_THREAD_CREATED:"joinable_group_thread_created",JOINABLE_ROOM_CREATED_WITH_CO_CREATORS:"joinable_room_created_with_co_creators",PAGES_PLATFORM_ACCEPT_APPOINTMENT:"pages_platform_accept_appointment",PAGES_PLATFORM_REFERRAL_CONFIRMED_APPOINTMENT:"pages_platform_referral_confirmed_appointment",PAGES_PLATFORM_DECLINE_APPOINTMENT:"pages_platform_decline_appointment",PAGES_PLATFORM_USER_CANCEL:"pages_platform_user_cancel",PAGES_PLATFORM_ADMIN_CANCEL:"pages_platform_admin_cancel",MESSENGER_OMNIM_CREATE_FLOW:"messenger_omnim_create_flow",MESSENGER_OMNIM_UPDATE_FLOW:"messenger_omnim_update_flow",MESSENGER_OMNIM_UPDATE_FLOW_STATE:"messenger_omnim_update_flow_state",MESSENGER_GROUP_DESCRITPION_UPDATE:"messenger_group_description_update",MESSENGER_EXTENSION_ADD_CART:"messenger_extension_add_cart",MESSENGER_EXTENSION_ADD_FAVORITE:"messenger_extension_add_favorite",MESSENGER_AD_CONTEXT:"messenger_ad_context",PAGES_PLATFORM_APPOINTMENT_REMINDER:"pages_platform_appointment_reminder",PAGES_PLATFORM_ADMIN_DECLINE:"pages_platform_admin_decline",POKE_RECEIVED:"poke_received",MESSENGER_STATION_SUBSCRIPTION:"messenger_station_subscription",MESSENGER_USER_ALSO_ON_MESSENGER:"messenger_user_also_on_messenger",MESSENGER_INBOX2_BIRTHDAY_BUMP:"messenger_inbox2_birthday_bump",STARTED_SHARING_VIDEO:"started_sharing_video",LIVE_VIDEO_CHAT:"live_video_chat",PARTICIPANT_JOINED_GROUP_CALL:"participant_joined_group_call",MESSENGER_ONLY_PHONE_JOINED_WITH_NEW_ACCOUNT:"messenger_only_phone_joined_with_new_account",PAGES_COMMERCE_PAYMENT_ENABLED:"pages_commerce_payment_enabled",GROUP_PAYMENT_REQUEST:"group_payment_request",P2P_CALL_ESCALATED_TO_GROUP_CALL:"p2p_call_escalated_to_group_call",INVITED_TO_ESCALATED_P2P_CALL:"invited_to_escalated_p2p_call",EVENT_UPCOMING:"event_upcoming",PAGES_VISITOR_POST_SEND_MESSAGE_UPSELL:"pages_visitor_post_send_message_upsell",PAGES_LOW_MESSAGE_RESPONSE_RATE:"pages_low_message_response_rate",PAGES_START_CALL:"pages_start_call",PARTIES_INVITE:"parties_invite",PAGES_JOIN_LOYALTY_PROGRAM:"pages_join_loyalty_program",WORK_INVITE_CLAIMED:"work_invite_claimed",P2P_PAYMENT_REQUEST_REMINDER:"p2p_payment_request_reminder",PHOTO_TAG_BUMP:"photo_tag_bump",MESSENGER_CALL_UPGRADE_LEGACY_CLIENT:"messenger_call_upgrade_legacy_client",DIRECTED_WALL_POST:"directed_wall_post",MESSENGER_CALL_LOG:"messenger_call_log",P2P_PAYMENT_MONEY_RAIN_GAME_ENTRY_POINT:"p2p_payment_money_rain_game_entry_point",MESSENGER_MONTAGE_MENTIONS:"messenger_montage_mentions",PAGES_MESSAGING_BLOCK_WORDS:"pages_messaging_block_words",ALOHA_CALL_INVITE:"aloha_call_invite",SHIPPO_TRACKING_UPDATES:"shippo_tracking_updates",NEO_APPROVED_CONNECTION_ADDED:"neo_approved_connection_added",CHANGE_FAVORITE_COLOR:"change_favorite_color",MARKETPLACE_ITEM_CHANGED:"marketplace_item_changed",SERVICES_VERTICAL_REDEEMED_REFERRAL:"services_vertical_redeemed_referral",PAGES_MARK_AS_PAID:"pages_mark_as_paid",MIGRATED_TO_WORKPLACE:"migrated_to_workplace",MESSENGER_GROUP_EVENT_STATUS_UPDATE:"messenger_group_event_status_update",NEO_APPROVED_USER_REMOVED_FROM_GROUP:"neo_approved_user_removed_from_group",LIVE_CHAT_SUPPORT_AGENT_JOIN:"live_chat_support_agent_join",LIVE_CHAT_SUPPORT_SESSION_BEGIN:"live_chat_support_session_begin",LIVE_CHAT_SUPPORT_SESSION_END:"live_chat_support_session_end",MONTAGE_DIRECT_KEEP:"montage_direct_keep"})}),null);
__d("MessagingGiftWrapConstants",[],(function a(b,c,d,e,f,g){"use strict";var h="gift_wrap",i="gift_unwrapped",j="valentines2016";f.exports={TAG_PREFIX:h,UNWRAPPED_TAG:i,VALENTINES_GIFT:j}}),null);
__d("MessagingGiftWrapChecker",["MercuryConfig","MercuryTagHelper","MessagingGiftWrapConstants"],(function a(b,c,d,e,f,g){"use strict";var h={shouldRenderWithGiftWrap:function k(l){return!!(l.tags&&i(l.tags)&&!j(l.tags))}};function i(k){return c("MercuryTagHelper").get(k,c("MessagingGiftWrapConstants").TAG_PREFIX)===c("MessagingGiftWrapConstants").VALENTINES_GIFT}function j(k){return!!c("MercuryTagHelper").get(k,c("MessagingGiftWrapConstants").UNWRAPPED_TAG)}f.exports=h}),null);
__d("MercuryThreads",["invariant","ChatReliabilityInstrumentation","EventEmitter","EventReminderConstants","MercuryDisplayTimeFilterMessageRenderer","ImmutableObject","KeyedCallbackManager","LogHistory","Map","MercuryActionType","MercuryAssert","MercuryAttachment","MercuryDispatcher","MercuryGiftSnippetRenderer","MercuryGlobalActionType","MercuryIDs","MercuryLocalIDs","MercuryLoggingHelper","MercuryLogMessageType","MercuryParticipants","MercuryPayloadSource","MercuryServerRequests","MercurySingletonProvider","MercurySyncFakeDFFSender","MercuryThreadInfo","MercuryThreadInformer","MessagingGenericAdminTextType","MessagingGiftWrapChecker","MessagingTag","PageCommItemStatus","Set","emptyFunction","ifRequired","requireWeak","setImmediate"],(function a(b,c,d,e,f,g,h){"use strict";var i=c("EventReminderConstants").GuestStates,j=new(c("EventEmitter"))(),k=c("LogHistory").getInstance("mercury_threads");function l(n){this.$MercuryThreads1=n;this.$MercuryThreads2=c("MercuryServerRequests").getForFBID(this.$MercuryThreads1);this.$MercuryThreads3=c("MercuryThreadInformer").getForFBID(this.$MercuryThreads1);this.$MercuryThreads4=c("MercuryIDs").getParticipantIDFromUserID(this.$MercuryThreads1);this.$MercuryThreads5=c("MercuryDispatcher").getForFBID(this.$MercuryThreads1);this.$MercuryThreads6=c("MercurySyncFakeDFFSender").getForFBID(this.$MercuryThreads1);this.$MercuryThreads7=false;this.$MercuryThreads8=new(c("KeyedCallbackManager"))();this.$MercuryThreads9=new(c("Set"))();this.$MercuryThreads10=false;this.$MercuryThreads11=new(c("Set"))();this.$MercuryThreads12=new(c("Set"))();this.$MercuryThreads13()}l.getForFBID=function(n){return m.getForFBID(n)};l.get=function(){return m.get()};l.prototype.getThreadMetaNow=function(n){c("MercuryAssert").isThreadID(n);var o=this.$MercuryThreads8.getResource(n);if(o&&!o.participants){c("ChatReliabilityInstrumentation").logERROR("participants are null!",{thread_id:n});this.$MercuryThreads6.sendThreadDFF(null,n);return new(c("ImmutableObject"))(babelHelpers["extends"]({},o,{participants:[]}))}return o};l.prototype.getOrFetch=function(n){var o=this.getThreadMetaNow(n);if(!o&&!this.$MercuryThreads12.has(n))this.$MercuryThreads11.add(n);if(this.$MercuryThreads11.size>0&&!this.$MercuryThreads10)this.$MercuryThreads14();return o};l.prototype.$MercuryThreads14=function(){if(this.$MercuryThreads10)return;this.$MercuryThreads10=true;c("setImmediate")(function(){this.$MercuryThreads10=false;this.$MercuryThreads11.forEach(function(n){return this.$MercuryThreads12.add(n)}.bind(this));this.getMultiThreadMeta(Array.from(this.$MercuryThreads11),function(n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&this.$MercuryThreads12["delete"](o)}.bind(this));this.$MercuryThreads11.clear()}.bind(this))};l.prototype.getThreadMeta=function(n,o,p){return this.getMultiThreadMeta([n],function(q){return o(q[n])},p)};l.prototype.getMultiThreadMeta=function(n,o,p){c("MercuryAssert").allThreadID(n);var q=this.$MercuryThreads8.executeOrEnqueue(n,o),r=this.$MercuryThreads8.getUnavailableResources(q);if(r.length){var s=[];for(var t=0;t<r.length;t++){var u=r[t],v=c("MercuryIDs").tokenize(u),w=v.type,x=v.value;if(w=="user"){var y=c("MercuryIDs").getParticipantIDFromUserID(x);this.createNewLocalThread(u,y===this.$MercuryThreads4?[this.$MercuryThreads4]:[this.$MercuryThreads4,y])}s.push(u)}if(s.length)this.$MercuryThreads2.fetchThreadData(s,p)}return q};l.addListener=function(n,o){return j.addListener(n,o)};l.prototype.unsubscribe=function(n){this.$MercuryThreads8.unsubscribe(n)};l.prototype.getCanonicalThreadToParticipant=function(n,o,p,q){var r=c("MercuryIDs").getThreadIDFromParticipantID(n);!!r||h(0);var s=this.$MercuryThreads8.getResource(r);if(s==undefined){s=this.createNewLocalThread(r,this.$MercuryThreads4===n?[this.$MercuryThreads4]:[this.$MercuryThreads4,n],o);!q&&this.$MercuryThreads2.fetchThreadData([r],p)}return s};l.prototype.createNewLocalThread=function(n,o,p){var q=this.$MercuryThreads8.getResource(n);if(!q){var r=c("MercuryIDs").tokenize(n),s=r.type,t=r.value;q=new(c("ImmutableObject"))({thread_id:n,participants:Array.from(o),admin_ids:[],name:"",snippet:"",snippet_sender:null,unread_count:p?p:0,message_count:0,image_src:null,timestamp:null,other_user_fbid:s==="user"?t:null,is_canonical_user:s=="user",is_canonical:this.$MercuryThreads15(o),is_subscribed:true,folder:c("MessagingTag").INBOX,is_archived:false});this.$MercuryThreads8.setResource(n,q)}return q};l.prototype.createNewLocalThreadGenerateID=function(){var n=c("MercuryLocalIDs").generateThreadID();this.createNewLocalThread(n,[]);return n};l.prototype.isEmptyLocalThread=function(n){var o=this.$MercuryThreads8.getResource(n);if(!o)return false;return c("MercuryThreadInfo").isEmptyLocalThread(o)};l.prototype.isNewEmptyLocalThread=function(n){var o=this.$MercuryThreads8.getResource(n);if(!o)return false;return c("MercuryThreadInfo").isNewEmptyLocalThread(o)};l.prototype.$MercuryThreads16=function(n,o){if(!n||!n.length)return;var p=new(c("Map"))(),q=new(c("Map"))(),r=new(c("Map"))(),s=[];for(var t=0;t<n.length;t++){var u=n[t],v=u.action_type;if(v==c("MercuryActionType").LOG_MESSAGE&&u.log_message_type==c("MercuryLogMessageType").SERVER_ERROR)continue;var w=!o&&!!(u.thread_fbid||u.other_user_fbid||u.is_from_iris),x=u.thread_id;c("MercuryAssert").isThreadID(x);var y=this.$MercuryThreads8.getResource(x);if(!y&&!w&&v===c("MercuryActionType").USER_GENERATED_MESSAGE){y=this.$MercuryThreads17(u);if(!y.participants||!y.participants.length){k.debug("missing_local_participants",JSON.stringify(c("MercuryLoggingHelper").obfuscateMessage(u)));c("ChatReliabilityInstrumentation").logERROR("missing_local_participants",{thread_id:x});y=new(c("ImmutableObject"))(babelHelpers["extends"]({},y,{participants:[]}));var z=u.other_user_fbid,A=u.thread_fbid;if(z||A)this.$MercuryThreads6.sendThreadDFF(z,A);else continue}this.$MercuryThreads8.setResource(x,y)}if(!y)continue;if(v==c("MercuryActionType").LOG_MESSAGE||v==c("MercuryActionType").USER_GENERATED_MESSAGE)w=!o;if(y.server_timestamp&&u.timestamp<y.server_timestamp&&w)continue;if(!r.has(x))r.set(x,babelHelpers["extends"]({},y));else k.error("skipping thread metadata update",JSON.stringify({have:r.get(x),skipped:y}));var B=r.get(x);!!B||h(0);this.$MercuryThreads18(B,u,o);var C=p.get(x);if(v==c("MercuryActionType").USER_GENERATED_MESSAGE&&(!C||u.timestamp>C.timestamp))p.set(x,u);if((v==c("MercuryActionType").USER_GENERATED_MESSAGE||v==c("MercuryActionType").LOG_MESSAGE)&&!u.skip_bump_thread)if(u&&u.timestamp&&(!q.has(x)||u.timestamp>q.get(x).timestamp))q.set(x,u)}r.forEach(function(D,E){var F=q.get(E),C=p.get(E);if(C)this.$MercuryThreads19(D,C);else if(F&&F.log_message_body){var G=babelHelpers["extends"]({},F,{body:F.log_message_body});this.$MercuryThreads19(D,G)}var H=D.timestamp;if(F){if(F.timestamp>H)Object.assign(D,{timestamp:F.timestamp});var I=D.server_timestamp;if(!o&&F.timestamp>I)D.server_timestamp=F.timestamp}var J=new(c("ImmutableObject"))(D);if((!J.participants||!J.participants.length)&&!this.isEmptyLocalThread(J.thread_id)){var K=(n||[]).map(c("MercuryLoggingHelper").obfuscateMessage),L={update:c("MercuryLoggingHelper").obfuscateThread(J),actions:K};k.error("bad metadata update no_participants",JSON.stringify(L));c("ChatReliabilityInstrumentation").logERROR("refusing to set thread metadata with no participants",L);return}this.$MercuryThreads8.setResource(E,J);s.push(c("MercuryLoggingHelper").obfuscateThread(J))}.bind(this),this);s.length&&this.$MercuryThreads7&&k.debug("threads_updated",JSON.stringify({threads:s}))};l.prototype.$MercuryThreads18=function(n,o,p){var q=o.action_type;if(q==c("MercuryActionType").USER_GENERATED_MESSAGE||q==c("MercuryActionType").LOG_MESSAGE){if(o.is_unread||o.skip_bump_thread)if(!(n.unread_count===0&&o.skip_bump_thread))n.unread_count++;n.message_count++;n.is_archived=false}switch(q){case c("MercuryActionType").DELETE_THREAD:n.message_count=0;this.$MercuryThreads20(o.thread_id);break;case c("MercuryActionType").USER_GENERATED_MESSAGE:if(n.unread_count===0&&o.author===this.$MercuryThreads4&&o.timestamp>=n.last_read_timestamp)n.last_read_timestamp=o.timestamp;if(o.offline_threading_id!==o.message_id)n.last_message_timestamp=o.timestamp;if(o.comm_status!=null)if(n.comm_status&&n.comm_status.toUpperCase()!==c("PageCommItemStatus").FOLLOW_UP)n.comm_status=o.comm_status;if(o.creator_info&&o.creator_info.pageID===this.$MercuryThreads1)n.folder=o.folder;this.$MercuryThreads21(n,o.author);break;case c("MercuryActionType").SEND_MESSAGE:var r=o.log_message_type;if(r==c("MercuryLogMessageType").THREAD_IMAGE){n.image_src=o.log_message_data.image?o.log_message_data.image.preview_url:null;this.$MercuryThreads22(o.thread_id)}if(r!==c("MercuryLogMessageType").SUBSCRIBE&&r!==c("MercuryLogMessageType").UNSUBSCRIBE)n.snippet_attachments=o.attachments;break;case c("MercuryActionType").LOG_MESSAGE:var r=o.log_message_type;if(r==c("MercuryLogMessageType").SUBSCRIBE&&!p){this.$MercuryThreads23(n,o.log_message_data.added_participants);this.$MercuryThreads22(o.thread_id)}else if(r==c("MercuryLogMessageType").UNSUBSCRIBE&&!p){this.$MercuryThreads24(n,o.log_message_data.removed_participants);this.$MercuryThreads22(o.thread_id)}else if(r==c("MercuryLogMessageType").THREAD_IMAGE){if(!p)n.image_src=o.log_message_data.image?o.log_message_data.image.preview_url:null}else if(r==c("MercuryLogMessageType").THREAD_NAME){if(n.name!==o.log_message_data.name)this.$MercuryThreads22(o.thread_id);n.name=o.log_message_data.name}else if(r===c("MercuryLogMessageType").GENERIC_ADMIN_TEXT)this.$MercuryThreads25(n,o);break;case c("MercuryActionType").CHANGE_READ_STATUS:var s=this.$MercuryThreads26(n,o,o.mark_as_read);if(s)n.last_read_timestamp=n.last_message_timestamp;var t=!n.read_only&&n.folder===c("MessagingTag").INBOX;if(s&&p)this.$MercuryThreads2.changeThreadReadStatus(n.thread_id,o.mark_as_read,o.source,n.last_read_timestamp,t,n.last_message_type);break;case c("MercuryActionType").CHANGE_ARCHIVED_STATUS:if(n.is_archived!=o.archived){n.is_archived=o.archived;if(n.comm_status!=null)n.comm_status=o.archived?c("PageCommItemStatus").DONE:c("PageCommItemStatus").TODO;this.$MercuryThreads22(o.thread_id)}break;case c("MercuryActionType").CHANGE_FOLDER:if(n.folder!=o.new_folder){n.folder=o.new_folder;if(n.comm_status!=null)if(o.new_folder===c("MessagingTag").OTHER)n.comm_status=c("PageCommItemStatus").SPAM;else if(o.new_folder===c("MessagingTag").INBOX)n.comm_status=c("PageCommItemStatus").TODO;this.$MercuryThreads22(o.thread_id)}break;case c("MercuryActionType").DELETE_MESSAGES:if(p){n.snippet="...";n.snippet_attachments=null;n.snippet_sender=null;this.$MercuryThreads22(o.thread_id)}else if(o.message_ids){n.message_count-=o.message_ids.length;c("ifRequired")("MercuryMessages",function(x){x=x.getForFBID(this.$MercuryThreads1);for(var y=o.message_ids,z=Array.isArray(y),A=0,y=z?y:y[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var B;if(z){if(A>=y.length)break;B=y[A++]}else{A=y.next();if(A.done)break;B=A.value}var C=B,D=x.getMessagesFromIDs([C]),E=D[0];if(E&&E.timestamp>n.last_read_timestamp)n.unread_count=Math.max(0,n.unread_count-1)}this.$MercuryThreads22(o.thread_id)}.bind(this),c("emptyFunction"))}break;case c("MercuryActionType").UPDATE_SNIPPET:c("ifRequired")("MercuryMessages",function(x){x=x.getForFBID(this.$MercuryThreads1);var y=0,z=1,A=x.getThreadMessagesRangeNow(o.thread_id,y,z),B=A[0];if(B){n.snippet=B.body;n.snippet_attachments=B.attachments;n.snippet_sender=B.author}else{n.snippet="...";n.snippet_attachments=null;n.snippet_sender=null;x.getThreadMessagesRange(o.thread_id,y,z,function(C){if(C.length)this.$MercuryThreads5.handleUpdate({from_client:true,actions:[{thread_id:o.thread_id,action_type:c("MercuryActionType").UPDATE_SNIPPET,deleted_ids:o.deleted_ids}]})}.bind(this))}this.$MercuryThreads22(o.thread_id)}.bind(this),c("emptyFunction"));break;case c("MercuryActionType").CHANGE_MUTE_SETTINGS:if(Object.prototype.hasOwnProperty.call(o,"reactions_mute_mode"))n.reactions_mute_mode=o.reactions_mute_mode;else if(Object.prototype.hasOwnProperty.call(o,"mentions_mute_mode"))n.mentions_mute_mode=o.mentions_mute_mode;else n.mute_until=!o.mute_until?undefined:o.mute_until;this.$MercuryThreads22(n.thread_id);break;case c("MercuryActionType").BLOCK_STATUS_CHANGED:n.can_reply=o.canViewerReply;this.$MercuryThreads22(n.thread_id);break;case c("MercuryActionType").ADD_PARTICIPANTS:this.$MercuryThreads23(n,o.participants);this.$MercuryThreads22(n.thread_id);break;case c("MercuryActionType").CHANGE_FLAG:this.$MercuryThreads27(n,o.mark_as_flag);this.$MercuryThreads22(n.thread_id);break;case c("MercuryActionType").MOVE_PENDING_TO_INBOX:this.$MercuryThreads28(n);this.$MercuryThreads22(n.thread_id);break;case c("MercuryActionType").UPDATE_CUSTOM_LIKE:n.custom_like_icon=o.custom_like;this.$MercuryThreads22(n.thread_id);break;case c("MercuryActionType").ADD_GROUP_ADMINS:n.admin_ids=n.admin_ids.concat(o.added_admin_ids.filter(function(x){return n.admin_ids.indexOf(x)===-1}));this.$MercuryThreads22(o.thread_id);break;case c("MercuryActionType").REMOVE_GROUP_ADMINS:n.admin_ids=n.admin_ids.filter(function(x){return o.removed_admin_ids.indexOf(x)===-1});this.$MercuryThreads22(o.thread_id);break;case c("MercuryActionType").JOINABLE_MODE:n.joinable_mode=o.joinable_mode;this.$MercuryThreads22(o.thread_id);break;case c("MercuryActionType").APPROVAL_MODE:n.approval_mode=o.approval_mode;this.$MercuryThreads22(o.thread_id);break;case c("MercuryActionType").APPROVAL_QUEUE:if(o.added_id&&n.approval_queue_ids&&n.approval_queue_ids.indexOf(o.added_id)===-1)n.approval_queue_ids=n.approval_queue_ids.concat(o.added_id);if(o.removed_id&&n.approval_queue_ids)n.approval_queue_ids=n.approval_queue_ids.filter(function(x){return o.removed_id!==x});this.$MercuryThreads22(o.thread_id);break;case c("MercuryActionType").IS_PIN_PROTECTED:n.is_pin_protected=o.is_pin_protected;this.$MercuryThreads22(o.thread_id);break;case c("MercuryActionType").UPDATE_RTC_CALL_DATA:var u=o.initiator_fbid||(n.rtc_call_data?n.rtc_call_data.initiator_fbid:undefined);n.rtc_call_data=new(c("ImmutableObject"))({call_state:o.call_state,server_info_data:o.server_info_data,initiator_fbid:u});this.$MercuryThreads22(o.thread_id);break;case c("MercuryActionType").UPDATE_COMM_STATUS:this.$MercuryThreads29(n,o.comm_status);this.$MercuryThreads22(n.thread_id);break;case c("MercuryActionType").UPDATE_COMM_ITEM_OWNER:var v=void 0;if(o.id===null)v={nodes:[]};else v={nodes:[{admin:{id:o.id,name:o.name,profile_picture:{uri:o.profile_pic_uri}}}]};n.comm_item_owners=v;this.$MercuryThreads22(n.thread_id);break;case c("MercuryActionType").EVENT_RSVP_CHANGED:var w=n.participants_event_status.filter(function(x){return x.participant_id!==o.actor_fbid});w.push({participant_id:o.actor_fbid.toString(),event_status:o.rsvp_status});n.participants_event_status=w;this.$MercuryThreads22(o.thread_id);break}};l.prototype.$MercuryThreads25=function(n,o){var p,q=this;if(o.log_message_data&&o.log_message_data.untypedData)(function(){var r=o.log_message_data.untypedData,event=n.lightweight_event;switch(o.log_message_data.message_type){case c("MessagingGenericAdminTextType").THREAD_EPHEMERAL_SEND_MODE:var s=parseInt(r.ttl,10);if(s!==null&&n.ephemeral_ttl_mode!==s){n.ephemeral_ttl_mode=s;q.$MercuryThreads22(o.thread_id)}break;case c("MessagingGenericAdminTextType").CHANGE_THREAD_NICKNAME:var t={};for(var u in n.custom_nickname){if(u==r.participant_id&&r.nickname.trim().length==0)continue;t[u]=n.custom_nickname[u]}if(r.nickname.trim().length>0)t[r.participant_id]=r.nickname;n.custom_nickname=t;q.$MercuryThreads22(o.thread_id);break;case c("MessagingGenericAdminTextType").CHANGE_THREAD_ICON:c("requireWeak")("MercuryThreadActions",function(y){y.getForFBID(this.$MercuryThreads1).updateCustomLike(o.thread_id,r.thread_icon)}.bind(q));break;case c("MessagingGenericAdminTextType").CHANGE_THREAD_THEME:var v=r.theme_color;if(v&&v.length>0)n.custom_color="#".concat(v.substring(2));else n.custom_color=null;q.$MercuryThreads22(o.thread_id);break;case c("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_CREATE:var w={};n.participants.map(function(y){var z=c("MercuryIDs").getUserIDFromParticipantID(y);if(z)w[z]=z===r.event_creator_id?i.GOING:i.INVITED},q);n.lightweight_event={track_rsvp:r.event_track_rsvp,title:r.event_title,event_time:parseInt(r.event_time,10),location_name:r.event_location_name,event_members:w,oid:r.event_id,event_type:r.event_type};q.$MercuryThreads22(o.thread_id);break;case c("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE:case c("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_TIME:case c("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_TITLE:case c("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_LOCATION:if(event)n.lightweight_event=q.$MercuryThreads30(r,event,event.event_members);q.$MercuryThreads22(o.thread_id);break;case c("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_RSVP:if(event&&event.event_members){var x=q.$MercuryThreads31(event.event_members,r);n.lightweight_event=q.$MercuryThreads30(r,event,x)}q.$MercuryThreads22(o.thread_id);break;case c("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_DELETE:case c("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_NOTIFY:n.lightweight_event=null;q.$MercuryThreads22(o.thread_id);break}})()};l.prototype.$MercuryThreads31=function(n,o){var p={};for(var q in n)p[q]=n[q];p[o.guest_id]=o.guest_status;return p};l.prototype.$MercuryThreads30=function(n,event,o){return{track_rsvp:event.track_rsvp,title:n.event_title===undefined?event.title:n.event_title,event_time:n.event_time===undefined?event.event_time:parseInt(n.event_time,10),location_name:n.event_location_name===undefined?event.location_name:n.event_location_name,event_members:o===undefined?event.event_members:o,oid:event.oid,event_type:event.event_type}};l.prototype.$MercuryThreads17=function(n){var o=c("MercuryIDs").tokenize(n.thread_id),p=o.type,q=o.value,r=p==="user",s=r||n.specific_to_list&&this.$MercuryThreads15(n.specific_to_list),t=s||r?this.$MercuryThreads32(n):n.specific_to_list;return new(c("ImmutableObject"))({thread_id:n.thread_id,participants:t,name:null,snippet:n.body,snippet_attachments:[],snippet_sender:n.author,unread_count:0,message_count:0,image_src:null,timestamp:n.timestamp,other_user_fbid:r?q:null,is_canonical_user:r,is_canonical:s,is_subscribed:true,folder:c("MessagingTag").INBOX,is_archived:false})};l.prototype.$MercuryThreads26=function(n,o,p){if(o.timestamp)this.$MercuryThreads33(n.thread_id,p,o.timestamp);if(!n||!n.thread_id||!n.participants)return false;if(!n.timestamp){this.$MercuryThreads9.add(n.thread_id);return false}var q=!n.unread_count;if(p==q)return false;n.unread_count=p?0:1;this.$MercuryThreads22(n.thread_id);return true};l.prototype.$MercuryThreads34=function(n){var o=this.$MercuryThreads8.getAllResources();for(var p in o)if(Object.prototype.hasOwnProperty.call(o,p)){var q=o[p];if(q.folder==n){this.$MercuryThreads8.setResource(p,c("ImmutableObject").setProperty(q,"unread_count",0));this.$MercuryThreads22(p)}}};l.prototype.$MercuryThreads23=function(n,o){var p=new(c("Set"))(n.participants);n.participants=Array.from(n.participants||[]);o.forEach(function(q){if(!p.has(q)){n.participants.push(q);if(q===this.$MercuryThreads4){n.is_subscribed=true;n.can_reply=true;n.cannot_reply_reason=null;this.$MercuryThreads6.sendThreadDFF(undefined,n.thread_fbid)}}}.bind(this))};l.prototype.$MercuryThreads24=function(n,o){var p=new(c("Set"))(o);if(n&&!n.participants)c("ChatReliabilityInstrumentation").logERROR("participants are null in thread_info!",{thread_info:n});else n.participants=n.participants.filter(function(q){return!p.has(q)});if(n&&!n.admin_ids)c("ChatReliabilityInstrumentation").logERROR("admin_ids are null in thread_info!",{thread_info:n});else n.admin_ids=n.admin_ids.filter(function(q){return!p.has(q)});if(p.has(this.$MercuryThreads4))n.is_subscribed=false;this.$MercuryThreads2.fetchThreadData([n.thread_id])};l.prototype.$MercuryThreads21=function(n,o){if(!n.participants){var p=JSON.stringify({thread_info:n,participant:o});k.error("missing_participants",p);return}var q=n.participants.indexOf(o);if(q>0)n.participants=[o].concat(n.participants.slice(0,q),n.participants.slice(q+1))};l.prototype.$MercuryThreads19=function(n,o){var p=o.body,q=o.subject,r="";if(q){q=q.toLowerCase();if(p.slice(0,q.length).toLowerCase()==q)r=p;else if(p)r=q+" \xb7 "+p;else r=q}else r=p;if(o.is_filtered_content)r=c("MercuryDisplayTimeFilterMessageRenderer").renderFilteredContent(o);if(c("MessagingGiftWrapChecker").shouldRenderWithGiftWrap(o)){var s=o.author,t=s==this.$MercuryThreads4,u=null;if(!t){u=n.custom_nickname&&n.custom_nickname[c("MercuryIDs").getUserIDFromParticipantID(s)];if(!u){var v=c("MercuryParticipants").getNow(s);if(v!=null)u=v.short_name}}r=c("MercuryGiftSnippetRenderer").renderText(t,u)}n.snippet=r;if(o.raw_attachments&&o.raw_attachments.length>0){var w=c("MercuryAttachment").convertRaw(o.raw_attachments);n.snippet_attachments=w}else n.snippet_attachments=o.attachments;if(o.log_message_type)n.snippet_sender=null;else n.snippet_sender=o.author};l.prototype.$MercuryThreads27=function(n,o){n.page_thread_info=babelHelpers["extends"]({},n.page_thread_info,{flagged:o})};l.prototype.$MercuryThreads29=function(n,o){n.comm_status=o};l.prototype.$MercuryThreads28=function(n){if(n.folder!==c("MessagingTag").PENDING)return;n.folder=c("MessagingTag").INBOX};l.prototype.$MercuryThreads15=function(n){return n.filter(function(o){return o!=this.$MercuryThreads4}.bind(this)).length<=1};l.prototype.$MercuryThreads13=function(){this.$MercuryThreads5.subscribe("invalidate-thread-state",function(n,o){return this.$MercuryThreads35(o)}.bind(this));this.$MercuryThreads5.subscribe("invalidate-global-state",function(n,o){return this.$MercuryThreads36()}.bind(this));this.$MercuryThreads5.subscribe("update-threads",function(n,o){var p=(o.actions||[]).filter(function(q){return q.thread_id});if(o.threads&&o.payload_source==c("MercuryPayloadSource").SERVER_FETCH_THREAD_INFO)o.threads.forEach(function(q){var r=q.thread_id;if(this.$MercuryThreads9.has(r)){this.$MercuryThreads9["delete"](r);if(q.unread_count)this.$MercuryThreads2.changeThreadReadStatus(q.thread_id,true)}}.bind(this));this.$MercuryThreads37(o.threads);this.$MercuryThreads16(p,o.from_client);o.threads&&o.threads.forEach(function(q){this.$MercuryThreads22(q.thread_id)}.bind(this));if(o.global_actions)o.global_actions.forEach(function(q){if(q.action_type==c("MercuryGlobalActionType").MARK_ALL_READ)this.$MercuryThreads34(q.folder)}.bind(this));if(this.$MercuryThreads7){this.$MercuryThreads7=false;j.emit("change")}}.bind(this))};l.prototype.$MercuryThreads37=function(n){if(!n||!n.length)return;var o={},p=[];n.forEach(function(q){var r=new(c("ImmutableObject"))(q);o[q.thread_id]=r;p.push(c("MercuryLoggingHelper").obfuscateThread(r))});p.length&&k.debug("threads_added",JSON.stringify({threads:p}));this.$MercuryThreads8.addResourcesAndExecute(o)};l.prototype.$MercuryThreads22=function(n){this.$MercuryThreads7=true;this.$MercuryThreads3.updatedThread(n)};l.prototype.$MercuryThreads20=function(n){this.$MercuryThreads7=true;this.$MercuryThreads3.deletedThread(n)};l.prototype.$MercuryThreads33=function(n,o,p){this.$MercuryThreads7=true;this.$MercuryThreads3.changedThreadReadState(n,o,p)};l.prototype.$MercuryThreads35=function(n){this.$MercuryThreads8.setResource(n,undefined)};l.prototype.$MercuryThreads36=function(){this.$MercuryThreads7=false;this.$MercuryThreads8=new(c("KeyedCallbackManager"))();this.$MercuryThreads9=new(c("Set"))();this.$MercuryThreads10=false;this.$MercuryThreads11=new(c("Set"))();this.$MercuryThreads12=new(c("Set"))()};l.prototype.$MercuryThreads32=function(n){if(n.specific_to_list)return n.specific_to_list;var o=c("MercuryIDs").tokenize(n.thread_id),p=o.type,q=o.value;if(!q||p!=="user")return[this.$MercuryThreads4];return[c("MercuryIDs").getParticipantIDFromUserID(q),this.$MercuryThreads4]};var m=new(c("MercurySingletonProvider"))(l);f.exports=l}),null);
__d("MercuryMessageObject",["BanzaiODS","MercuryActionStatus","MercuryActionType","MercuryIDs","MercuryLocalIDs","MercuryMessageClientState","MercuryMessageSourceTags","MercurySingletonProvider","MercurySourceType","MercuryThreads","MercurySendMessageFields"],(function a(b,c,d,e,f,g){h.getForFBID=function(l){"use strict";return k.getForFBID(l)};h.get=function(){"use strict";return k.get()};function h(l){"use strict";this.$MercuryMessageObject1=l;this.$MercuryMessageObject2=c("MercuryThreads").getForFBID(l)}h.prototype.constructUserGeneratedMessageObject=function(l,m,n,o,p){var q=arguments.length<=5||arguments[5]===undefined?null:arguments[5];"use strict";var r=i(this.$MercuryMessageObject1,c("MercuryActionType").USER_GENERATED_MESSAGE,m,n);if(typeof l=="string")l=l.replace(/^\s+/,"").replace(/\s+$/,"");r.body=l;r.has_attachment=false;r.html_body=false;r.attachments=[];r.specific_to_list=o||[];r.creator_info=p;if(q&&q.length>0)r.tags=q;return r};h.prototype.constructStickerMessageObject=function(l,m,n){var o=arguments.length<=3||arguments[3]===undefined?null:arguments[3];"use strict";var p=i(this.$MercuryMessageObject1,c("MercuryActionType").USER_GENERATED_MESSAGE,m,n);p.has_attachment=true;p.html_body=false;p.attachments=[];p.sticker_id=l;p.specific_to_list=[];if(o&&o.length>0)p.tags=o;return p};h.prototype.constructAttachmentMessageObject=function(l,m){"use strict";var n=i(this.$MercuryMessageObject1,c("MercuryActionType").USER_GENERATED_MESSAGE,l,m);n.attachments=[];n.specific_to_list=[];return n};h.prototype.constructLogMessageObject=function(l,m,n,o){"use strict";var p=i(this.$MercuryMessageObject1,c("MercuryActionType").LOG_MESSAGE,l,m);p.log_message_type=n;p.log_message_data=o;if(o&&o.untypedData&&o.untypedData.ttl)p.ephemeral_ttl_mode=o.untypedData.ttl;return p};h.prototype.constructCTAConfirmationMessageObject=function(l,m,n,o){var p=arguments.length<=4||arguments[4]===undefined?null:arguments[4];"use strict";var q=this.constructUserGeneratedMessageObject(l,m,n,null,null),r={};if(o)r={quick_replies:o,ignore_for_webhook:false};else r={ignore_for_webhook:true};q.platform_xmd=JSON.stringify(r);if(p&&p.length>0)q.tags=p;return q};h.prototype.normalizeNewMessage=function(l){"use strict";if(l.status===undefined)l.status=c("MercuryActionStatus").UNSENT;l.offline_threading_id=l.offline_threading_id||c("MercuryLocalIDs").generateOfflineThreadingID(l.timestamp);if(!l.offline_threading_id)c("BanzaiODS").bumpEntityKey("chat.web","invalid_otid_generated");l.message_id=l.message_id||l.offline_threading_id;var m=c("MercuryIDs").getParticipantIDFromUserID(this.$MercuryMessageObject1);l.specific_to_list=l.specific_to_list||[];if(l.specific_to_list.length&&l.specific_to_list.indexOf(m)===-1)l.specific_to_list.push(m);if(!l.thread_id)l.thread_id="root:"+l.offline_threading_id;else{var n=this.$MercuryMessageObject2.getThreadMetaNow(l.thread_id);if(n&&n.ephemeral_ttl_mode!==null&&l.ephemeral_ttl_mode===undefined)l.ephemeral_ttl_mode=n.ephemeral_ttl_mode}if(l.specific_to_list.length==1)l.thread_id="user:"+this.$MercuryMessageObject1;else if(l.specific_to_list.length==2){var o=l.specific_to_list[0]==m?l.specific_to_list[1]:l.specific_to_list[0];l.thread_id=c("MercuryIDs").getThreadIDFromParticipantID(o)}if(!l.specific_to_list.length){var p=c("MercuryIDs").tokenize(l.thread_id),q=p.type,r=p.value;if(q=="user")l.specific_to_list=["fbid:"+r,m]}if(!l[c("MercurySendMessageFields").MANUAL_RETRY_CNT])l[c("MercurySendMessageFields").MANUAL_RETRY_CNT]=0};h.prototype.normalizeResendMessage=function(l){"use strict";l.status=c("MercuryActionStatus").RESENDING;l.timestamp=Date.now();l[c("MercurySendMessageFields").MANUAL_RETRY_CNT]+=1};h.prototype.normalizeAddAttachmentPlaceholder=function(l,m,n){"use strict";if(n.preview_attachments.length>0){l.has_attachment=true;l.preview_attachments=n.preview_attachments}l.client_state=c("MercuryMessageClientState").DO_NOT_SEND_TO_SERVER;l.status=c("MercuryActionStatus").RESENDING;l.upload_id=m};function i(l,m,n,o){var p=j(n)?[c("MercuryMessageSourceTags").CHAT]:[],q=Date.now(),r={action_type:m,thread_id:o,author:c("MercuryIDs").getParticipantIDFromUserID(l),author_email:null,timestamp:q,is_unread:false,is_filtered_content:false,is_filtered_content_bh:false,is_filtered_content_account:false,is_filtered_content_quasar:false,is_filtered_content_invalid_app:false,is_spoof_warning:false,source:n,source_tags:p};return r}function j(l){switch(l){case c("MercurySourceType").CHAT_WEB:case c("MercurySourceType").CHAT_JABBER:case c("MercurySourceType").CHAT_IPHONE:case c("MercurySourceType").CHAT_MEEBO:case c("MercurySourceType").CHAT_ORCA:case c("MercurySourceType").CHAT_TEST:case c("MercurySourceType").CHAT:return true;default:return false}}var k=new(c("MercurySingletonProvider"))(h);f.exports=h}),null);
__d("MercuryMessageActions",["MercuryActionType","MercuryDispatcher","MercuryMessageObject","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin"],(function a(b,c,d,e,f,g){"use strict";function h(i){this.$MercuryMessageActions1=i;this.$MercuryMessageActions2=c("MercuryMessageObject").getForFBID(this.$MercuryMessageActions1);this.__serverRequests=c("MercuryServerRequests").getForFBID(this.$MercuryMessageActions1);this.__dispatcher=c("MercuryDispatcher").getForFBID(this.$MercuryMessageActions1)}h.prototype.send=function(i,j,k){j=j||Function.prototype;this.$MercuryMessageActions2.normalizeNewMessage(i);this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers["extends"]({},i),c("MercuryPayloadSource").CLIENT_SEND_MESSAGE));this.__serverRequests.sendNewMessage(i,k);j(i.thread_id)};h.prototype.resend=function(i,j){var k=babelHelpers["extends"]({},i);this.$MercuryMessageActions2.normalizeResendMessage(k);this.send(k,undefined,j)};h.prototype.addAttachmentPlaceholder=function(i,j,k){this.$MercuryMessageActions2.normalizeAddAttachmentPlaceholder(i,j,k);this.$MercuryMessageActions2.normalizeNewMessage(i);this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers["extends"]({},i),c("MercuryPayloadSource").CLIENT_SEND_MESSAGE))};h.prototype.cancelAttachmentPlaceholder=function(i,j){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:i,upload_data:j,action_type:c("MercuryActionType").CANCEL_ATTACHMENT_PLACEHOLDER},c("MercuryPayloadSource").CLIENT_SEND_MESSAGE))};h.prototype.confirmAttachmentPlaceholder=function(i,j){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:i,upload_data:j,action_type:c("MercuryActionType").CONFIRM_ATTACHMENT_PLACEHOLDER},c("MercuryPayloadSource").CLIENT_SEND_MESSAGE))};h.prototype["delete"]=function(i,j,k){this.__dispatcher.handleUpdate(this.$MercuryMessageActions3(i,j,c("MercuryActionType").DELETE_MESSAGES,k||c("MercuryPayloadSource").CLIENT_DELETE_MESSAGES))};h.prototype.unwrap=function(i){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({thread_id:i.thread_id,unwrapped_message_id:i.message_id,action_type:c("MercuryActionType").UNWRAP_MESSAGE},c("MercuryPayloadSource").CLIENT_UNWRAP_MESSAGE))};h.prototype.__constructClientSingleMessagePayload=function(i,j){return{actions:[i],from_client:true,payload_source:j}};h.prototype.$MercuryMessageActions4=function(i,j){return{actions:[i],from_client:false,payload_source:j}};h.prototype.$MercuryMessageActions3=function(i,j,k,l){return{actions:[{action_type:k,thread_id:i,message_ids:j}],from_client:true,payload_source:l}};Object.assign(h,c("MercurySingletonMixin"));f.exports=h}),null);
__d("MercuryViewer",["CurrentUser","MercuryAssert"],(function a(b,c,d,e,f,g){"use strict";var h="fbid:"+c("CurrentUser").getID(),i={getID:function j(){return h},isViewer:function j(k){c("MercuryAssert").isParticipantID(k);return k===h}};f.exports=i}),null);
__d("MercuryFilters",["MessagingTag"],(function a(b,c,d,e,f,g){var h=[c("MessagingTag").UNREAD],i={ALL:"all",UNREAD:c("MessagingTag").UNREAD,getSupportedFilters:function j(){return h.concat()},isSupportedFilter:function j(k){return h.includes(k)}};f.exports=i}),null);
__d("MessengerStateProcessor",["MercuryAPIArgsSource","MercuryIDs","MercuryParticipantTypes","MercuryParticipants","MercuryThreadIDMap","MercuryThreads","mercuryVanityIDMapRe","MessengerURIConstants"],(function a(b,c,d,e,f,g){"use strict";var h={preprocess:function j(k){var l=k.activeThreadID;if(l){var m=c("MercuryIDs").getUserIDFromThreadID(l),n=m&&c("MercuryParticipants").getNow(c("MercuryIDs").getParticipantIDFromUserID(m));if(n&&n.type!==c("MercuryParticipantTypes").EVENT)k.threadKey=n.vanity||m;else if(m&&!n){var o=c("MercuryIDs").getParticipantIDFromUserID(m);k.threadKey=c("mercuryVanityIDMapRe").hasID(o)?c("mercuryVanityIDMapRe").getVanity(o):m}else{var p=c("MercuryThreadIDMap").get(),q=p.getServerIDFromClientIDNow(l);k.threadKey=q||c("MercuryIDs").tokenize(l).value}}delete k.activeThreadID;return k},postprocess:function j(k){var l=c("MercuryThreadIDMap").get(),m=c("MercuryThreads").get(),n=i(k.threadKey),o=void 0;o=c("MercuryIDs").isValid(n)?n:l.getClientIDFromServerIDNow(n);if(!o){var p=c("MercuryParticipants").getIDFromVanityOrFBID(n),q=p&&m.getCanonicalThreadToParticipant(p,null,c("MercuryAPIArgsSource").MESSENGER);if(q)o=q.thread_id}if(o){k.activeThreadID=o;k.serverThreadID=l.getServerIDFromClientIDNow(o)}delete k.threadKey;return k},supportInboxPostprocess:function j(k){if(k.threadKey)k.activeThreadID=c("MercuryIDs").getThreadIDFromSupportInboxItemID(k.threadKey);delete k.threadKey;return k}};function i(j){if(!j)return null;return j.startsWith(c("MessengerURIConstants").GROUP_PREFIX)?j.substr(c("MessengerURIConstants").GROUP_PREFIX.length):j}f.exports=h}),null);
__d("MessengerURISerializer",["CurrentEnvironment","MercuryFilters","MessagingTag","MessengerStateProcessor","MessengerURIConstants","MessengerView","URI","WWWBase","MercuryIDs"],(function a(b,c,d,e,f,g){"use strict";var h="/?$",i=function i(m,n){m.setPath(c("CurrentEnvironment").facebookdotcom?c("MessengerURIConstants").FACEBOOK_PREFIX+n:n)},j=function j(m,n){var o=m.getPath();if(c("CurrentEnvironment").facebookdotcom&&!o.startsWith(c("MessengerURIConstants").FACEBOOK_PREFIX))n=c("MessengerURIConstants").FACEBOOK_PREFIX+n;m.setPath(m.getPath()+n)},k={serialize:function m(n){var o=new(c("URI"))(c("WWWBase").uri);n=c("MessengerStateProcessor").preprocess(n);switch(n.masterView){case c("MessengerView").MASTER.GROUPS:i(o,c("MessengerURIConstants").GROUPS_PATH);break;case c("MessengerView").MASTER.PAYMENT:i(o,c("MessengerURIConstants").PAYMENT_PATH);break;case c("MessengerView").MASTER.PEOPLE:i(o,c("MessengerURIConstants").PEOPLE_PATH);break;case c("MessengerView").MASTER.SUPPORT:i(o,c("MessengerURIConstants").SUPPORT_PATH);break}switch(n.folder){case c("MessagingTag").OTHER:i(o,c("MessengerURIConstants").FILTERED_REQUESTS_PATH);break;case c("MessagingTag").ACTION_ARCHIVED:i(o,c("MessengerURIConstants").ARCHIVED_PATH);break;case c("MessagingTag").PENDING:i(o,c("MessengerURIConstants").MESSAGE_REQUESTS_PATH);break}if(n.detailView===c("MessengerView").DETAIL.PAYTHREAD){j(o,c("MessengerURIConstants").PAYMENT_PAY_PATH);if(n.threadKey)o.addQueryData("id",n.threadKey)}else if(n.detailView===c("MessengerView").DETAIL.PAYFRIENDPICKER)j(o,c("MessengerURIConstants").PAYMENT_PAY_PATH);else if(n.detailView===c("MessengerView").DETAIL.COMPOSE)j(o,c("MessengerURIConstants").COMPOSE_SUBPATH);else if(n.threadKey)if(n.masterView===c("MessengerView").MASTER.PAYMENT){i(o,c("MessengerURIConstants").THREAD_PREFIX+n.threadKey);delete n.extraQueryParams.id;delete n.extraQueryParams.a;delete n.extraQueryParams.m}else j(o,c("MessengerURIConstants").THREAD_PREFIX+n.threadKey);else if(n.masterView===c("MessengerView").MASTER.PAYMENT){i(o,"");delete n.extraQueryParams.id;delete n.extraQueryParams.a;delete n.extraQueryParams.m}else j(o,"");if(n.extraQueryParams)o.addQueryData(n.extraQueryParams);if(c("MercuryFilters").isSupportedFilter(n.filter))o.addQueryData({filter:n.filter});if(n.query!=null){var p;o.addQueryData((p={},p[n.masterView===c("MessengerView").MASTER.SEARCH?"qa":"q"]=n.query,p))}if(n.threadIDs)o.addQueryData({threadIDs:JSON.stringify(n.threadIDs)});if(n.mid)o.addQueryData({mid:n.mid});return o},deserialize:function m(n){var o={},p=n.getPath();if(c("CurrentEnvironment").facebookdotcom&&!p.startsWith(c("MessengerURIConstants").FACEBOOK_PREFIX))o.notMessenger=true;var q=p.replace(c("MessengerURIConstants").FACEBOOK_PREFIX,""),r=void 0,s=n.getQueryData(),t=s.filter,u=s.mid,v=s.q,w=s.qa,x=s.threadIDs,y=babelHelpers.objectWithoutProperties(s,["filter","mid","q","qa","threadIDs"]);try{r=JSON.parse(x)}catch(z){o.threadIDs=null}if(r)o.threadIDs=r.filter(function(B){return c("MercuryIDs").isValidThreadID(B)});if(q.match("^"+c("MessengerURIConstants").GROUPS_PATH))o.masterView=c("MessengerView").MASTER.GROUPS;else if(q.match("^"+c("MessengerURIConstants").PEOPLE_PATH))o.masterView=c("MessengerView").MASTER.PEOPLE;else if(q.match("^"+c("MessengerURIConstants").SUPPORT_PATH))o.masterView=c("MessengerView").MASTER.SUPPORT;else if(q.match("^"+c("MessengerURIConstants").PAYMENT_PATH))o.masterView=c("MessengerView").MASTER.PAYMENT;else if(w)o.masterView=c("MessengerView").MASTER.SEARCH;else o.masterView=c("MessengerView").MASTER.RECENT;if(q.match("^"+c("MessengerURIConstants").FILTERED_REQUESTS_PATH))o.folder=c("MessagingTag").OTHER;else if(q.match("^"+c("MessengerURIConstants").ARCHIVED_PATH))o.folder=c("MessagingTag").ACTION_ARCHIVED;else if(q.match("^"+c("MessengerURIConstants").MESSAGE_REQUESTS_PATH))o.folder=c("MessagingTag").PENDING;else o.folder=c("MessagingTag").INBOX;if(q.match(c("MessengerURIConstants").COMPOSE_SUBPATH+h))o.detailView=c("MessengerView").DETAIL.COMPOSE;else if(q.match("^"+c("MessengerURIConstants").PAYMENT_PATH+c("MessengerURIConstants").PAYMENT_PAY_PATH))if(y&&y.id){o.threadKey=y.id;o.detailView=c("MessengerView").DETAIL.PAYTHREAD}else o.detailView=c("MessengerView").DETAIL.PAYFRIENDPICKER;else{var A=l(q);if(A){o.threadKey=A;o.detailView=c("MessengerView").DETAIL.THREAD}}if(c("MercuryFilters").isSupportedFilter(t))o.filter=t;else o.filter=c("MercuryFilters").ALL;o.mid=u;o.query=w||v;o.extraQueryParams=y;if(o.masterView===c("MessengerView").MASTER.SUPPORT)return c("MessengerStateProcessor").supportInboxPostprocess(o);return c("MessengerStateProcessor").postprocess(o)}};function l(m){var n=m.match(c("MessengerURIConstants").THREAD_PREFIX+"([^/]+)"+h);return n&&decodeURIComponent(n[1])}f.exports=k}),null);
__d("MessengerActions",["invariant","MercuryIDs","MessengerDispatcher","MessengerURISerializer","MercuryTypeaheadConstants","MessengerView","URI","goURI","keyMirror"],(function a(b,c,d,e,f,g,h){"use strict";var i=c("keyMirror")({CANCEL_FILE_UPLOAD:null,EMPTY_FILES:null,LINK_PREVIEW:null,LOADED_SHARE_DATA:null,LOADING_SHARE_DATA:null,REMOVE_SHARE_PREVIEW:null,PREPARE_FILES_FOR_SEND:null,REPLACE_STATE:null,SELECT_THREAD:null,UPDATE_MDOT_ME:null,UPDATE_THREAD_TAG:null,UPLOAD_FILE_FAILED:null,UPLOADED_FILE:null}),j={Types:i,changeDetailView:function m(n){l(function(o){if(o.detailView!==n)return{detailView:n};return null})},changeMasterView:function m(n){l(function(o){if(o.masterView!==n){var p={masterView:n};if(o.masterView===c("MessengerView").MASTER.SEARCH)p.query=undefined;return p}return null})},selectAggregation:function m(n){l(function(o){return{detailView:c("MessengerView").MASTER.RECENT,threadIDs:n,mid:null}})},selectThread:function m(n,o){if(o===c("MercuryTypeaheadConstants").MEETING_ROOM_PAGE_TYPE){!!n||h(0);var p=c("MercuryIDs").getUserIDFromThreadID(n);!!p||h(0);var q=new(c("URI"))(),r=q.getQualifiedURI().getSubdomain();q.setDomain("facebook.com").setSubdomain(r).setPath("/"+p).setProtocol("https");window.open(q,"_blank");return}c("MessengerDispatcher").dispatch({type:i.SELECT_THREAD,threadID:n});l(function(s){if(s.activeThreadID!==n)return{activeThreadID:n,detailView:c("MessengerView").DETAIL.THREAD,mid:null};return null})},changeState:function m(n){c("MessengerDispatcher").dispatch({type:i.REPLACE_STATE,nextState:n})},changeMDotMeReferral:function m(){var n=arguments.length<=0||arguments[0]===undefined?null:arguments[0],o=arguments.length<=1||arguments[1]===undefined?null:arguments[1];c("MessengerDispatcher").dispatch({type:j.Types.UPDATE_MDOT_ME,refCode:n,refThreadID:o})},changeThreadTag:function m(){var n=arguments.length<=0||arguments[0]===undefined?null:arguments[0],o=arguments.length<=1||arguments[1]===undefined?null:arguments[1];c("MessengerDispatcher").dispatch({type:j.Types.UPDATE_THREAD_TAG,messagingTags:n,threadID:o})},changeFolder:function m(n){l(function(o){if(o.folder!==n)return{folder:n};return null})},changeFilter:function m(n){l(function(o){if(o.filter!==n)return{filter:n};return null})},changeQuery:function m(n){l(function(o){if(o.query!==n)return{query:n};return null})},changeQueryAll:function m(n){l(function(o){if(o.queryAll!==n)return{query:n,masterView:c("MessengerView").MASTER.SEARCH};return null})},changeMid:function m(n){l(function(o){if(o.mid!==n)return{mid:n};return null})},changeID:function m(n){l(function(o){if(o.extraQueryParams.id!==n)return{extraQueryParams:babelHelpers["extends"]({},o.extraQueryParams,{id:n})};return null})},prepareFilesForSend:function m(n,o){if(!n)return;c("MessengerDispatcher").dispatch({type:j.Types.PREPARE_FILES_FOR_SEND,threadID:n,files:o})},uploadedFile:function m(n,o,p){if(!n)return;c("MessengerDispatcher").dispatch({type:j.Types.UPLOADED_FILE,threadID:n,uploadID:o,payload:p})},cancelFileUpload:function m(n,o){if(!n)return;c("MessengerDispatcher").dispatch({type:j.Types.CANCEL_FILE_UPLOAD,threadID:n,uploadID:o})},uploadFileFailed:function m(n,o){if(!n)return;c("MessengerDispatcher").dispatch({type:j.Types.UPLOAD_FILE_FAILED,threadID:n,uploadID:o})},cleanFiles:function m(n){if(!n)return;c("MessengerDispatcher").dispatch({type:j.Types.EMPTY_FILES,threadID:n})},loadingPreview:function m(n,o){c("MessengerDispatcher").dispatch({type:j.Types.LINK_PREVIEW,threadID:n,match:o})},loadingShareData:function m(n){c("MessengerDispatcher").dispatch({type:j.Types.LOADING_SHARE_DATA,threadID:n})},loadedShareData:function m(n,o){c("MessengerDispatcher").dispatch({type:j.Types.LOADED_SHARE_DATA,threadID:n,attachmentData:o})},removeSharePreview:function m(n){c("MessengerDispatcher").dispatch({type:j.Types.REMOVE_SHARE_PREVIEW,threadID:n})}};function k(m,n){return m.detailView==null}function l(m){var n=c("MessengerURISerializer").deserialize(new(c("URI"))(window.location.href)),o=m(n),p=k(n,o);if(o)c("goURI")(c("MessengerURISerializer").serialize(Object.assign(n,o)),false,p)}f.exports=j}),null);
__d("XGroupsJoinChatController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/groups/join_chat/",{link_hash:{type:"String"}})}),null);
__d("XMercuryThreadLikeIconController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/mercury/like_icon/",{emoji:{type:"String",defaultValue:""}})}),null);
__d("XMessagingBlockMessagesController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/messaging/block_messages/",{})}),null);
__d("XMessagingGroupJoinThroughHashController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/messaging/join_through_hash/",{link_hash:{type:"String"}})}),null);
__d("XMessagingGroupJoinThroughPrivateLinkController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/messaging/join_through_invite/",{link_hash:{type:"String"}})}),null);
__d("XMessagingGroupJoinableAcceptController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/messaging/joinable_accept/",{thread_fbid:{type:"String"},user_id:{type:"Int"}})}),null);
__d("XMessagingGroupJoinableInviteController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/messaging/joinable_invite/",{thread_fbid:{type:"String"},user_ids:{type:"IntSet"}})}),null);
__d("XMessagingGroupJoinableRejectController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/messaging/joinable_reject/",{thread_fbid:{type:"String"},user_id:{type:"Int"}})}),null);
__d("XMessagingGroupSetApprovalController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/messaging/set_approval_mode/",{set_mode:{type:"Enum",enumType:0},thread_fbid:{type:"String"}})}),null);
__d("XMessagingSaveAdminsController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/messaging/save_admins/",{elem_id:{type:"String"},parent_elem_id:{type:"String"},thread_fbid:{type:"String"},admin_ids:{type:"FBIDSet"},add:{type:"Bool",defaultValue:false}})}),null);
__d("XMessagingSaveNicknameController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/messaging/save_thread_nickname/",{source:{type:"Enum",required:true,enumType:1}})}),null);
__d("XMessagingSaveThreadColorController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/messaging/save_thread_color/",{source:{type:"Enum",required:true,enumType:1}})}),null);
__d("XMessagingSaveThreadEmojiController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/messaging/save_thread_emoji/",{source:{type:"Enum",required:true,enumType:1}})}),null);
__d("XMessagingUnblockMessagesController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/messaging/unblock_messages/",{})}),null);
__d("XNFXIgnoreMessagesActionController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/nfx/ignore_messages/",{thread_fbid:{type:"Int",required:true},location:{type:"Enum",required:true,enumType:1},__asyncDialog:{type:"Int"}})}),null);
__d("XNFXMessengerBlockActionController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/nfx/block_messages/",{thread_fbid:{type:"Int",required:true},av:{type:"Int"},location:{type:"Enum",required:true,enumType:1},__asyncDialog:{type:"Int"}})}),null);
__d("MercuryThreadActions",["cssVar","AsyncDialog","AsyncRequest","EmojiLikeConstants","IgnoreMessagesTypedLogger","MercuryActionType","MercuryAPIArgsSource","MercuryConfig","MercuryDispatcher","MercuryIDs","MercuryLogMessageType","MercuryMessengerBlockingUtils","MercuryPayloadSource","MercuryParticipants","MercuryServerPayloadPreprocessor","MercuryServerRequests","MercurySingletonMixin","MercurySourceType","MercuryThreadIDMap","MercuryThreads","MercuryViewer","MercuryMessageActions","MessengerActions","MercuryMessageObject","MessagingTag","PageCommItemStatus","ReloadPage","URI","XGroupsJoinChatController","XMercuryThreadLikeIconController","XMessagingGroupJoinableAcceptController","XMessagingGroupJoinableInviteController","XMessagingGroupJoinableRejectController","XMessagingGroupJoinThroughHashController","XMessagingGroupJoinThroughPrivateLinkController","XMessagingGroupSetApprovalController","XMessagingSaveAdminsController","XMessagingSaveNicknameController","XMessagingSaveThreadColorController","XMessagingSaveThreadEmojiController","XNFXMessengerBlockActionController","XMessagingBlockMessagesController","XMessagingUnblockMessagesController","XNFXIgnoreMessagesActionController","ex"],(function a(b,c,d,e,f,g,h){"use strict";var i=c("MercuryThreadIDMap").get(),j=c("MercuryThreads").get(),k=c("MercuryMessageActions").get(),l=c("MercuryMessageObject").get();function m(n){this.$MercuryThreadActions1=n;this.__serverRequests=c("MercuryServerRequests").getForFBID(this.$MercuryThreadActions1);this.__dispatcher=c("MercuryDispatcher").getForFBID(this.$MercuryThreadActions1);this.__payloadPreprocessor=c("MercuryServerPayloadPreprocessor").getForFBID(this.$MercuryThreadActions1)}m.prototype.markRead=function(n,o){this.batchMarkRead([n],o)};m.prototype.batchMarkRead=function(n,o){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(n,true,o))};m.prototype.markUnread=function(n,o){this.batchMarkUnread([n],o)};m.prototype.batchMarkUnread=function(n,o){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(n,false,o))};m.prototype.markSeen=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c("MercuryActionType").MARK_THREAD_SEEN,c("MercuryPayloadSource").CLIENT_MARK_THREAD_SEEN,{persistent:o}))};m.prototype.archive=function(n,o){this.batchArchive([n],o)};m.prototype.batchArchive=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadArchivedStatus(p,true,o)}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(n,true))};m.prototype.unarchive=function(n,o){this.batchUnarchive([n],o)};m.prototype.batchUnarchive=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadArchivedStatus(p,false,o)}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(n,false))};m.prototype.markSpam=function(n,o){this.batchMarkSpam([n],o)};m.prototype.batchMarkSpam=function(n,o){n.forEach(function(p){this.__serverRequests.markThreadSpam(p,o)}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,c("MessagingTag").SPAM))};m.prototype.unmarkSpam=function(n,o){this.batchUnmarkSpam([n],o)};m.prototype.batchUnmarkSpam=function(n,o){n.forEach(function(p){this.__serverRequests.unmarkThreadSpam(p,o)}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,c("MessagingTag").INBOX))};m.prototype.changeFolder=function(n,o){this.batchChangeFolder([n],o)};m.prototype.batchChangeFolder=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadFolder(p,o)}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,o))};m.prototype["delete"]=function(n,o){this.batchDelete([n],o)};m.prototype.batchDelete=function(n,o){n.forEach(function(p){this.__serverRequests.deleteThread(p,o)}.bind(this));this.__dispatcher.handleUpdate(this.__constructClientPayload(n,c("MercuryActionType").DELETE_THREAD,c("MercuryPayloadSource").CLIENT_DELETE_THREAD))};m.prototype.unmute=function(n){this.updateMuteSetting(n,0)};m.prototype.updateMuteSetting=function(n,o){this.__serverRequests.changeMutingOnThread(n,o);this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c("MercuryActionType").CHANGE_MUTE_SETTINGS,c("MercuryPayloadSource").CLIENT_CHANGE_MUTE_SETTINGS,{mute_until:o}))};m.prototype.updateMentionsMuteSetting=function(n,o){var p=o?1:0;this.__serverRequests.changeMentionsMutingOnThread(n,p);this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c("MercuryActionType").CHANGE_MUTE_SETTINGS,c("MercuryPayloadSource").CLIENT_CHANGE_MUTE_SETTINGS,{mentions_mute_mode:p}))};m.prototype.updateReactionsMuteSetting=function(n,o){var p=o?1:0;this.__serverRequests.changeReactionsMutingOnThread(n,p);this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c("MercuryActionType").CHANGE_MUTE_SETTINGS,c("MercuryPayloadSource").CLIENT_CHANGE_MUTE_SETTINGS,{reactions_mute_mode:p}))};m.prototype.blockMessages=function(n,o){var p="";if(c("MercuryConfig").WMBF){this.changeFolder(n,c("MessagingTag").OTHER);j.getThreadMeta(n,function(r){var s=c("MercuryParticipants").getNow(c("MercuryIDs").getParticipantIDFromUserID(r.other_user_fbid));p=s&&s.short_name})}var q=c("XNFXMessengerBlockActionController").getURIBuilder().setInt("thread_fbid",c("MercuryIDs").getUserIDFromThreadID(n)).setEnum("location","www_chat_head").getURI();c("AsyncDialog").send(new(c("AsyncRequest"))(q),function(r){r.subscribe("confirm",function(){r.hide();o&&o(p)})})};m.prototype.unblockMessages=function(n){var o=c("MercuryIDs").getUserIDFromThreadID(n);if(o===null)throw new Error(c("ex")("Expected user ID to unblock messages for, got null"));var p=JSON.stringify({reportable_ent_token:o,initial_action_name:c("MercuryMessengerBlockingUtils").block_messages});new(c("AsyncRequest"))(new(c("URI"))("/ajax/nfx/messenger_undo_block").addQueryData({story_location:"messenger",context:p})).send();if(c("MercuryConfig").WMBF)this.changeFolder(n,c("MessagingTag").INBOX)};m.prototype.ignoreMessages=function(n,o){var p=c("XNFXIgnoreMessagesActionController").getURIBuilder().setInt("thread_fbid",n).setEnum("location","www_chat_head").getURI();c("AsyncDialog").send(new(c("AsyncRequest"))(p))};m.prototype.blockOnMessengerDotCom=function(n){var o=c("XMessagingBlockMessagesController").getURIBuilder().getURI();new(c("IgnoreMessagesTypedLogger"))().setEvent("block_confirmed").setThreadID(c("MercuryIDs").getThreadFBIDFromThreadID(n)).setPlatform("messengerdotcom").log();new(c("AsyncRequest"))(o).setMethod("POST").setData({fbid:c("MercuryIDs").getUserIDFromThreadID(n)}).send()};m.prototype.blockIgnoreOnMessengerDotCom=function(n,o,p){n&&c("MessengerActions").selectThread(null);this.changeFolder(o,c("MessagingTag").OTHER);this.blockOnMessengerDotCom(o);p&&p()};m.prototype.unblockOnMessengerDotCom=function(n){var o=c("XMessagingUnblockMessagesController").getURIBuilder().getURI();new(c("AsyncRequest"))(o).setMethod("POST").setData({fbid:c("MercuryIDs").getUserIDFromThreadID(n)}).send();if(c("MercuryConfig").WMBF)this.changeFolder(n,c("MessagingTag").INBOX)};m.prototype.leaveGroup=function(n){if(!j.isEmptyLocalThread(n))k.send(l.constructLogMessageObject(c("MercurySourceType").TITAN_WEB,n,c("MercuryLogMessageType").UNSUBSCRIBE,{removed_participants:[c("MercuryViewer").getID()]}),null,c("MercuryAPIArgsSource").WEBMESSENGER)};m.prototype.changeThreadColor=function(n,o,p){if(j.isEmptyLocalThread(n))return;i.getServerIDFromClientID(n,function(q){var r={};if(o!="#0084ff")r.color_choice=o;r.thread_or_other_fbid=q;var s=c("XMessagingSaveThreadColorController").getURIBuilder().setEnum("source",p).getURI();new(c("AsyncRequest"))(s).setMethod("POST").setData(r).send()})};m.prototype.changeThreadEmoji=function(n,o,p){if(j.isEmptyLocalThread(n))return;i.getServerIDFromClientID(n,function(q){var r={},s=String.fromCodePoint.apply(String,o);if(s!==String.fromCodePoint(c("EmojiLikeConstants").FB_THUMBS_UP_EMOJI)&&s!==String.fromCodePoint(c("EmojiLikeConstants").THUMBS_UP_EMOJI_CODES))r.emoji_choice=s;r.thread_or_other_fbid=q;var t=c("XMessagingSaveThreadEmojiController").getURIBuilder().setEnum("source",p).getURI();new(c("AsyncRequest"))(t).setMethod("POST").setData(r).send()})};m.prototype.changeThreadNicknames=function(n,o,p,q){if(j.isEmptyLocalThread(n))return;i.getServerIDFromClientID(n,function(r){var s={thread_or_other_fbid:r,participant_id:o,nickname:p},t=c("XMessagingSaveNicknameController").getURIBuilder().setEnum("source",q).getURI();new(c("AsyncRequest"))(t).setMethod("POST").setData(s).send()})};m.prototype.setApprovalMode=function(n,o){var p=c("XMessagingGroupSetApprovalController").getURIBuilder().getURI();new(c("AsyncRequest"))(p).setMethod("POST").setData({set_mode:n,thread_fbid:o.thread_fbid}).send()};m.prototype.changeGroupAdmins=function(n,o,p){var q={thread_fbid:n,admin_ids:o,add:p},r=c("XMessagingSaveAdminsController").getURIBuilder().getURI();new(c("AsyncRequest"))(r).setMethod("POST").setData(q).send()};m.prototype.joinThroughHash=function(n){var o={link_hash:n},p=c("XMessagingGroupJoinThroughHashController").getURIBuilder().getURI();new(c("AsyncRequest"))(p).setMethod("POST").setData(o).send()};m.prototype.joinThroughPrivateLink=function(n){var o={link_hash:n},p=c("XMessagingGroupJoinThroughPrivateLinkController").getURIBuilder().getURI();new(c("AsyncRequest"))(p).setMethod("POST").setData(o).send()};m.prototype.chatJoinThroughHash=function(n){var o={link_hash:n},p=c("XGroupsJoinChatController").getURIBuilder().getURI();new(c("AsyncRequest"))(p).setMethod("POST").setData(o).setHandler(function(q){return c("ReloadPage").now()}).send()};m.prototype.inviteToJoinableGroup=function(n,o){var p={thread_fbid:n,user_ids:o},q=c("XMessagingGroupJoinableInviteController").getURIBuilder().getURI();new(c("AsyncRequest"))(q).setMethod("POST").setData(p).send()};m.prototype.acceptToJoinableGroup=function(n,o){var p={thread_fbid:n,user_id:o},q=c("XMessagingGroupJoinableAcceptController").getURIBuilder().getURI();new(c("AsyncRequest"))(q).setMethod("POST").setData(p).send()};m.prototype.rejectToJoinableGroup=function(n,o){var p={thread_fbid:n,user_id:o},q=c("XMessagingGroupJoinableRejectController").getURIBuilder().getURI();new(c("AsyncRequest"))(q).setMethod("POST").setData(p).send()};m.prototype.addParticipants=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c("MercuryActionType").ADD_PARTICIPANTS,c("MercuryPayloadSource").CLIENT_ADD_PARTICIPANTS,{participants:o}))};m.prototype.updateCustomLike=function(n,o){var p=c("XMercuryThreadLikeIconController").getURIBuilder().setString("emoji",o).getURI();new(c("AsyncRequest"))().setURI(p).setHandler(function(q){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c("MercuryActionType").UPDATE_CUSTOM_LIKE,c("MercuryPayloadSource").CLIENT_CHANGE_CUSTOM_LIKE,{custom_like:q.getPayload()}))}.bind(this)).send()};m.prototype.movePendingToInbox=function(n){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c("MercuryActionType").MOVE_PENDING_TO_INBOX,c("MercuryPayloadSource").CLIENT_MOVE_PENDING_TO_INBOX))};m.prototype.updateSnippet=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c("MercuryActionType").UPDATE_SNIPPET,c("MercuryPayloadSource").CLIENT_UPDATE_SNIPPET,{deleted_ids:o}))};m.prototype.updateCommStatus=function(n,o){this.__dispatcher.handleUpdate(this.$MercuryThreadActions5(n,o));var p=o===c("PageCommItemStatus").DONE;this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(n,p))};m.prototype.updateCommItemOwner=function(n,o,p,q){this.__dispatcher.handleUpdate(this.$MercuryThreadActions6(n,o,p,q))};m.prototype.$MercuryThreadActions2=function(n,o,p){return this.__constructClientPayload(n,c("MercuryActionType").CHANGE_READ_STATUS,c("MercuryPayloadSource").CLIENT_CHANGE_READ_STATUS,{mark_as_read:o,source:p})};m.prototype.$MercuryThreadActions6=function(n,o,p,q){return this.__constructClientPayload(n,c("MercuryActionType").UPDATE_COMM_ITEM_OWNER,c("MercuryPayloadSource").UPDATE_COMM_ITEM_OWNER,{id:p,name:o,profile_pic_uri:q})};m.prototype.$MercuryThreadActions3=function(n,o){return this.__constructClientPayload(n,c("MercuryActionType").CHANGE_ARCHIVED_STATUS,c("MercuryPayloadSource").CLIENT_CHANGE_ARCHIVED_STATUS,{archived:o})};m.prototype.$MercuryThreadActions5=function(n,o){return this.__constructClientPayload(n,c("MercuryActionType").UPDATE_COMM_STATUS,c("MercuryPayloadSource").CLIENT_UPDATE_COMM_STATUS,{comm_status:o})};m.prototype.$MercuryThreadActions4=function(n,o){return this.__constructClientPayload(n,c("MercuryActionType").CHANGE_FOLDER,c("MercuryPayloadSource").CLIENT_CHANGE_FOLDER,{new_folder:o})};m.prototype.__constructClientPayload=function(n,o,p,q){return{actions:n.map(function(r){return babelHelpers["extends"]({action_type:o,thread_id:r},q)}),from_client:true,payload_source:p}};Object.assign(m,c("MercurySingletonMixin"));f.exports=m}),null);
__d("MessengerFluxReduceDispatcher",["ExplicitRegistrationReactDispatcher"],(function a(b,c,d,e,f,g){"use strict";var h,i;h=babelHelpers.inherits(j,c("ExplicitRegistrationReactDispatcher"));i=h&&h.prototype;function j(){h.apply(this,arguments)}f.exports=new j({strict:false})}),null);
__d("MessengerSharedMediaActions",["MessengerFluxReduceDispatcher","keyMirror"],(function a(b,c,d,e,f,g){"use strict";var h=c("keyMirror")({CURRENT_LOADED:null,DELETE_PHOTOS:null,LATEST_LOADED:null,LOAD_CURRENT:null,LOAD_MORE_LATEST:null,LOAD_MORE_PREVIOUS:null,PREVIOUS_LOADED:null}),i="MessengerSharedMedia",j={Types:h,Namespace:i,currentLoaded:function k(l){c("MessengerFluxReduceDispatcher").dispatch({type:h.CURRENT_LOADED,namespace:i,data:l})},deletePhotos:function k(l,m){c("MessengerFluxReduceDispatcher").dispatch({type:h.DELETE_PHOTOS,namespace:i,threadFBID:l,photoFBIDs:m})},loadCurrent:function k(l,m){c("MessengerFluxReduceDispatcher").dispatch({type:h.LOAD_CURRENT,namespace:i,threadFBID:l,photoID:m})},loadMorePrevious:function k(l,m,n){c("MessengerFluxReduceDispatcher").dispatch({type:h.LOAD_MORE_PREVIOUS,namespace:i,threadFBID:l,afterCursor:m,first:n})},loadMoreLatest:function k(l,m,n){c("MessengerFluxReduceDispatcher").dispatch({type:h.LOAD_MORE_LATEST,namespace:i,threadFBID:l,beforeCursor:m,last:n})},previousLoaded:function k(l){c("MessengerFluxReduceDispatcher").dispatch({type:h.PREVIOUS_LOADED,namespace:i,data:l})},latestLoaded:function k(l){c("MessengerFluxReduceDispatcher").dispatch({type:h.LATEST_LOADED,namespace:i,data:l})}};f.exports=j}),null);
__d("bs_js_exn",["bs_caml_exceptions"],(function a(b,c,d,e,f,g){"use strict";var h=c("bs_caml_exceptions").create("Js_exn.Error");function i(q){if(c("bs_caml_exceptions").isCamlExceptionOrOpenVariant(q))return q;else return[h,q]}function j(q){throw new Error(q)}function k(q){throw new EvalError(q)}function l(q){throw new RangeError(q)}function m(q){throw new ReferenceError(q)}function n(q){throw new SyntaxError(q)}function o(q){throw new TypeError(q)}function p(q){throw new URIError(q)}g.$$Error=h;g.internalToOCamlException=i;g.raiseError=j;g.raiseEvalError=k;g.raiseRangeError=l;g.raiseReferenceError=m;g.raiseSyntaxError=n;g.raiseTypeError=o;g.raiseUriError=p}),null);
__d("bs_array",["bs_curry","bs_js_exn","bs_caml_array","bs_caml_exceptions","bs_caml_builtin_exceptions"],(function aa(ba,a,ca,da,ea,b){"use strict";function c(x,y){if(x)if(x<0)throw[a("bs_caml_builtin_exceptions").invalid_argument,"Array.init"];else{var z=a("bs_caml_array").caml_make_vect(x,a("bs_curry")._1(y,0));for(var A=1,B=x-1|0;A<=B;++A)z[A]=a("bs_curry")._1(y,A);return z}else return[]}function d(x,y,c){var z=a("bs_caml_array").caml_make_vect(x,[]);for(var A=0,B=x-1|0;A<=B;++A)z[A]=a("bs_caml_array").caml_make_vect(y,c);return z}function e(x){var y=x.length;if(y)return a("bs_caml_array").caml_array_sub(x,0,y);else return[]}function f(x,y){var z=x.length;if(z)if(y.length)return x.concat(y);else return a("bs_caml_array").caml_array_sub(x,0,z);else return e(y)}function g(x,y,z){if(z<0||y>(x.length-z|0))throw[a("bs_caml_builtin_exceptions").invalid_argument,"Array.sub"];else return a("bs_caml_array").caml_array_sub(x,y,z)}function h(x,y,z,A){if(y<0||z<0||y>(x.length-z|0))throw[a("bs_caml_builtin_exceptions").invalid_argument,"Array.fill"];else{for(var B=y,C=(y+z|0)-1|0;B<=C;++B)x[B]=A;return 0}}function i(x,y,z,A,B){if(B<0||y<0||y>(x.length-B|0)||A<0||A>(z.length-B|0))throw[a("bs_caml_builtin_exceptions").invalid_argument,"Array.blit"];else return a("bs_caml_array").caml_array_blit(x,y,z,A,B)}function j(x,y){for(var z=0,A=y.length-1|0;z<=A;++z)a("bs_curry")._1(x,y[z]);return 0}function k(x,y){var z=y.length;if(z){var A=a("bs_caml_array").caml_make_vect(z,a("bs_curry")._1(x,y[0]));for(var B=1,C=z-1|0;B<=C;++B)A[B]=a("bs_curry")._1(x,y[B]);return A}else return[]}function l(x,y){for(var z=0,A=y.length-1|0;z<=A;++z)a("bs_curry")._2(x,z,y[z]);return 0}function m(x,y){var z=y.length;if(z){var A=a("bs_caml_array").caml_make_vect(z,a("bs_curry")._2(x,0,y[0]));for(var B=1,C=z-1|0;B<=C;++B)A[B]=a("bs_curry")._2(x,B,y[B]);return A}else return[]}function n(x){var y=x.length-1|0,z=0;while(true){var A=z,B=y;if(B<0)return A;else{z=[x[B],A];y=B-1|0;continue}}}function o(x,y){while(true){var z=y,A=x;if(z){y=z[1];x=A+1|0;continue}else return A}}function p(x){if(x){var y=a("bs_caml_array").caml_make_vect(o(0,x),x[0]),z=1,A=x[1];while(true){var B=A,C=z;if(B){y[C]=B[0];A=B[1];z=C+1|0;continue}else return y}}else return[]}function q(x,y,z){var A=y;for(var B=0,C=z.length-1|0;B<=C;++B)A=a("bs_curry")._2(x,A,z[B]);return A}function r(x,y,z){var A=z;for(var B=y.length-1|0;B>=0;--B)A=a("bs_curry")._2(x,y[B],A);return A}var s=a("bs_caml_exceptions").create("Array.Bottom");function t(x,y){var z=function z(D,E){var I=((E+E|0)+E|0)+1|0,J=I;if((I+2|0)<D){if(a("bs_curry")._2(x,a("bs_caml_array").caml_array_get(y,I),a("bs_caml_array").caml_array_get(y,I+1|0))<0)J=I+1|0;if(a("bs_curry")._2(x,a("bs_caml_array").caml_array_get(y,J),a("bs_caml_array").caml_array_get(y,I+2|0))<0)J=I+2|0;return J}else if((I+1|0)<D&&a("bs_curry")._2(x,a("bs_caml_array").caml_array_get(y,I),a("bs_caml_array").caml_array_get(y,I+1|0))<0)return I+1|0;else if(I<D)return I;else throw[s,E]},A=function A(D,E,G){try{var I=D,J=E,H=G;while(true){var F=J,K=z(I,F);if(a("bs_curry")._2(x,a("bs_caml_array").caml_array_get(y,K),H)>0){a("bs_caml_array").caml_array_set(y,F,a("bs_caml_array").caml_array_get(y,K));J=K;continue}else return a("bs_caml_array").caml_array_set(y,F,H)}}catch(L){var M=a("bs_js_exn").internalToOCamlException(L);if(M[0]===s)return a("bs_caml_array").caml_array_set(y,M[1],G);else throw M}},B=function B(D,E){try{var I=D,J=E;while(true){var F=J,K=z(I,F);a("bs_caml_array").caml_array_set(y,F,a("bs_caml_array").caml_array_get(y,K));J=K;continue}}catch(L){var M=a("bs_js_exn").internalToOCamlException(L);if(M[0]===s)return M[1];else throw M}},C=function C(I,G){while(true){var E=I,J=(E-1|0)/3|0;if(E===J)throw[a("bs_caml_builtin_exceptions").assert_failure,["array.ml",168,4]];if(a("bs_curry")._2(x,a("bs_caml_array").caml_array_get(y,J),G)<0){a("bs_caml_array").caml_array_set(y,E,a("bs_caml_array").caml_array_get(y,J));if(J>0){I=J;continue}else return a("bs_caml_array").caml_array_set(y,0,G)}else return a("bs_caml_array").caml_array_set(y,E,G)}},D=y.length;for(var E=((D+1|0)/3|0)-1|0;E>=0;--E)A(D,E,a("bs_caml_array").caml_array_get(y,E));for(var F=D-1|0;F>=2;--F){var G=a("bs_caml_array").caml_array_get(y,F);a("bs_caml_array").caml_array_set(y,F,a("bs_caml_array").caml_array_get(y,0));C(B(F,0),G)}if(D>1){var H=a("bs_caml_array").caml_array_get(y,1);a("bs_caml_array").caml_array_set(y,1,a("bs_caml_array").caml_array_get(y,0));return a("bs_caml_array").caml_array_set(y,0,H)}else return 0}function u(x,y){var z=function z(G,H,I,J,K,L,M){var N=G+H|0,O=J+K|0,P=G,Q=a("bs_caml_array").caml_array_get(y,G),R=J,S=a("bs_caml_array").caml_array_get(I,J),T=M;while(true){var U=T,V=S,W=R,X=Q,Y=P;if(a("bs_curry")._2(x,X,V)<=0){a("bs_caml_array").caml_array_set(L,U,X);var Z=Y+1|0;if(Z<N){T=U+1|0;Q=a("bs_caml_array").caml_array_get(y,Z);P=Z;continue}else return i(I,W,L,U+1|0,O-W|0)}else{a("bs_caml_array").caml_array_set(L,U,V);var $=W+1|0;if($<O){T=U+1|0;S=a("bs_caml_array").caml_array_get(I,$);R=$;continue}else return i(y,Y,L,U+1|0,N-Y|0)}}},A=function A(G,H,I,J){for(var K=0,L=J-1|0;K<=L;++K){var M=a("bs_caml_array").caml_array_get(y,G+K|0),N=(I+K|0)-1|0;while(N>=I&&a("bs_curry")._2(x,a("bs_caml_array").caml_array_get(H,N),M)>0){a("bs_caml_array").caml_array_set(H,N+1|0,a("bs_caml_array").caml_array_get(H,N));N=N-1|0}a("bs_caml_array").caml_array_set(H,N+1|0,M)}return 0},B=function B(G,H,I,J){if(J<=5)return A(G,H,I,J);else{var D=J/2|0,E=J-D|0;B(G+D|0,H,I+D|0,E);B(G,y,G+E|0,D);return z(G+E|0,D,H,I+D|0,E,H,I)}},C=y.length;if(C<=5)return A(0,y,0,C);else{var D=C/2|0,E=C-D|0,F=a("bs_caml_array").caml_make_vect(E,a("bs_caml_array").caml_array_get(y,0));B(D,F,0,E);B(0,y,E,D);return z(E,D,F,0,E,y,0)}}var v=d,w=a("bs_caml_array").caml_array_concat,fa=u;b.init=c;b.make_matrix=d;b.create_matrix=v;b.append=f;b.concat=w;b.sub=g;b.copy=e;b.fill=h;b.blit=i;b.to_list=n;b.of_list=p;b.iter=j;b.map=k;b.iteri=l;b.mapi=m;b.fold_left=q;b.fold_right=r;b.sort=t;b.stable_sort=u;b.fast_sort=fa}),null);
__d("bs_js_boolean",[],(function a(b,c,d,e,f,g){"use strict";function h(i){if(i)return true;else return false}g.to_js_boolean=h}),null);
__d("mercurySingletonProviderRe",["bs_curry","CurrentUser"],(function a(b,c,d,e,f,g){"use strict";function h(i){var j={},k=function k(m){var n=j[m];if(n!==undefined)return n;else{var o=c("bs_curry")._1(i[0],m);j[m]=o;return o}},l=function l(){return k(c("CurrentUser").getID())};return[k,l]}g.Provider=h}),null);
__d("utilsRe",["bs_array","bs_curry","bs_js_boolean","bs_caml_builtin_exceptions"],(function a(b,c,d,e,f,g){"use strict";function h(q){if(q==null)return 0;else return+q}function i(q,r){if(q)return q[0];else return r}function j(q){return+((q==null?0:[q])!==0)}function k(q){if(q)return q[0];else return 0}function l(q){if(q==null)return 0;else return[+q]}function m(q){if(q)return c("bs_js_boolean").to_js_boolean(q[0]);else return undefined}function n(q){if(q)return c("bs_js_boolean").to_js_boolean(q[0]);else return false}function o(q,r){var s=q,t=r,u=0;while(true){var v=u,w=t;if(w){var x=w[1],y=c("bs_curry")._1(s,w[0]);if(y){u=[y[0],v];t=x;continue}else{t=x;continue}}else return v}}function p(q){return c("bs_array").map(function(r){if(r)return r[0];else throw[c("bs_caml_builtin_exceptions").invalid_argument,"arrayCompact: sorry, something went wrong."]},q.filter(function(r){if(r)return 1;else return 0}))}g.isTruthy=h;g.$pipe$unknown=i;g.isDefined=j;g.isSomeTrue=k;g.nullUndefinedBooleanToOptionBool=l;g.optionBoolToNullUndefinedBoolean=m;g.optionBoolToBoolean=n;g.listFilterMap=o;g.arrayCompact=p}),null);
__d("mercuryRogerRe",["bs_array","Arbiter","utilsRe","bs_caml_obj","JSLogger","immutable","bs_js_boolean","MercuryThreads","MercuryDispatcher","MercuryActionStatus","mercurySingletonProviderRe"],(function a(b,c,d,e,f,g){"use strict";function h(m,n,o,p){var q=+(n>=m.timestamp),r=m.status,s=1-p||c("bs_caml_obj").caml_notequal(o,m.author);if(q!==0)if(r==null)if(s!==0)return 1;else return 0;else if(s!==0&&c("bs_caml_obj").caml_equal(r,c("MercuryActionStatus").SUCCESS))return 1;else return 0;else return 0}function i(m){var n=[{}],o=new(c("Arbiter"))(),p={__fbid:m,getSeenBy:function t(u,v){var w=n,x=u,y=v;if(x==null)return[];else{var z=w[0][x.thread_id];if(z!==undefined)return z.reduce(function(A,B,C,D){if(h(x,B.watermark,C,c("utilsRe").isTruthy(y)))return c("bs_array").append(A,[C]);else return A},[]);else return[]}},wasSeenByAll:function t(u){var v=n,w=u,x=v[0][w.thread_id];if(x!==undefined)return c("bs_js_boolean").to_js_boolean(x.reduce(function(y,z,A,B){if(y)return h(w,z.watermark,A,0);else return 0},1));else return false},getSeenTimestamp:function t(u,v){var w=n,x=u,y=v,z=w[0][x];if(z!==undefined){var A=z.get(y);if(A==null)return null;else return A}else return null},getSeenTimestamps:function t(u){var v=n,w=u,x=v[0][w];if(x!==undefined)return x;else return c("immutable").OrderedMap()},subscribe:function t(u,v){return o.subscribe(u,v)},mockInform:function t(u,v){o.inform(u,v);return 0}},q=[[]],r=c("MercuryDispatcher").getForFBID(m),s=c("MercuryThreads").getForFBID(m);r.subscribe("update-roger",function(t,u){if(u==null)return 0;else{Object.keys(u).forEach(function(v){var w=s.getThreadMetaNow(v);Object.keys(u[v]).forEach(function(y){var x=n[0][v],z=x!==undefined?x:c("immutable").OrderedMap(),A=w==null?0:[w.participants],B=0;if(A)if(A[0].indexOf(y)===-1){q[0].push(z);return 0}else B=1;else B=1;if(B===1){var C=z.get(y),D=u[v][y],E=0;if(C==null)E=2;else if(D.watermark<=C.watermark)return 0;else E=2;if(E===2){n[0][v]=z.set(y,D);return 0}}});var x=n[0][v];if(x!==undefined){n[0][v]=x.sort(function(y,z){return y.watermark-z.watermark|0});return 0}else return 0});o.inform("change",u);return 0}});r.subscribe("invalidate-global-state",function(t,u){n[0]={};q[0]=[];return 0});c("Arbiter").subscribe(c("JSLogger").DUMP_EVENT,function(t,u){u.read_receipts={valid_receipts:n[0],bad_receipts:q[0]};return 0});return p}var j=c("mercurySingletonProviderRe").Provider([i]),k=j[0],l=j[1];g.getForFBID=k;g.get=l}),null);
__d("MercuryMessages",["invariant","BanzaiODS","ChatReliabilityInstrumentation","EventEmitter","FBJSON","ImmutableObject","LogHistory","Map","MercuryActionStatus","MercuryActionType","MercuryAssert","MercuryAttachment","MercuryDispatcher","MercuryIDs","MercuryLogMessageType","MercuryMessageClientState","MercuryPayloadSource","MercurySingletonProvider","MercuryMessageActions","MercuryMessageIDs","MessagingGiftWrapConstants","MessengerSharedMediaActions","RangedCallbackManager","MercurySendMessageFields","MercuryServerRequests","MercuryThreadActions","MercuryThreadInformer","MercuryThreads","URI","isMessengerDotComURI","setImmediate"],(function a(b,c,d,e,f,g,h){"use strict";var i=new(c("EventEmitter"))(),j=c("LogHistory").getInstance("mercury_messages");function k(p){switch(p){case c("MercuryPayloadSource").UNKNOWN:case c("MercuryPayloadSource").SERVER_INITIAL_DATA:case c("MercuryPayloadSource").SERVER_FETCH_THREAD_INFO:case c("MercuryPayloadSource").SERVER_THREAD_SYNC:return true}return false}l.getForFBID=function(p){return o.getForFBID(p)};l.get=function(){return o.get()};function l(p){this.$MercuryMessages1=p;this.$MercuryMessages2=c("MercuryMessageActions").getForFBID(this.$MercuryMessages1);this.$MercuryMessages3=c("MercuryServerRequests").getForFBID(this.$MercuryMessages1);this.$MercuryMessages4=c("MercuryThreadInformer").getForFBID(this.$MercuryMessages1);this.$MercuryMessages5=c("MercuryThreads").getForFBID(this.$MercuryMessages1);this.$MercuryMessages6=c("MercuryThreadActions").getForFBID(this.$MercuryMessages1);this.$MercuryMessages7=c("MercuryDispatcher").getForFBID(this.$MercuryMessages1);this.$MercuryMessages8=false;this.$MercuryMessages9={};this.$MercuryMessages10={};this.$MercuryMessages11={};this.$MercuryMessages12=new(c("Map"))();this.$MercuryMessages13={};this.$MercuryMessages14={};this.$MercuryMessages7.subscribe("update-messages",function(q,r){var s=(r.actions||[]).filter(function(u){var v=u.action_type,w=u.thread_id&&(v==c("MercuryActionType").LOG_MESSAGE||v==c("MercuryActionType").USER_GENERATED_MESSAGE||v==c("MercuryActionType").SEND_MESSAGE||v==c("MercuryActionType").DELETE_THREAD||v==c("MercuryActionType").DELETE_MESSAGES),x=u.upload_id&&u.upload_data&&(v==c("MercuryActionType").CANCEL_ATTACHMENT_PLACEHOLDER||v==c("MercuryActionType").CONFIRM_ATTACHMENT_PLACEHOLDER),y=v==c("MercuryActionType").REACTION_UPDATE,z=v==c("MercuryActionType").LIVE_LOCATION_UPDATE,A=u.replaced_message_id&&v==c("MercuryActionType").REPLACE_MESSAGE,B=u.unwrapped_message_id&&v==c("MercuryActionType").UNWRAP_MESSAGE;return w||x||y||z||A||B}),t=k(r.payload_source);this.handleUpdates(s,t,r.payload_source,r.from_client);if(r.end_of_history)this.$MercuryMessages15(r.end_of_history,r.payload_source);if(this.$MercuryMessages8){this.$MercuryMessages8=false;i.emit("change")}}.bind(this));this.$MercuryMessages7.subscribe("invalidate-thread-state",function(q,r){this.$MercuryMessages16(r)}.bind(this));this.$MercuryMessages7.subscribe("invalidate-global-state",function(){return this.invalidateGlobalState()}.bind(this));j.debug("constructed",JSON.stringify({fbid:this.$MercuryMessages1}))}l.prototype.getMessagesFromIDs=function(p){return(p||[]).map(function(q){return this.$MercuryMessages17(q)}.bind(this)).filter(function(q){return q})};l.prototype.getServerMessageID=function(p){var q=p;if(this.$MercuryMessages13[p])q=this.$MercuryMessages13[p];return q};l.prototype.hasLoadedNMessages=function(p,q){var r=this.$MercuryMessages18(p);return r.hasReachedEndOfArray()||r.getCurrentArraySize()>=q};l.prototype.hasLoadedExactlyNMessages=function(p,q){var r=this.$MercuryMessages18(p);return r.getCurrentArraySize()==q};l.prototype.invalidateGlobalState=function(){var p=Object.keys(this.$MercuryMessages10);this.$MercuryMessages9={};this.$MercuryMessages10={};this.$MercuryMessages11={};this.$MercuryMessages12=new(c("Map"))();this.$MercuryMessages13={};p.map(function(q){return this.$MercuryMessages4.invalidatedThread(q)}.bind(this))};l.prototype.getThreadMessagesRange=function(p,q,r,s,t,u){var v=this.$MercuryMessages18(p),w=function(G){s(this.$MercuryMessages19(G))}.bind(this),x=v.executeOrEnqueue(q,r,w),y=v.getUnavailableResources(x),z=this.$MercuryMessages9[p];if(y.length&&!z){var A=v.getCurrentArraySize(),B=this.$MercuryMessages11[p]||0,C=A-B,D=y.length+B,E=this.getCurrentlyLoadedMessages(p),F=E.length?E[0].timestamp:null;this.$MercuryMessages3.fetchThreadMessages(p,C,D,F,t,u)}else this.$MercuryMessages9[p]=false;return x};l.prototype.getThreadMessagesRangeNow=function(p,q,r){var s=this.$MercuryMessages18(p),t=[];for(var u=q;u<q+r;u++){var v=s.getResourceAtIndex(u),w=v&&this.$MercuryMessages17(v);w&&t.push(w)}return t};l.prototype.getThreadMessagesSinceTimestamp=function(p,q){var r=this.$MercuryMessages18(p),s=r.getElementsUntil(q);return this.$MercuryMessages19(s)};l.prototype.hasLoadedAllMessages=function(p){return this.$MercuryMessages18(p).hasReachedEndOfArray()};l.prototype.getCurrentlyLoadedMessages=function(p){var q=this.$MercuryMessages18(p).getAllResources();return this.$MercuryMessages19(q)};l.prototype.unsubscribe=function(p,q){c("MercuryAssert").isThreadID(q);var r=this.$MercuryMessages18(q);r.unsubscribe(p)};l.prototype.$MercuryMessages20=function(p,q){n(q);this.$MercuryMessages12.set(p,new(c("ImmutableObject"))(q))};l.prototype.$MercuryMessages21=function(p,q){var r=this.$MercuryMessages12.get(p);if(r){var s=r.page_admin_notes?r.page_admin_notes.slice():[],t=false,u=true;for(var v=0;v<s.length;++v)if(s[v].id===q.id){t=true;u=false;break}else if((s[v].id===null||s[v].id===undefined)&&s[v].body===q.body){t=true;s[v]=q}if(!t)s.push(q);if(u){var w={};w.page_admin_notes=s;this.$MercuryMessages22(p,r,w)}}};l.prototype.$MercuryMessages22=function(p,q,r){var s=c("ImmutableObject").set(q,r);this.$MercuryMessages12.set(p,s);return s};l.prototype.$MercuryMessages23=function(p,q,r){if(p==c("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE){var s=this.getThreadMessagesSinceTimestamp(q,r);if(s.length>0){c("BanzaiODS").bumpEntityKey("chat.web","channel.messages_reordered");return true}}else if(p===c("MercuryPayloadSource").SERVER_INVALIDATE_THREAD_STATE||p===c("MercuryPayloadSource").SERVER_INVALIDATE_GLOBAL_STATE)return true;return false};l.prototype.$MercuryMessages24=function(p,q){var r=p.action_type;if(q==c("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE&&r==c("MercuryActionType").USER_GENERATED_MESSAGE&&p.offline_threading_id&&this.$MercuryMessages13[p.offline_threading_id]===p.offline_threading_id){p.client_message_id=p.offline_threading_id;p.status=c("MercuryActionStatus").SUCCESS;p.action_type=c("MercuryActionType").SEND_MESSAGE;r=p.action_type}if(q===c("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE&&r==c("MercuryActionType").USER_GENERATED_MESSAGE){var s=this.$MercuryMessages5.getThreadMetaNow(p.thread_id);if(s&&s.folder)p.folder=s.folder;c("ChatReliabilityInstrumentation").logMESSAGE_RECEIVED(c("FBJSON").stringify({otid:p.offline_threading_id,message_id:p.message_id,other_user_fbid:p.other_user_fbid,sender_page_fbid:!s||!s.page_thread_info?null:s.page_thread_info.pageID}))}return p};l.prototype.handleUpdates=function(p,q,r,s){var t=void 0,u={};for(var v=0;v<p.length;v++){var w=this.$MercuryMessages24(p[v],r),x=w.action_type,y=w.message_id?this.$MercuryMessages17(w.message_id):null;if(x==c("MercuryActionType").LOG_MESSAGE)if(this.isLocalMessage(w))continue;if(r==c("MercuryPayloadSource").SERVER_SEARCH){if(!this.$MercuryMessages12.has(w.message_id))this.$MercuryMessages20(w.message_id,w);continue}else if(w.client_state===c("MercuryMessageClientState").SEND_TO_SERVER){this.$MercuryMessages20(w.message_id,w);continue}else if(x==c("MercuryActionType").SEND_MESSAGE){var z=w.client_message_id,A=this.$MercuryMessages17(z);if(z&&A&&w.status){var B=A.status;if(A.status==c("MercuryActionStatus").SUCCESS)continue;if(!u[w.thread_id])u[w.thread_id]=[];this.$MercuryMessages25(w);if(typeof B!==undefined||w.status==c("MercuryActionStatus").FAILED_UNKNOWN_REASON||w.status==c("MercuryActionStatus").UNABLE_TO_CONFIRM||w.status==c("MercuryActionStatus").SUCCESS||w.status==c("MercuryActionStatus").ERROR){var C=this.$MercuryMessages17(z);if(C)this.$MercuryMessages26(w.thread_id,C.message_id,r)}}continue}else if(x==c("MercuryActionType").DELETE_THREAD){this.$MercuryMessages18(w.thread_id).removeAllResources();continue}else if(x==c("MercuryActionType").DELETE_MESSAGES){this.$MercuryMessages27(w.thread_id,w.message_ids,r);c("setImmediate")(function(){this.$MercuryMessages6.updateSnippet(w.thread_id,w.message_ids)}.bind(this));continue}else if(x===c("MercuryActionType").REACTION_UPDATE){if(this.$MercuryMessages28(w))this.$MercuryMessages29(u,w,r);continue}else if(x===c("MercuryActionType").LIVE_LOCATION_UPDATE){if(this.$MercuryMessages30(w))this.$MercuryMessages29(u,w,r);continue}else if(x==c("MercuryActionType").REPLACE_MESSAGE){if(this.$MercuryMessages31(w)){this.$MercuryMessages29(u,w,r);q=true}continue}else if(w.offline_threading_id&&this.$MercuryMessages13[w.offline_threading_id]&&(r!=c("MercuryPayloadSource").SERVER_FETCH_THREAD_INFO||this.$MercuryMessages13[w.offline_threading_id]===w.message_id)||y){if(y&&w.ranges&&w.ranges.length>0){var D=y.message_id;this.$MercuryMessages22(this.$MercuryMessages13[D]||D,y,{ranges:w.ranges});this.$MercuryMessages26(y.thread_id,y.message_id,"link_shim")}continue}else if(x===c("MercuryActionType").CONFIRM_ATTACHMENT_PLACEHOLDER){this.$MercuryMessages32(w.upload_id,w.upload_data);continue}else if(x===c("MercuryActionType").CANCEL_ATTACHMENT_PLACEHOLDER){this.$MercuryMessages33(w.upload_id,w.upload_data);continue}else if(x==c("MercuryActionType").UNWRAP_MESSAGE){if(this.$MercuryMessages34(w))this.$MercuryMessages26(w.thread_id,w.unwrapped_message_id,r)}else{if(r===c("MercuryPayloadSource").CLIENT_SEND_MESSAGE){this.$MercuryMessages13[w.message_id]=w.message_id;if(w.thread_id=="root:"+w.offline_threading_id)this.$MercuryMessages18(w.thread_id).setReachedEndOfArray()}if(x==c("MercuryActionType").LOG_MESSAGE&&w.log_message_type==c("MercuryLogMessageType").SERVER_ERROR)this.$MercuryMessages9[w.thread_id]=true;if(w.client_state===c("MercuryMessageClientState").DO_NOT_SEND_TO_SERVER&&w.upload_id)this.$MercuryMessages14[w.upload_id]=w;if(!u[w.thread_id])u[w.thread_id]=[];u[w.thread_id].push(w.message_id);this.$MercuryMessages20(w.message_id,w);if(w.offline_threading_id&&w.offline_threading_id!=w.message_id){this.$MercuryMessages13[w.offline_threading_id]=w.message_id;c("MercuryMessageIDs").addServerID(w.offline_threading_id,w.message_id);if(w.threading_id)c("MercuryMessageIDs").addServerID(w.threading_id,w.message_id)}if(w[c("MercurySendMessageFields").MANUAL_RETRY_CNT]>0){t=this.$MercuryMessages18(w.thread_id);t.resortResources([w.message_id]);this.$MercuryMessages35(w.thread_id,c("MercuryPayloadSource").CLIENT_SEND_MESSAGE)}q=q||this.$MercuryMessages23(r,w.thread_id,w.timestamp);if(!q){var E=this.$MercuryMessages17(w.message_id);if(E)this.$MercuryMessages36(E)}continue}}for(var F in u){t=this.$MercuryMessages18(F);var G=t.getAllResources(),H=G.filter(function(D){var I=this.$MercuryMessages12.get(D);if(!I)return true;return I.action_type==c("MercuryActionType").LOG_MESSAGE&&I.log_message_type==c("MercuryLogMessageType").SERVER_ERROR}.bind(this));t.removeResources(H);if(s)this.$MercuryMessages37(F,u[F]);if(q){t.addResources(u[F]);this.$MercuryMessages35(F,r)}else t.addResourcesWithoutSorting(u[F].reverse(),0);this.$MercuryMessages4.updatedThread(F)}};l.prototype.$MercuryMessages29=function(p,q,r){if(!p[q.thread_id])p[q.thread_id]=[];this.$MercuryMessages18(q.thread_id).removeResources([q.replaced_message_id,q.offline_threading_id]);if(q.action_type!==c("MercuryActionType").REACTION_UPDATE&&q.action_type!==c("MercuryActionType").LIVE_LOCATION_UPDATE)p[q.thread_id].push(q.message_id);if(q.replaced_message_id)this.$MercuryMessages26(q.thread_id,q.replaced_message_id,r);this.$MercuryMessages26(q.thread_id,q.message_id||q.messageId,r)};l.prototype.isFirstMessage=function(p){var q=this.$MercuryMessages18(p.thread_id);if(q.getCurrentArraySize()===0)return false;var r=q.getResourceAtIndex(q.getCurrentArraySize()-1),s=this.$MercuryMessages17(r),t=s&&s.message_id,u=this.$MercuryMessages17(p.message_id),v=u&&u.message_id;if(!t||!v)return false;return q.hasReachedEndOfArray()&&t==v};l.prototype.isLocalMessage=function(p){if(p.offline_threading_id!==null&&p.offline_threading_id===p.message_id)return true;return false};l.prototype.$MercuryMessages27=function(p,q,r){if(!q.length)return;this.$MercuryMessages38(p,q,r);if(r!==c("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE)this.$MercuryMessages3.deleteMessages(p,q);var s=this.$MercuryMessages19(q);for(var t=0;t<s.length;t++){var u=s[t];if(u&&u.has_attachment){var v=u.attachments.map(function(w){if(c("MercuryAttachment").isPhotoAttachment(w)||c("MercuryAttachment").isVideoAttachment(w))return w.metadata.fbid;return null}).filter(function(w){return w!==null});c("MessengerSharedMediaActions").deletePhotos(c("MercuryIDs").getThreadFBIDFromThreadID(u.thread_id),v)}}};l.prototype.$MercuryMessages38=function(p,q,r){var s=q.map(function(u){var v=this.$MercuryMessages17(u);return v&&v.message_id}.bind(this)).filter(function(u){return!!u}),t=this.$MercuryMessages18(p);t.removeResources(s);this.$MercuryMessages35(p,r)};l.prototype.$MercuryMessages25=function(p){var q=p.client_message_id;if(!q)return false;var r=this.$MercuryMessages17(q);if(!r)return false;var s={};s.status=p.status;if(p.status===c("MercuryActionStatus").SUCCESS||p.error_data)s.error_data=p.error_data;var t=p.message_id;if(this.$MercuryMessages12.has(t)){if(r)this.$MercuryMessages22(t,r,s);return false}if(p.threading_id)s.threading_id=p.threading_id;if(p.timestamp)s.timestamp=p.timestamp;if(p.log_message_data)s.log_message_data=p.log_message_data;if(p.ranges&&p.ranges.length){n(p);s.ranges=p.ranges}if(p.attachments&&p.attachments.length){s.raw_attachments=null;s.attachments=p.attachments}this.$MercuryMessages13[q]=t;c("MercuryMessageIDs").addServerID(q,t);if(r){var u=this.$MercuryMessages22(t,r,s);this.$MercuryMessages12.set(q,new(c("ImmutableObject"))());if(m(u))this.$MercuryMessages11[u.thread_id]--}return true};l.prototype.$MercuryMessages28=function(p){var q,r=p.messageId,s=p.reaction,t=p.userId,u=this.$MercuryMessages17(r);if(!u)return false;var v=babelHelpers["extends"]({},u.reactions,(q={},q[t]=s,q));if(!s)delete v[t];this.$MercuryMessages22(r,u,{reactions:v});return true};l.prototype.$MercuryMessages30=function(p){var q=p.messageId,r=p.liveLocation,s=this.$MercuryMessages17(q);if(!s||!s.attachments||s.attachments.length!==1)return false;var t=s.attachments[0];if(!t||!t.share)return false;var u=t.share.target;if(!u||!u.live_location_id)return false;var v=babelHelpers["extends"]({},t,{share:babelHelpers["extends"]({},t.share,{target:babelHelpers["extends"]({},r,{live_location_id:u.live_location_id})})});this.$MercuryMessages22(q,s,{attachments:[v]});return true};l.prototype.$MercuryMessages31=function(p){var q=p.replaced_message_id;if(!q)return false;var r=this.$MercuryMessages17(q);if(!r)return false;var s=p.message_id,t={};if(p.status)t.status=p.status;if(p.timestamp&&s!==q)t.timestamp=p.timestamp;if(p.log_message_data)t.log_message_data=p.log_message_data;if(p.ranges&&p.ranges.length){n(p);t.ranges=p.ranges}if(p.meta_ranges)t.meta_ranges=p.meta_ranges;if(p.attachments&&p.attachments.length){t.raw_attachments=null;t.attachments=p.attachments}if(p.body&&p.body!==r.body)t.body=p.body;if(p.platform_xmd&&p.platform_xmd!==r.platform_xmd)t.platform_xmd=p.platform_xmd;if(p.profile_ranges&&p.profile_ranges!==r.profile_ranges)t.profile_ranges=p.profile_ranges;if(Object.keys(t).length===0)return false;c("MercuryMessageIDs").addServerID(s,s);this.$MercuryMessages22(s,r,t);if(q!==s){this.$MercuryMessages12["delete"](q);if(r.message_id&&this.$MercuryMessages12.has(r.message_id))this.$MercuryMessages12["delete"](r.message_id)}return true};l.prototype.$MercuryMessages34=function(p){var q=this.$MercuryMessages17(p.unwrapped_message_id);if(!q||!q.tags)return false;var r=q.tags.slice(0);r.push(c("MessagingGiftWrapConstants").UNWRAPPED_TAG);var s={tags:r};this.$MercuryMessages22(p.unwrapped_message_id,q,s);return true};l.prototype.getNumberLocalMessages=function(p){return this.$MercuryMessages11[p]||0};l.prototype.$MercuryMessages32=function(p,q){var r=this.$MercuryMessages39(p,q);delete r.preview_attachments;this.$MercuryMessages3.sendNewMessage(r)};l.prototype.$MercuryMessages33=function(p,q){var r=this.$MercuryMessages39(p,q);this.$MercuryMessages38(r.thread_id,[r.message_id]);if(this.$MercuryMessages11[r.thread_id])this.$MercuryMessages11[r.thread_id]--};l.prototype.$MercuryMessages39=function(p,q){var r=this.$MercuryMessages14[p];r||h(0);r.image_ids=q.image_ids;r.file_ids=q.file_ids;r.audio_ids=q.audio_ids;r.gif_ids=q.gif_ids;r.video_ids=q.video_ids;r.client_state=c("MercuryMessageClientState").SEND_TO_SERVER;delete this.$MercuryMessages14[p];return r};l.prototype.$MercuryMessages26=function(p,q,r){this.$MercuryMessages8=true;this.$MercuryMessages4.updatedMessage(p,q,r)};l.prototype.$MercuryMessages36=function(p){this.$MercuryMessages8=true;this.$MercuryMessages4.receivedMessage(p)};l.prototype.$MercuryMessages35=function(p,q){this.$MercuryMessages8=true;this.$MercuryMessages4.reorderedMessages(p,q)};l.prototype.$MercuryMessages16=function(p){if(!this.$MercuryMessages10[p])return;var q=this.$MercuryMessages10[p].getAllResources();q.forEach(function(r){var s=this.$MercuryMessages17(r),t=undefined;if(s)t=s.offline_threading_id;this.$MercuryMessages12["delete"](r);if(t){var u=this.$MercuryMessages13[t];if(u)this.$MercuryMessages12["delete"](u);delete this.$MercuryMessages13[t]}delete this.$MercuryMessages13[r]}.bind(this));delete this.$MercuryMessages10[p]};l.addListener=function(p,q){return i.addListener(p,q)};l.prototype.$MercuryMessages17=function(p){var q=p;if(this.$MercuryMessages13[p])q=this.$MercuryMessages13[p];return this.$MercuryMessages12.get(q)};l.prototype.$MercuryMessages18=function(p){if(!this.$MercuryMessages10[p])this.$MercuryMessages10[p]=new(c("RangedCallbackManager"))(function(q){var r=this.$MercuryMessages17(q);return r&&r.timestamp}.bind(this),function(q,r){return r-q});return this.$MercuryMessages10[p]};l.prototype.$MercuryMessages15=function(p,q){p.forEach(function(r){var s=this.$MercuryMessages18(r);s.setReachedEndOfArray();this.$MercuryMessages35(r,q)}.bind(this))};l.prototype.$MercuryMessages19=function(p){var q=p.reduce(function(r,s){var t=this.$MercuryMessages17(s);if(t)r.push(t);return r}.bind(this),[]);return q.reverse()};l.prototype.$MercuryMessages37=function(p,q){var r=q.filter(function(s){return m(this.$MercuryMessages17(s))}.bind(this));if(!this.$MercuryMessages11[p])this.$MercuryMessages11[p]=0;this.$MercuryMessages11[p]+=r.length};function m(p){var q=p.action_type;if(q==c("MercuryActionType").USER_GENERATED_MESSAGE)return true;switch(p.log_message_type){case c("MercuryLogMessageType").SUBSCRIBE:case c("MercuryLogMessageType").UNSUBSCRIBE:case c("MercuryLogMessageType").SERVER_ERROR:case c("MercuryLogMessageType").LIVE_LISTEN:return false;default:return true}}function n(p){if(!p.ranges)return;p.ranges.forEach(function(q){if(!q.entity||q.entity.external||!q.entity.url)return;var r=new(c("URI"))(q.entity.url);if(c("isMessengerDotComURI")(c("URI").getRequestURI())&&!r.getDomain()){r.setProtocol("https").setDomain("www.facebook.com");q.entity.url=r.toString()}})}var o=new(c("MercurySingletonProvider"))(l);f.exports=l}),null);
__d("MercuryDelayedRoger",["ArbiterMixin","LiveTimer","MercuryActionStatus","MercuryConfig","MercuryMessages","mercuryRogerRe","MercurySingletonProvider","MercuryThreadInformer","MercuryThreads","mixin","setTimeoutAcrossTransitions"],(function a(b,c,d,e,f,g){var h,i,j=c("MercuryConfig")["roger.seen_delay"];h=babelHelpers.inherits(k,c("mixin")(c("ArbiterMixin")));i=h&&h.prototype;k.getForFBID=function(m){"use strict";return l.getForFBID(m)};k.get=function(){"use strict";return l.get()};function k(m){"use strict";i.constructor.call(this);this.$MercuryDelayedRoger9=function(event,n){var o={};for(var p in n)if(this.$MercuryDelayedRoger11(p))o[p]=true;Object.keys(o).forEach(function(q){return this.$MercuryDelayedRoger12(o)}.bind(this))}.bind(this);this.$MercuryDelayedRoger1=m;this.$MercuryDelayedRoger2=c("mercuryRogerRe").getForFBID(m);this.$MercuryDelayedRoger4={};this.$MercuryDelayedRoger5={};this.$MercuryDelayedRoger2.subscribe("change",function(n,o){for(var p in o)!this.$MercuryDelayedRoger5[p]&&this.$MercuryDelayedRoger8(p)}.bind(this));this.$MercuryDelayedRoger3=c("MercuryThreadInformer").getForFBID(m);this.$MercuryDelayedRoger6=c("MercuryMessages").getForFBID(m);this.$MercuryDelayedRoger7=c("MercuryThreads").getForFBID(m);this.$MercuryDelayedRoger3.subscribe("messages-received",this.$MercuryDelayedRoger9);this.$MercuryDelayedRoger3.subscribe("messages-reordered",this.$MercuryDelayedRoger9);this.$MercuryDelayedRoger3.subscribe("messages-updated",this.$MercuryDelayedRoger9)}k.prototype.getSeenBy=function(m,n){"use strict";if(this.$MercuryDelayedRoger5[m])return[];return this.$MercuryDelayedRoger2.getSeenBy(this.$MercuryDelayedRoger10(m),n)};k.prototype.wasSeenByAll=function(m){"use strict";if(this.$MercuryDelayedRoger5[m])return false;return this.$MercuryDelayedRoger2.wasSeenByAll(this.$MercuryDelayedRoger10(m))};k.prototype.$MercuryDelayedRoger10=function(m){"use strict";if(!this.$MercuryDelayedRoger4[m]){var n=this.$MercuryDelayedRoger7.getThreadMetaNow(m);if(n)this.$MercuryDelayedRoger4[m]={thread_id:m,author:n.participants[0],timestamp:n.timestamp}}return this.$MercuryDelayedRoger4[m]};k.prototype.$MercuryDelayedRoger11=function(m){"use strict";var n=false;this.$MercuryDelayedRoger6.getThreadMessagesRange(m,0,1,function(o){var p=o[0];if(!p)return;var q=p.timestamp;if(p.status===c("MercuryActionStatus").SUCCESS)q-=c("LiveTimer").getServerTimeOffset();var r=this.getSeenBy(m);if(this.$MercuryDelayedRoger5[m]){clearTimeout(this.$MercuryDelayedRoger5[m]);delete this.$MercuryDelayedRoger5[m]}var s=q+j,t=s-Date.now();if(t>0)this.$MercuryDelayedRoger5[m]=c("setTimeoutAcrossTransitions")(function(){delete this.$MercuryDelayedRoger5[m];this.$MercuryDelayedRoger8(m)}.bind(this),t);this.$MercuryDelayedRoger4[m]=p;var u=this.getSeenBy(m);if(r.length||u.length)n=true}.bind(this));return n};k.prototype.$MercuryDelayedRoger8=function(m){"use strict";var n={};n[m]=true;this.$MercuryDelayedRoger12(n)};k.prototype.$MercuryDelayedRoger12=function(m){"use strict";this.inform("state-changed",m);this.inform("change")};var l=new(c("MercurySingletonProvider"))(k);f.exports=k}),null);
__d("MercuryFolders",["MercuryFoldersConfig","MessagingTag"],(function a(b,c,d,e,f,g){var h=[c("MessagingTag").INBOX,c("MessagingTag").PENDING,c("MessagingTag").OTHER,c("MessagingTag").ACTION_ARCHIVED],i={getSupportedFolders:function j(){return h.filter(function(k){if(k===c("MessagingTag").PENDING)return!c("MercuryFoldersConfig").hide_message_filtered;else if(k===c("MessagingTag").OTHER)return!c("MercuryFoldersConfig").hide_message_requests;return true}).concat()},getFromMeta:function j(k){var l=k.folder;if(k.is_archived)l=c("MessagingTag").ACTION_ARCHIVED;return l}};f.exports=i}),null);
__d("LeadGenInfoFieldTypes",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({CUSTOM:"CUSTOM",CITY:"CITY",COMPANY_NAME:"COMPANY_NAME",COUNTRY:"COUNTRY",DOB:"DOB",EMAIL:"EMAIL",GENDER:"GENDER",FIRST_NAME:"FIRST_NAME",FULL_NAME:"FULL_NAME",JOB_TITLE:"JOB_TITLE",LAST_NAME:"LAST_NAME",MARITIAL_STATUS:"MARITIAL_STATUS",PHONE:"PHONE",POST_CODE:"POST_CODE",PROVINCE:"PROVINCE",RELATIONSHIP_STATUS:"RELATIONSHIP_STATUS",STATE:"STATE",STREET_ADDRESS:"STREET_ADDRESS",ZIP:"ZIP",WORK_EMAIL:"WORK_EMAIL",MILITARY_STATUS:"MILITARY_STATUS",WORK_PHONE_NUMBER:"WORK_PHONE_NUMBER",MESSENGER:"MESSENGER",STORE_LOOKUP:"STORE_LOOKUP",DATE_TIME:"DATE_TIME",ID_CPF:"ID_CPF"})}),null);
__d("MercuryTimePassed",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({TODAY:0,WEEK_AGO:1,MONTH_AGO:2,CURRENT_YEAR:3,OTHER_YEAR:4})}),null);
__d("MessagingThreadType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({ONE_TO_ONE:1,GROUP:2,ROOM:3,MONTAGE:4,MARKETPLACE:5})}),null);
__d("RTCCallState",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({NO_ONGOING_CALL:"NO_ONGOING_CALL",AUDIO_GROUP_CALL:"AUDIO_GROUP_CALL",VIDEO_GROUP_CALL:"VIDEO_GROUP_CALL"})}),null);
__d("MercuryTimestamp",["fbt","MercuryTimePassed","formatDate"],(function a(b,c,d,e,f,g,h){var i=864e5,j=6*i,k={getFormatedTimestamp:function l(m){var n=m/1e3;return k.getFormattedTimestampByBucket(n,this.getTimeBucket(m))},getAbsoluteTimestamp:function l(m){if(m==null)return null;else{var n=k.getFormatedTimestamp(m);return n.absolute}},getRelativeTimestamp:function l(m){var n=k.getFormatedTimestamp(m);return n.relative},getFormattedTimestampByBucket:function l(m,n){switch(n){case c("MercuryTimePassed").TODAY:return{absolute:h._("Hoy"),relative:c("formatDate")(m,"g:ia")};case c("MercuryTimePassed").WEEK_AGO:return{absolute:c("formatDate")(m,"l"),relative:c("formatDate")(m,"D")};case c("MercuryTimePassed").CURRENT_YEAR:return{absolute:c("formatDate")(m,"F j"),relative:c("formatDate")(m,"M j")};default:return{absolute:c("formatDate")(m,"F j, Y"),relative:c("formatDate")(m,"n/j/y")}}},getTimeBucket:function l(m){var n=new Date(m),o=new Date(),p=new Date(o.getFullYear(),o.getMonth(),o.getDate());if(p<n)return c("MercuryTimePassed").TODAY;else if(p-j<n)return c("MercuryTimePassed").WEEK_AGO;else if(p.getFullYear()===n.getFullYear())return c("MercuryTimePassed").CURRENT_YEAR;else return c("MercuryTimePassed").OTHER_YEAR},getPreciseTimestamp:function l(m){return c("formatDate")(new Date(m),k.getPreciseFormat(m))},getPreciseFormat:function l(m){var n=k.getTimeBucket(m);switch(n){case c("MercuryTimePassed").TODAY:return"g:ia";case c("MercuryTimePassed").WEEK_AGO:return"l g:ia";case c("MercuryTimePassed").CURRENT_YEAR:return"F jS, g:ia";case c("MercuryTimePassed").OTHER_YEAR:default:return"F j, Y g:i a"}}};f.exports=k}),null);